
project build/make/
diff --git a/core/binary.mk b/core/binary.mk
index d2c8c1eaf..349f61f86 100644
--- a/core/binary.mk
+++ b/core/binary.mk
@@ -594,7 +594,7 @@ ifeq ($(NATIVE_COVERAGE),true)
         # with `--gcov-tool /usr/bin/gcov-4.6`.
         #
         # http://stackoverflow.com/questions/17758126/clang-code-coverage-invalid-output
-        my_cflags += --coverage -O0
+        my_cflags += --coverage -Ofast
         my_ldflags += --coverage
     endif
 
@@ -797,7 +797,7 @@ endif
 
 # Turn on all warnings and warnings as errors for RS compiles.
 # This can be disabled with LOCAL_RENDERSCRIPT_FLAGS := -Wno-error
-renderscript_flags := -Wall -Werror
+renderscript_flags := -Wall
 renderscript_flags += $(LOCAL_RENDERSCRIPT_FLAGS)
 # -m32 or -m64
 renderscript_flags += -m$(my_32_64_bit_suffix)
@@ -1664,7 +1664,7 @@ my_cflags += -Wno-attributes
 endif
 
 ifeq ($(my_fdo_build), true)
-  my_cflags := $(patsubst -Os,-O2,$(my_cflags))
+  my_cflags := $(patsubst -g0,-Ofast,$(my_cflags))
   fdo_incompatible_flags := -fno-early-inlining -finline-limit=%
   my_cflags := $(filter-out $(fdo_incompatible_flags),$(my_cflags))
 endif
@@ -1706,10 +1706,10 @@ ifneq ($(LOCAL_MODULE_MAKEFILE),$(SOONG_ANDROID_MK))
         $(eval MODULES_USING_WNO_ERROR := $(MODULES_USING_WNO_ERROR) $(LOCAL_MODULE_MAKEFILE):$(LOCAL_MODULE))
       else
         # Issue warning if -Werror is not used. Add it.
-        ifeq (,$(filter -Werror,$(my_all_cflags)))
+        ifeq (,$(filter -Wall,$(my_all_cflags)))
           # Add -Wall -Werror unless the project is in the WARNING_ALLOWED project list.
           ifeq (,$(strip $(call find_warning_allowed_projects,$(LOCAL_PATH))))
-            my_cflags := -Wall -Werror $(my_cflags)
+            my_cflags := -Wall $(my_cflags)
           else
             $(eval MODULES_ADDED_WALL := $(MODULES_ADDED_WALL) $(LOCAL_MODULE_MAKEFILE):$(LOCAL_MODULE))
             my_cflags := -Wall $(my_cflags)
diff --git a/core/definitions.mk b/core/definitions.mk
index d83a075f8..6bf287733 100644
--- a/core/definitions.mk
+++ b/core/definitions.mk
@@ -1044,7 +1044,7 @@ endef
 define transform-bc-to-so
 @echo "Renderscript compatibility: $(notdir $@) <= $(notdir $<)"
 $(hide) mkdir -p $(dir $@)
-$(hide) $(BCC_COMPAT) -O3 -o $(dir $@)/$(notdir $(<:.bc=.o)) -fPIC -shared \
+$(hide) $(BCC_COMPAT) -Ofast -o $(dir $@)/$(notdir $(<:.bc=.o)) -fPIC -shared \
 	-rt-path $(RS_PREBUILT_CLCORE) -mtriple $(RS_COMPAT_TRIPLE) $<
 $(hide) $(PRIVATE_CXX) -shared -Wl,-soname,$(notdir $@) -nostdlib \
 	-Wl,-rpath,\$$ORIGIN/../lib \
diff --git a/core/host_test_internal.mk b/core/host_test_internal.mk
index 42e01e1e4..cdc8edda5 100644
--- a/core/host_test_internal.mk
+++ b/core/host_test_internal.mk
@@ -7,7 +7,7 @@ ifeq ($(LOCAL_GTEST),true)
   LOCAL_CFLAGS_linux += -DGTEST_OS_LINUX
   LOCAL_CFLAGS_darwin += -DGTEST_OS_MAC
 
-  LOCAL_CFLAGS += -DGTEST_HAS_STD_STRING -O0 -g
+  LOCAL_CFLAGS += -DGTEST_HAS_STD_STRING -Ofast -g0
 
   LOCAL_STATIC_LIBRARIES += libgtest_main_host libgtest_host
 endif
diff --git a/core/java_renderscript.mk b/core/java_renderscript.mk
index 191b3be6a..34f3b9ea8 100644
--- a/core/java_renderscript.mk
+++ b/core/java_renderscript.mk
@@ -46,7 +46,7 @@ endif
 
 # Turn on all warnings and warnings as errors for RS compiles.
 # This can be disabled with LOCAL_RENDERSCRIPT_FLAGS := -Wno-error
-renderscript_flags := -Wall -Werror
+renderscript_flags := -Wall
 renderscript_flags += $(LOCAL_RENDERSCRIPT_FLAGS)
 
 # prepend the RenderScript system include path
diff --git a/core/main.mk b/core/main.mk
index 97ec295f8..363c1e302 100644
--- a/core/main.mk
+++ b/core/main.mk
@@ -307,8 +307,6 @@ endif # !user_variant
 ifeq (true,$(strip $(enable_target_debugging)))
   # Target is more debuggable and adbd is on by default
   ADDITIONAL_DEFAULT_PROPERTIES += ro.debuggable=1
-  # Enable Dalvik lock contention logging.
-  ADDITIONAL_BUILD_PROPERTIES += dalvik.vm.lockprof.threshold=500
   # Include the debugging/testing OTA keys in this build.
   INCLUDE_TEST_OTA_KEYS := true
 else # !enable_target_debugging
@@ -328,7 +326,7 @@ ifneq ($(filter ro.setupwizard.mode=ENABLED, $(call collapse-pairs, $(ADDITIONAL
 endif
 ifndef is_sdk_build
   # To speedup startup of non-preopted builds, don't verify or compile the boot image.
-  ADDITIONAL_BUILD_PROPERTIES += dalvik.vm.image-dex2oat-filter=verify-at-runtime
+  ADDITIONAL_BUILD_PROPERTIES += dalvik.vm.image-dex2oat-filter=speed
 endif
 endif
 
@@ -359,10 +357,6 @@ BUILD_WITHOUT_PV := true
 
 ADDITIONAL_BUILD_PROPERTIES += net.bt.name=Android
 
-# Sets the location that the runtime dumps stack traces to when signalled
-# with SIGQUIT. Stack trace dumping is turned on for all android builds.
-ADDITIONAL_BUILD_PROPERTIES += dalvik.vm.stack-trace-dir=/data/anr
-
 # ------------------------------------------------------------
 # Include vendor specific additions to build properties
 -include vendor/lineage/build/core/main.mk
diff --git a/target/product/core_minimal.mk b/target/product/core_minimal.mk
index b8e04e0ca..79f5ae37e 100644
--- a/target/product/core_minimal.mk
+++ b/target/product/core_minimal.mk
@@ -168,16 +168,6 @@ PRODUCT_COPY_FILES += $(call add-to-product-copy-files-if-exists,\
 PRODUCT_COPY_FILES += $(call add-to-product-copy-files-if-exists,\
     frameworks/base/dirty-image-objects-phone:system/etc/dirty-image-objects)
 
-# On userdebug builds, collect more tombstones by default.
-ifneq (,$(filter userdebug eng,$(TARGET_BUILD_VARIANT)))
-PRODUCT_SYSTEM_DEFAULT_PROPERTIES += \
-    tombstoned.max_tombstone_count=50
-endif
-
-PRODUCT_DEFAULT_PROPERTY_OVERRIDES += \
-    ro.logd.size.stats=64K \
-    log.tag.stats_log=I
-
 $(call inherit-product, $(SRC_TARGET_DIR)/product/runtime_libart.mk)
 $(call inherit-product, $(SRC_TARGET_DIR)/product/base.mk)
 
diff --git a/target/product/runtime_libart.mk b/target/product/runtime_libart.mk
index bda45244d..1b386cd27 100644
--- a/target/product/runtime_libart.mk
+++ b/target/product/runtime_libart.mk
@@ -76,24 +76,21 @@ PRODUCT_PROPERTY_OVERRIDES += \
 # On eng builds, make "boot" reasons only extract for faster turnaround.
 ifeq (eng,$(TARGET_BUILD_VARIANT))
     PRODUCT_SYSTEM_DEFAULT_PROPERTIES += \
-        pm.dexopt.first-boot=extract \
-        pm.dexopt.boot=extract
+        pm.dexopt.first-boot=speed \
+        pm.dexopt.boot=speed
 else
     PRODUCT_SYSTEM_DEFAULT_PROPERTIES += \
-        pm.dexopt.first-boot=quicken \
-        pm.dexopt.boot=verify
+        pm.dexopt.first-boot=speed \
+        pm.dexopt.boot=speed
 endif
 
 # The install filter is speed-profile in order to enable the use of
 # profiles from the dex metadata files. Note that if a profile is not provided
 # or if it is empty speed-profile is equivalent to (quicken + empty app image).
 PRODUCT_SYSTEM_DEFAULT_PROPERTIES += \
-    pm.dexopt.install=speed-profile \
-    pm.dexopt.bg-dexopt=speed-profile \
-    pm.dexopt.ab-ota=speed-profile \
-    pm.dexopt.inactive=verify \
+    pm.dexopt.install=speed \
+    pm.dexopt.bg-dexopt=speed \
+    pm.dexopt.ab-ota=speed \
+    pm.dexopt.inactive=speed \
     pm.dexopt.shared=speed
 
-# Enable minidebuginfo generation unless overridden.
-PRODUCT_SYSTEM_DEFAULT_PROPERTIES += \
-    dalvik.vm.dex2oat-minidebuginfo=true
diff --git a/tools/acp/Android.bp b/tools/acp/Android.bp
index 64f5a1013..8b84418b3 100644
--- a/tools/acp/Android.bp
+++ b/tools/acp/Android.bp
@@ -5,7 +5,7 @@
 cc_binary_host {
 
     srcs: ["acp.c"],
-    cflags: ["-Wall", "-Werror"],
+    cflags: ["-Wall"],
 
     static_libs: ["libhost"],
     name: "acp",
diff --git a/tools/atree/Android.bp b/tools/atree/Android.bp
index 5fbe042ea..fc8a8aada 100644
--- a/tools/atree/Android.bp
+++ b/tools/atree/Android.bp
@@ -9,6 +9,6 @@ cc_binary_host {
         "files.cpp",
         "fs.cpp",
     ],
-    cflags: ["-Wall", "-Werror"],
+    cflags: ["-Wall"],
     static_libs: ["libhost"],
 }
diff --git a/tools/fs_config/Android.bp b/tools/fs_config/Android.bp
index 797cfe228..5dfc129dc 100644
--- a/tools/fs_config/Android.bp
+++ b/tools/fs_config/Android.bp
@@ -19,7 +19,6 @@ cc_binary_host {
         "libcutils",
         "libselinux",
     ],
-    cflags: ["-Werror"],
 }
 
 // -----------------------------------------------------------------------------
@@ -30,8 +29,6 @@ test_c_flags = [
     "-fstack-protector-all",
     "-g",
     "-Wall",
-    "-Wextra",
-    "-Werror",
     "-fno-builtin",
     "-DANDROID_FILESYSTEM_CONFIG=\"android_filesystem_config_test_data.h\"",
 ]
diff --git a/tools/fs_config/Android.mk b/tools/fs_config/Android.mk
index f6c8132b4..19b357315 100644
--- a/tools/fs_config/Android.mk
+++ b/tools/fs_config/Android.mk
@@ -75,7 +75,7 @@ LOCAL_SRC_FILES := fs_config_generate.c
 LOCAL_MODULE := fs_config_generate_$(TARGET_DEVICE)
 LOCAL_MODULE_CLASS := EXECUTABLES
 LOCAL_SHARED_LIBRARIES := libcutils
-LOCAL_CFLAGS := -Werror -Wno-error=\#warnings
+LOCAL_CFLAGS := -Wall
 
 ifneq ($(TARGET_FS_CONFIG_GEN),)
 system_android_filesystem_config := system/core/include/private/android_filesystem_config.h
diff --git a/tools/fs_get_stats/Android.bp b/tools/fs_get_stats/Android.bp
index 67742b836..f710d506e 100644
--- a/tools/fs_get_stats/Android.bp
+++ b/tools/fs_get_stats/Android.bp
@@ -1,7 +1,7 @@
 cc_binary_host {
     name: "fs_get_stats",
     srcs: ["fs_get_stats.c"],
-    cflags: ["-Wall", "-Werror"],
+    cflags: ["-Wall"],
     shared_libs: [
         "libcutils",
         "liblog",
diff --git a/tools/libhost/Android.bp b/tools/libhost/Android.bp
index 4c9100f15..82268553b 100644
--- a/tools/libhost/Android.bp
+++ b/tools/libhost/Android.bp
@@ -3,7 +3,6 @@ cc_library_host_static {
     srcs: ["CopyFile.c"],
 
     cflags: [
-        "-Werror",
         "-Wall",
     ],
 
diff --git a/tools/makeparallel/Android.bp b/tools/makeparallel/Android.bp
index 898db6861..14be89ac2 100644
--- a/tools/makeparallel/Android.bp
+++ b/tools/makeparallel/Android.bp
@@ -17,5 +17,5 @@ cc_binary_host {
     srcs: [
         "makeparallel.cpp",
     ],
-    cflags: ["-Wall", "-Werror"],
+    cflags: ["-Wall"],
 }
diff --git a/tools/makeparallel/Makefile b/tools/makeparallel/Makefile
index 82a4abfac..b2595d45e 100644
--- a/tools/makeparallel/Makefile
+++ b/tools/makeparallel/Makefile
@@ -27,7 +27,7 @@ MAKEPARALLEL_BIN_PATH ?= .
 MAKEPARALLEL_CXX_SRCS := \
 	makeparallel.cpp
 
-MAKEPARALLEL_CXXFLAGS := -Wall -Werror -MMD -MP
+MAKEPARALLEL_CXXFLAGS := -Wall -MMD -MP
 
 MAKEPARALLEL_CXX_SRCS := $(addprefix $(MAKEPARALLEL_SRC_PATH)/,\
 	$(MAKEPARALLEL_CXX_SRCS))
diff --git a/tools/releasetools/common.py b/tools/releasetools/common.py
index f7ab11cd8..22c6106c9 100644
--- a/tools/releasetools/common.py
+++ b/tools/releasetools/common.py
@@ -1751,7 +1751,7 @@ class BlockDifference(object):
     #   decompression_time: 15s  | 25s                | 25s
 
     if not self.src:
-      brotli_cmd = ['brotli', '--quality=6',
+      brotli_cmd = ['brotli', '--quality=7',
                     '--output={}.new.dat.br'.format(self.path),
                     '{}.new.dat'.format(self.path)]
       print("Compressing {}.new.dat with brotli".format(self.partition))
diff --git a/tools/zipalign/Android.bp b/tools/zipalign/Android.bp
index 8e6196d29..9e65a5cf9 100644
--- a/tools/zipalign/Android.bp
+++ b/tools/zipalign/Android.bp
@@ -13,7 +13,7 @@ cc_binary_host {
         "ZipFile.cpp",
     ],
 
-    cflags: ["-Wall", "-Werror"],
+    cflags: ["-Wall"],
 
     // NOTE: Do not add any shared_libs dependencies because they will break the
     // static_sdk_tools target.
diff --git a/tools/ziptime/Android.bp b/tools/ziptime/Android.bp
index 5ef45ed40..7d882ae72 100644
--- a/tools/ziptime/Android.bp
+++ b/tools/ziptime/Android.bp
@@ -27,7 +27,7 @@ cc_binary_host {
     ],
 
     name: "ziptime",
-    cflags: ["-Wall", "-Werror"],
+    cflags: ["-Wall"],
     target: {
         windows: {
             enabled: true,

project device/lineage/sepolicy/
diff --git a/common/private/backuptool.te b/common/private/backuptool.te
index b948b61..d62a3e0 100644
--- a/common/private/backuptool.te
+++ b/common/private/backuptool.te
@@ -6,6 +6,6 @@ neverallow {
     -update_engine
 } backuptool:process transition;
 
-userdebug_or_eng(`
+
     permissive backuptool;
-')
+
diff --git a/common/private/recovery.te b/common/private/recovery.te
index 9a9d7cd..fb877e1 100644
--- a/common/private/recovery.te
+++ b/common/private/recovery.te
@@ -4,10 +4,10 @@ r_dir_file(recovery, adb_keys_file)
 set_prop(recovery, shell_prop)
 
 # Manage fstab and /adb_keys
-userdebug_or_eng(`
+
 allow recovery rootfs:file create_file_perms;
 allow recovery rootfs:file link;
-')
+
 allow recovery rootfs:dir create_dir_perms;
 
 # Sideload cache
@@ -31,9 +31,9 @@ allow recovery self:process setexec;
 domain_trans(recovery, otapreopt_chroot_exec, backuptool)
 
 # Some addons require this for A/B installation compatibility
-userdebug_or_eng(`
+
 allow recovery system_file:dir mounton;
-')
+
 
 # Volume manager
 allow recovery block_device:dir create_dir_perms;
@@ -51,7 +51,7 @@ allow recovery sysfs_batteryinfo:dir search;
 r_dir_file(recovery, unencrypted_data_file)
 
 # setenforce
-userdebug_or_eng(`
+
 permissive recovery;
-')
+
 ')
diff --git a/common/private/su.te b/common/private/su.te
index ed573a7..5e99f30 100644
--- a/common/private/su.te
+++ b/common/private/su.te
@@ -2,7 +2,7 @@ type superuser_device, file_type, mlstrustedobject;
 
 ## Perms for the daemon
 
-userdebug_or_eng(`
+
   domain_trans(init, su_exec, sudaemon)
 
   typeattribute sudaemon domain, coredomain, mlstrustedsubject;
@@ -44,11 +44,11 @@ userdebug_or_eng(`
   dontaudit sudaemon domain:binder *;
   dontaudit sudaemon property_type:property_service *;
   dontaudit sudaemon appops_service:service_manager *;
-')
+
 
 ## Perms for the app
 
-userdebug_or_eng(`
+
   # Translate user apps to the shell domain when using su
   #
   # PR_SET_NO_NEW_PRIVS blocks this :(
@@ -67,6 +67,6 @@ userdebug_or_eng(`
   allow system_app superuser_device:dir { create rw_dir_perms setattr unlink };
 
   allow kernel sudaemon:fd { use };
-')
 
-neverallow { domain userdebug_or_eng(`-dumpstate -shell -su -untrusted_app_all -init -sudaemon') } su_exec:file no_x_file_perms;
+
+neverallow { domain -dumpstate -shell -su -untrusted_app_all -init -sudaemon } su_exec:file no_x_file_perms;
diff --git a/common/private/sysinit.te b/common/private/sysinit.te
index 9a09004..c0da28e 100644
--- a/common/private/sysinit.te
+++ b/common/private/sysinit.te
@@ -1,15 +1,15 @@
-type sysinit, coredomain, domain;
-type sysinit_exec, exec_type, file_type;
+#type sysinit, coredomain, domain;
+#type sysinit_exec, exec_type, file_type;
 
 # Allow for transition from init domain to sysinit
-init_daemon_domain(sysinit)
-neverallow { domain -init } sysinit:process transition;
+#init_daemon_domain(sysinit)
+#neverallow { domain -init } sysinit:process transition;
 
-userdebug_or_eng(`
-    permissive sysinit;
-')
+#userdebug_or_eng(`
+#    permissive sysinit;
+#')
 
-dontaudit sysinit shell_exec:file rx_file_perms;
-dontaudit sysinit toolbox_exec:file rx_file_perms;
-dontaudit sysinit system_file:file rx_file_perms;
-dontaudit sysinit system_file:dir r_dir_perms;
+#dontaudit sysinit shell_exec:file rx_file_perms;
+#dontaudit sysinit toolbox_exec:file rx_file_perms;
+#dontaudit sysinit system_file:file rx_file_perms;
+#dontaudit sysinit system_file:dir r_dir_perms;

project device/qcom/sepolicy-legacy/
diff --git a/sepolicy.mk b/sepolicy.mk
index 9edc56e..f2d7627 100644
--- a/sepolicy.mk
+++ b/sepolicy.mk
@@ -7,9 +7,9 @@ BOARD_SEPOLICY_DIRS += \
 ifneq (,$(filter userdebug eng, $(TARGET_BUILD_VARIANT)))
 BOARD_SEPOLICY_DIRS += \
     device/qcom/sepolicy-legacy/test
+endif
 
 SELINUX_IGNORE_NEVERALLOWS := true
-endif
 
 BOARD_PLAT_PUBLIC_SEPOLICY_DIR += \
     device/qcom/sepolicy-legacy/public

project external/ant-wireless/ant_native/
diff --git a/Android.mk b/Android.mk
index 3ed9138..111e48d 100644
--- a/Android.mk
+++ b/Android.mk
@@ -82,7 +82,7 @@ LOCAL_C_INCLUDES:= \
 
 LOCAL_C_INCLUDES += frameworks/base/core/jni/include
 
-LOCAL_CFLAGS:= -g -c -W -Wall -O2
+LOCAL_CFLAGS:= -g0 -c -W -Wall -Ofast
 
 LOCAL_SRC_FILES:= \
 	app/ant_app.c
diff --git a/src/bluez_hci/Android.mk b/src/bluez_hci/Android.mk
index 8487cd5..e03fcd7 100644
--- a/src/bluez_hci/Android.mk
+++ b/src/bluez_hci/Android.mk
@@ -16,7 +16,7 @@
 
 include $(CLEAR_VARS)
 
-LOCAL_CFLAGS := -g -c -W -Wall -O2
+LOCAL_CFLAGS := -g0 -c -W -Wall -Ofast
 
 # Check which chip is used so correct values in messages
 ifeq ($(BOARD_ANT_WIRELESS_DEVICE),"wl12xx")
diff --git a/src/bt-vendor_vfs/Android.mk b/src/bt-vendor_vfs/Android.mk
index 733c7bc..4aece50 100644
--- a/src/bt-vendor_vfs/Android.mk
+++ b/src/bt-vendor_vfs/Android.mk
@@ -16,7 +16,7 @@
 
 include $(CLEAR_VARS)
 
-LOCAL_CFLAGS := -g -c -W -Wall -O2
+LOCAL_CFLAGS := -g0 -c -W -Wall -Ofast
 
 # needed to pull in the header file for libbt-vendor.so
 BDROID_DIR:= system/bt
diff --git a/src/qcomm-hidl/Android.mk b/src/qcomm-hidl/Android.mk
index a349bbe..63d4d38 100644
--- a/src/qcomm-hidl/Android.mk
+++ b/src/qcomm-hidl/Android.mk
@@ -17,7 +17,7 @@
 ifneq ($(QCPATH),)
 include $(CLEAR_VARS)
 
-LOCAL_CFLAGS := -g -c -W -Wall -O2
+LOCAL_CFLAGS := -g0 -c -W -Wall -Ofast
 LOCAL_CFLAGS += -Wno-unused-variable
 LOCAL_CFLAGS += -Wno-unused-parameter
 LOCAL_CFLAGS += -Wno-unused-label
diff --git a/src/vfs/Android.mk b/src/vfs/Android.mk
index 28ae431..503e284 100644
--- a/src/vfs/Android.mk
+++ b/src/vfs/Android.mk
@@ -16,7 +16,7 @@
 
 include $(CLEAR_VARS)
 
-LOCAL_CFLAGS := -g -c -W -Wall -O2
+LOCAL_CFLAGS := -g0 -c -W -Wall -Ofast
 
 LOCAL_C_INCLUDES := \
    $(LOCAL_PATH)/src/common/inc \

project external/avb/
diff --git a/Android.bp b/Android.bp
index 4675965..6ae9b9d 100644
--- a/Android.bp
+++ b/Android.bp
@@ -30,13 +30,15 @@ cc_defaults {
         "-Wno-format",
         "-ffunction-sections",
         "-fstack-protector-strong",
-        "-g",
+        "-g0",
         "-DAVB_ENABLE_DEBUG",
         "-DAVB_COMPILATION",
+        "-Ofast",
     ],
     cppflags: [
         "-Wnon-virtual-dtor",
         "-fno-strict-aliasing",
+        "-Ofast",
     ],
     ldflags: [
         "-Wl,--gc-sections",
@@ -95,7 +97,7 @@ cc_library_static {
             srcs: ["libavb/avb_sysdeps_posix.c"],
         },
         linux_glibc: {
-            cflags: ["-fno-stack-protector"],
+            cflags: ["-fno-stack-protector","-Ofast"],
         },
     },
 }
@@ -114,6 +116,7 @@ cc_library_static {
     static_libs: ["libfs_mgr"],
     cflags: [
         "-DAVB_AB_I_UNDERSTAND_LIBAVB_AB_IS_DEPRECATED",
+        "-Ofast",
     ],
     srcs: [
         "libavb/avb_sysdeps_posix.c",
@@ -142,6 +145,7 @@ cc_library_host_static {
     cflags: [
         "-fno-stack-protector",
         "-DAVB_AB_I_UNDERSTAND_LIBAVB_AB_IS_DEPRECATED",
+        "-Ofast",
     ],
     srcs: ["libavb_ab/avb_ab_flow.c"],
 }
@@ -152,6 +156,7 @@ cc_library_host_static {
     export_include_dirs: ["."],
     cflags: [
         "-fno-stack-protector",
+        "-Ofast",
     ],
     srcs: ["libavb_atx/avb_atx_validate.c"],
 }
@@ -213,6 +218,7 @@ cc_library_host_static {
     defaults: ["avb_defaults"],
     cflags: [
         "-DAVB_AB_I_UNDERSTAND_LIBAVB_AB_IS_DEPRECATED",
+        "-Ofast",
     ],
     srcs: ["test/user_code_test.cc"],
 }
@@ -231,6 +237,7 @@ cc_library {
     ],
     cflags: [
         "-DAVB_AB_I_UNDERSTAND_LIBAVB_AB_IS_DEPRECATED",
+        "-Ofast",
     ],
     srcs: ["boot_control/boot_control_avb.c"],
 }

project external/blktrace/
diff --git a/Android.mk b/Android.mk
index 1bdc793..0397881 100644
--- a/Android.mk
+++ b/Android.mk
@@ -7,7 +7,7 @@ LOCAL_PATH := $(call my-dir)
 include $(CLEAR_VARS)
 LOCAL_SRC_FILES := blkparse.c blkparse_fmt.c rbtree.c act_mask.c strverscmp.c
 LOCAL_C_INCLUDES := external/blktrace/
-LOCAL_CFLAGS := -O2 -g -W -Wall -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
+LOCAL_CFLAGS := -Ofast -g0 -W -Wall -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
 LOCAL_MODULE := blkparse
 LOCAL_MODULE_TAGS :=
 LOCAL_SYSTEM_SHARED_LIBRARIES := libc
@@ -16,7 +16,7 @@ include $(BUILD_EXECUTABLE)
 include $(CLEAR_VARS)
 LOCAL_SRC_FILES := blktrace.c act_mask.c
 LOCAL_C_INCLUDES := external/blktrace/
-LOCAL_CFLAGS := -O2 -g -W -Wall -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -D_ANDROID_
+LOCAL_CFLAGS := -Ofast -g0 -W -Wall -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -D_ANDROID_
 LOCAL_MODULE := blktrace
 LOCAL_MODULE_TAGS :=
 LOCAL_SYSTEM_SHARED_LIBRARIES := libc
@@ -25,7 +25,7 @@ include $(BUILD_EXECUTABLE)
 include $(CLEAR_VARS)
 LOCAL_SRC_FILES := verify_blkparse.c
 LOCAL_C_INCLUDES := external/blktrace/
-LOCAL_CFLAGS := -O2 -g -W -Wall -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
+LOCAL_CFLAGS := -Ofast -g0 -W -Wall -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
 LOCAL_MODULE := verify_blkparse
 LOCAL_MODULE_TAGS :=
 LOCAL_SYSTEM_SHARED_LIBRARIES := libc
@@ -34,7 +34,7 @@ include $(BUILD_EXECUTABLE)
 include $(CLEAR_VARS)
 LOCAL_SRC_FILES := blkrawverify.c
 LOCAL_C_INCLUDES := external/blktrace/
-LOCAL_CFLAGS := -O2 -g -W -Wall -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
+LOCAL_CFLAGS := -Ofast -g0 -W -Wall -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
 LOCAL_MODULE := blkrawverify
 LOCAL_MODULE_TAGS :=
 LOCAL_SYSTEM_SHARED_LIBRARIES := libc
@@ -43,7 +43,7 @@ include $(BUILD_EXECUTABLE)
 #include $(CLEAR_VARS)
 #LOCAL_SRC_FILES := blkiomon.c
 #LOCAL_C_INCLUDES := external/blktrace/
-#LOCAL_CFLAGS := -O2 -g -W -Wall -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
+#LOCAL_CFLAGS := -Ofast -g0 -W -Wall -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
 #LOCAL_MODULE := blkiomon
 #LOCAL_MODULE_TAGS :=
 #LOCAL_SYSTEM_SHARED_LIBRARIES := libc

project external/boringssl/
diff --git a/Android.bp b/Android.bp
index fc45c43..f5541ed 100644
--- a/Android.bp
+++ b/Android.bp
@@ -18,11 +18,13 @@ cc_defaults {
         "-D_XOPEN_SOURCE=700",
         "-Werror",
         "-Wno-unused-parameter",
+        "-Ofast",
     ],
 
     cppflags: [
         "-Wall",
         "-Werror",
+        "-Ofast",
     ],
 
     conlyflags: ["-std=c99"],
@@ -41,7 +43,7 @@ cc_defaults {
         },
     },
 
-    cflags: ["-DBORINGSSL_ANDROID_SYSTEM"],
+    cflags: ["-DBORINGSSL_ANDROID_SYSTEM","-Ofast"],
 }
 
 //// libcrypto

project external/brotli/
diff --git a/Android.bp b/Android.bp
index 531a784..38d43f8 100755
--- a/Android.bp
+++ b/Android.bp
@@ -3,7 +3,7 @@ cc_library {
     host_supported: true,
     cflags: [
         "-Werror",
-        "-O2",
+        "-Ofast",
     ],
     export_include_dirs: ["c/include"],
     srcs: [
@@ -22,7 +22,7 @@ cc_library {
 cc_binary {
     name: "brotli",
     host_supported: true,
-    cflags: ["-Werror"],
+    cflags: ["-Werror","-Ofast"],
     srcs: ["c/tools/brotli.c"],
     target: {
         linux_bionic: {

project external/bzip2/
diff --git a/Android.bp b/Android.bp
index 730883d..fb0af98 100644
--- a/Android.bp
+++ b/Android.bp
@@ -23,7 +23,7 @@ cc_library {
         },
     },
     cflags: [
-        "-O3",
+        "-Ofast",
         "-DUSE_MMAP",
         "-Werror",
         "-Wno-unused-parameter",
@@ -50,6 +50,7 @@ cc_binary {
     cflags: [
         "-Werror",
         "-Wno-unused-parameter",
+        "-Ofast",
     ],
     symlinks: [
         "bunzip2",

project external/clang/
diff --git a/lib/Driver/Tools.cpp b/lib/Driver/Tools.cpp
index f1a9f41d53..76b0ba7bed 100644
--- a/lib/Driver/Tools.cpp
+++ b/lib/Driver/Tools.cpp
@@ -11251,7 +11251,7 @@ void NVPTX::Assembler::ConstructJob(Compilation &C, const JobAction &JA,
   } else {
     // If no -O was passed, pass -O0 to ptxas -- no opt flag should correspond
     // to no optimizations, but ptxas's default is -O3.
-    CmdArgs.push_back("-O0");
+    CmdArgs.push_back("-O3");
   }
 
   CmdArgs.push_back("--gpu-name");

project external/cn-cbor/
diff --git a/cmake/Coveralls.cmake b/cmake/Coveralls.cmake
index d60adba..b3e4629 100644
--- a/cmake/Coveralls.cmake
+++ b/cmake/Coveralls.cmake
@@ -114,6 +114,6 @@ macro(coveralls_turn_on_coverage)
 		message(FATAL_ERROR "Coveralls: Code coverage results with an optimised (non-Debug) build may be misleading! Add -DCMAKE_BUILD_TYPE=Debug")
 	endif()
 
-	set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -g -O0 -fprofile-arcs -ftest-coverage")
-	set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -g -O0 -fprofile-arcs -ftest-coverage")
+	set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -g0 -Ofast -fprofile-arcs -ftest-coverage")
+	set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -g0 -Ofast -fprofile-arcs -ftest-coverage")
 endmacro()

project external/curl/
diff --git a/Android.bp b/Android.bp
index ae5a0cc..fd2663c 100644
--- a/Android.bp
+++ b/Android.bp
@@ -22,7 +22,7 @@ cc_defaults {
         // "Android $(PLATFORM_VERSION) $(TARGET_ARCH_VARIANT)"
         // but Soong doesn't have access to those config variables yet.
         "-DOS=\"Android\"",
-        "-Werror",
+        "-Ofast",
         // Bug: http://b/29823425 Disable -Wvarargs for Clang update to r271374
         "-Wno-varargs",
     ],
@@ -58,6 +58,7 @@ cc_library {
     host_supported: true,
     cflags: [
         "-DBUILDING_LIBCURL",
+        "-Ofast",
     ],
     srcs:[
         "lib/rand.c",

project external/exfat/
diff --git a/Android.bp b/Android.bp
index 0db0368..27d6676 100644
--- a/Android.bp
+++ b/Android.bp
@@ -26,6 +26,7 @@ cc_defaults {
         "-D_FILE_OFFSET_BITS=64",
         "-DPACKAGE=\"exfat\"",
         "-DVERSION=\"1.3.0\"",
+        "-Ofast",
     ],
     shared_libs: ["liblog"],
 }
@@ -82,7 +83,7 @@ cc_library_static {
     name: "libexfat_mkfs",
     defaults: ["exfat_defaults"],
     srcs: ["mkfs/*.c"],
-    cflags: ["-Dmain=mkfs_exfat_main"],
+    cflags: ["-Dmain=mkfs_exfat_main","-Ofast",],
     static_libs: ["libexfat"],
 }
 
@@ -90,6 +91,6 @@ cc_library_static {
     name: "libexfat_fsck",
     defaults: ["exfat_defaults"],
     srcs: ["fsck/main.c"],
-    cflags: ["-Dmain=fsck_exfat_main"],
+    cflags: ["-Dmain=fsck_exfat_main","-Ofast",],
     static_libs: ["libexfat"],
 }

project external/fec/
diff --git a/Android.bp b/Android.bp
index a7d74e3..81ca1ce 100644
--- a/Android.bp
+++ b/Android.bp
@@ -11,7 +11,7 @@ cc_library_static {
     cflags: [
         "-Wall",
         "-Werror",
-        "-O3"
+        "-Ofast"
     ],
     export_include_dirs: ["."],
 

project external/fio/
diff --git a/Android.bp b/Android.bp
index 7aacaf41..9159270c 100644
--- a/Android.bp
+++ b/Android.bp
@@ -29,7 +29,7 @@ cc_defaults {
         "-DFIO_INC_DEBUG",
         "-DFIO_INTERNAL",
         "-D_FILE_OFFSET_BITS=64",
-        "-O3",
+        "-Ofast",
         "-Wall",
         "-Werror",
         "-Wdeclaration-after-statement",

project external/flac/
diff --git a/libFLAC/Android.bp b/libFLAC/Android.bp
index d1b51f1..3e01815 100644
--- a/libFLAC/Android.bp
+++ b/libFLAC/Android.bp
@@ -37,7 +37,7 @@ cc_library_static {
         "-DU_COMMON_IMPLEMENTATION",
         "-fPIC",
 
-        "-O3",
+        "-Ofast",
         "-funroll-loops",
         "-finline-functions",
         "-Werror",

project external/freetype/
diff --git a/Android.bp b/Android.bp
index 4b6a34e11..42f090c60 100644
--- a/Android.bp
+++ b/Android.bp
@@ -51,7 +51,7 @@ cc_library_shared {
         "-DDARWIN_NO_CARBON",
         "-DFT2_BUILD_LIBRARY",
 
-        "-O2",
+        "-Ofast",
 
         // Upstream ignores unused parameter warning
         "-Wno-unused-parameter",
diff --git a/builds/compiler/gcc-dev.mk b/builds/compiler/gcc-dev.mk
index 48d284898..2edafd7b6 100644
--- a/builds/compiler/gcc-dev.mk
+++ b/builds/compiler/gcc-dev.mk
@@ -68,7 +68,7 @@ ifndef CFLAGS
     strict_prototypes := -Wstrict-prototypes
   endif
 
-  CFLAGS := -c -g -O0 \
+  CFLAGS := -c -g0 -Ofast \
             -Wall \
             -W \
             -Wundef \

project external/fsck_msdos/
diff --git a/Android.mk b/Android.mk
index 9c48cb1..adb70dd 100644
--- a/Android.mk
+++ b/Android.mk
@@ -2,7 +2,7 @@ LOCAL_PATH := $(call my-dir)
 
 common_src_files := boot.c check.c dir.c fat.c main.c
 common_includes := external/fsck_msdos
-common_cflags := -O2 -g \
+common_cflags := -Ofast -g0 \
     -Wall -Werror \
     -D_BSD_SOURCE \
     -D_LARGEFILE_SOURCE \

project external/giflib/
diff --git a/Android.bp b/Android.bp
index 35705d9..68fc955 100644
--- a/Android.bp
+++ b/Android.bp
@@ -19,6 +19,7 @@ cc_library_static {
         "-Wno-sign-compare",
         "-Wno-unused-parameter",
         "-DHAVE_CONFIG_H",
+        "-Ofast",
     ],
 
     export_include_dirs: ["."],

project external/gptfdisk/
diff --git a/Android.mk b/Android.mk
index db47ce3..d3b2872 100644
--- a/Android.mk
+++ b/Android.mk
@@ -24,7 +24,7 @@ LOCAL_CPP_EXTENSION := .cc
 
 LOCAL_C_INCLUDES := $(LOCAL_PATH) external/e2fsprogs/lib
 LOCAL_SRC_FILES := $(sgdisk_src_files)
-LOCAL_CFLAGS += -Wno-unused-parameter -Wno-pragma-pack -Werror
+LOCAL_CFLAGS += -Wno-unused-parameter -Wno-pragma-pack
 
 LOCAL_SHARED_LIBRARIES := libext2_uuid
 
@@ -38,7 +38,7 @@ ifeq ($(HOST_OS),darwin)
 LOCAL_CFLAGS := -D_FILE_OFFSET_BITS=64 -Doff64_t=off_t
 endif
 LOCAL_C_INCLUDES := $(LOCAL_PATH) external/e2fsprogs/lib
-LOCAL_CFLAGS += -Wno-unused-parameter -Wno-pragma-pack -Werror
+LOCAL_CFLAGS += -Wno-unused-parameter -Wno-pragma-pack
 LOCAL_CFLAGS += -Dmain=sgdisk_main
 LOCAL_SRC_FILES := $(sgdisk_src_files)
 LOCAL_MODULE := libsgdisk_static
@@ -55,7 +55,7 @@ endif
 
 LOCAL_C_INCLUDES := $(LOCAL_PATH) external/e2fsprogs/lib
 LOCAL_SRC_FILES := $(sgdisk_src_files)
-LOCAL_CFLAGS += -Wno-unused-parameter -Wno-pragma-pack -Werror
+LOCAL_CFLAGS += -Wno-unused-parameter -Wno-pragma-pack
 
 LOCAL_SHARED_LIBRARIES := libext2_uuid
 

project external/javasqlite/
diff --git a/Android.bp b/Android.bp
index bf66d5b..f4dde7f 100644
--- a/Android.bp
+++ b/Android.bp
@@ -6,6 +6,7 @@ cc_library_shared {
         "-Werror",
         "-Wno-error=sign-compare",
         "-Wno-unused-parameter",
+        "-Ofast",
     ],
     srcs: ["src/main/native/sqlite_jni.c"],
     static_libs: ["libsqlite_static_minimal"],

project external/jemalloc/
diff --git a/Android.bp b/Android.bp
index 0dd1e94..d9c4aaa 100644
--- a/Android.bp
+++ b/Android.bp
@@ -16,7 +16,7 @@
 
 common_cflags = [
     "-D_REENTRANT",
-    "-O3",
+    "-Ofast",
     "-funroll-loops",
     "-fvisibility=hidden",
     "-Werror",

project external/json-c/
diff --git a/Android.mk b/Android.mk
index 854b8a3..5907c8c 100644
--- a/Android.mk
+++ b/Android.mk
@@ -2,7 +2,7 @@ LIBJSON_ROOT := $(call my-dir)
 include $(CLEAR_VARS)
 LOCAL_MODULE := libjson
 LOCAL_PATH := $(LIBJSON_ROOT)
-LOCAL_CFLAGS := -Werror -Wno-error=unused-parameter
+LOCAL_CFLAGS := -Werror -Wno-error=unused-parameter -Ofast
 LOCAL_COPY_HEADERS_TO := libjson/inc
 LOCAL_COPY_HEADERS := bits.h \
 		config.h \

project external/jsoncpp/
diff --git a/Android.bp b/Android.bp
index 4f16430..96c0f4e 100644
--- a/Android.bp
+++ b/Android.bp
@@ -17,6 +17,7 @@ cc_defaults {
         "-DJSON_USE_EXCEPTION=0",
         "-Wall",
         "-Werror",
+        "-O3",
     ],
 
     target: {

project external/libavc/
diff --git a/Android.bp b/Android.bp
index 4abfa16..c6855b5 100644
--- a/Android.bp
+++ b/Android.bp
@@ -5,7 +5,7 @@ cc_library_static {
 
     cflags: [
         "-fPIC",
-        "-O3",
+        "-Ofast",
         "-Wall",
         "-Werror",
         "-Wno-unused-variable",
@@ -252,7 +252,7 @@ cc_library_static {
         "-DN_MB_ENABLE",
         "-fPIC",
 
-        "-O3",
+        "-Ofast",
         "-Wall",
         "-Werror",
         "-Wno-error=constant-conversion",

project external/libchrome/
diff --git a/Android.bp b/Android.bp
index 9dfffca..c329996 100644
--- a/Android.bp
+++ b/Android.bp
@@ -34,10 +34,10 @@ cc_defaults {
 
     cflags: [
         "-Wall",
-        "-Werror",
         "-Wno-deprecated-declarations",
         "-Wno-missing-field-initializers",
         "-Wno-unused-parameter",
+        "-O3",
     ],
     include_dirs: [
         "external/valgrind/include",
@@ -76,6 +76,7 @@ cc_defaults {
     cflags: [
         "-Wno-unused-function",
         "-Wno-unused-variable",
+        "-O3",
     ],
 
     clang_cflags: [
@@ -599,7 +600,7 @@ cc_test {
         "testrunner.cc",
     ],
 
-    cflags: ["-DUNIT_TEST"],
+    cflags: ["-DUNIT_TEST", "-O3"],
     shared_libs: [
         "libchrome",
         "libevent",

project external/libcups/
diff --git a/Android.bp b/Android.bp
index 4ab57d7..e5e6b87 100644
--- a/Android.bp
+++ b/Android.bp
@@ -75,7 +75,7 @@ cc_library_shared {
 
     cflags: [
         "-D_PPD_DEPRECATED=",
-
+        "-Ofast",
         "-Wextra",
         "-Wall",
         "-Wno-unused-parameter",
@@ -84,7 +84,6 @@ cc_library_shared {
         "-Wno-sign-compare",
         "-Wno-missing-field-initializers",
         "-Wno-implicit-function-declaration",
-        "-Werror",
     ],
 
     export_include_dirs: [

project external/libcxx/
diff --git a/Android.bp b/Android.bp
index 4312e5bf8..25517576e 100644
--- a/Android.bp
+++ b/Android.bp
@@ -52,13 +52,14 @@ cc_library_static {
     ],
     local_include_dirs: ["include"],
     export_include_dirs: ["include"],
-    cflags: ["-Wall", "-Werror", "-Wno-unused-parameter"],
+    cflags: ["-Wall", "-Werror", "-Wno-unused-parameter", "-O3"],
     cppflags: [
         "-std=c++14",
         "-nostdinc++",
         "-fexceptions",
         "-DLIBCXX_BUILDING_LIBCXXABI",
         "-D_LIBCPP_BUILDING_LIBRARY",
+        "-O3",
     ],
     rtti: true,
     whole_static_libs: [
diff --git a/buildcmds/Android.mk b/buildcmds/Android.mk
index b552e0c40..c792ab70a 100644
--- a/buildcmds/Android.mk
+++ b/buildcmds/Android.mk
@@ -36,10 +36,6 @@ LOCAL_CPPFLAGS := \
     -Wno-unused-variable \
     -Wno-format-zero-length \
 
-# Optimization is causing relocation for nothrow new to be thrown away.
-# http://llvm.org/bugs/show_bug.cgi?id=21421
-LOCAL_CPPFLAGS += -O0
-
 LOCAL_RTTI_FLAG := -frtti
 include $(LOCAL_PATH)/testconfig.mk
 

project external/libcxxabi/
diff --git a/Android.bp b/Android.bp
index 167f6b0..c3c51c1 100644
--- a/Android.bp
+++ b/Android.bp
@@ -45,12 +45,14 @@ cc_library_static {
     cflags: [
         "-Wall",
         "-Werror",
+        "-Ofast",
     ],
     cppflags: [
         "-std=c++14",
         "-fexceptions",
         "-Wextra",
         "-Wno-unused-function",
+        "-Ofast",
     ],
     sanitize: {
         never: true,

project external/libevent/
diff --git a/Android.bp b/Android.bp
index 1ceecd5..4202f36 100644
--- a/Android.bp
+++ b/Android.bp
@@ -28,7 +28,7 @@ cc_library {
     },
     cflags: [
         "-D_BSD_SOURCE",
-        "-O3",
+        "-Ofast",
         "-Wno-implicit-function-declaration",
         "-Wno-strict-aliasing",
         "-Wno-unused-parameter",

project external/libexif/
diff --git a/Android.bp b/Android.bp
index 62ba943..e5cc94e 100644
--- a/Android.bp
+++ b/Android.bp
@@ -62,6 +62,7 @@ cc_library_shared {
         "-Wno-switch",
         "-Wno-absolute-value",
         "-Werror",
+        "-Ofast",
     ],
 
     sanitize: {

project external/libffi/
diff --git a/Android.bp b/Android.bp
index 923cb10..78ed580 100644
--- a/Android.bp
+++ b/Android.bp
@@ -30,6 +30,7 @@ cc_library_static {
         "-Wno-pointer-arith",
         "-Wno-sign-compare",
         "-Wno-unused-parameter",
+        "-Ofast",
     ],
     local_include_dirs: ["include"],
     generated_headers: ["ffi_header"],

project external/libgsm/
diff --git a/Android.bp b/Android.bp
index 5ef4777..e863b78 100644
--- a/Android.bp
+++ b/Android.bp
@@ -40,6 +40,7 @@ cc_library_static {
         "-DWAV49",
         "-Werror",
         "-Wno-unused-parameter",
+        "-Ofast",
     ],
 
     export_include_dirs: ["inc"],

project external/libhevc/
diff --git a/Android.bp b/Android.bp
index d74fb76..74bcd6b 100644
--- a/Android.bp
+++ b/Android.bp
@@ -6,11 +6,9 @@ cc_library_static {
         "-D_LIB",
         "-DMULTICORE",
         "-fPIC",
-
-        "-O3",
+        "-Ofast",
         "-DANDROID",
         "-Wall",
-        "-Werror",
         // common/x86/ihevc_sao_ssse3_intr.c: implicit conversion from
         // 'int' to 'char' changes value from 128 to -128
         "-Wno-error=constant-conversion",
@@ -89,7 +87,7 @@ cc_library_static {
                 "-DDISABLE_NEONINTR",
                 "-DARM",
                 "-DARMGCC",
-
+                "-Ofast",
                 "-DDEFAULT_ARCH=D_ARCH_ARMV8_GENERIC",
             ],
             local_include_dirs: [
@@ -189,7 +187,7 @@ cc_library_static {
                 "-DARM",
                 "-DARMGCC",
                 "-fno-tree-vectorize",
-
+                "-Ofast",
                 // These will be overriden by armv7_a_neon
                 "-DDISABLE_NEON",
                 "-DDEFAULT_ARCH=D_ARCH_ARM_NONEON",
@@ -272,6 +270,7 @@ cc_library_static {
                     "-UDISABLE_NEON",
                     "-UDEFAULT_ARCH",
                     "-DDEFAULT_ARCH=D_ARCH_ARM_A9Q",
+                    "-Ofast",
                 ],
             },
         },
@@ -307,6 +306,7 @@ cc_library_static {
                 "-msse4.2",
                 "-mno-avx",
                 "-DDEFAULT_ARCH=D_ARCH_X86_SSE42",
+                "-Ofast",
             ],
 
             local_include_dirs: [
@@ -351,6 +351,7 @@ cc_library_static {
                 "-msse4.2",
                 "-mno-avx",
                 "-DDEFAULT_ARCH=D_ARCH_X86_SSE42",
+                "-Ofast",
             ],
 
             local_include_dirs: [

project external/libjpeg-turbo/
diff --git a/Android.bp b/Android.bp
index 1c5d924..2b72162 100644
--- a/Android.bp
+++ b/Android.bp
@@ -3,7 +3,7 @@
 cc_defaults {
     name: "libjpeg-defaults",
     cflags: [
-        "-O3",
+        "-Ofast",
         "-fstrict-aliasing",
 
         "-Wno-sign-compare",
@@ -213,6 +213,7 @@ cc_binary {
         "-DPPM_SUPPORTED",
         "-Wno-unused-parameter",
         "-Werror",
+        "-Ofast",
     ],
 
     srcs: [

project external/libldac/
diff --git a/Android.bp b/Android.bp
index 97420a3..18a75eb 100644
--- a/Android.bp
+++ b/Android.bp
@@ -16,7 +16,7 @@ cc_library_shared {
     ],
     // -D_32BIT_FIXED_POINT should be added to cflags for devices without a FPU
     // unit such as ARM Cortex-R series or external 32-bit DSPs.
-    cflags: ["-O2", "-Werror", "-Wall", "-Wextra"],
+    cflags: ["-Ofast", "-Werror", "-Wall", "-Wextra"],
 }
 
 cc_library_shared {
@@ -33,5 +33,5 @@ cc_library_shared {
     export_include_dirs: ["abr/inc"],
     srcs: ["abr/src/ldacBT_abr.c"],
     shared_libs: ["libldacBT_enc"],
-    cflags: ["-O2", "-Werror", "-Wall", "-Wextra"]
+    cflags: ["-Ofast", "-Werror", "-Wall", "-Wextra"]
 }

project external/libmicrohttpd/
diff --git a/Android.mk b/Android.mk
index 84ebd2d..4ea177b 100644
--- a/Android.mk
+++ b/Android.mk
@@ -24,6 +24,7 @@ LOCAL_CFLAGS := \
     -Wno-tautological-constant-out-of-range-compare \
     -Wno-unused-parameter \
     -Wno-unused-variable \
+    -Ofast
 
 LOCAL_EXPORT_C_INCLUDE_DIRS := $(LOCAL_PATH)/src/include
 

project external/libmpeg2/
diff --git a/Android.bp b/Android.bp
index c5487c3..81812bd 100644
--- a/Android.bp
+++ b/Android.bp
@@ -8,7 +8,7 @@ cc_library_static {
         "-DMULTICORE",
         "-fPIC",
 
-        "-O3",
+        "-Ofast",
         "-DANDROID",
         "-Werror",
     ],
@@ -82,6 +82,7 @@ cc_library_static {
                     "-UDISABLE_NEON",
                     "-UDEFAULT_ARCH",
                     "-DDEFAULT_ARCH=D_ARCH_ARM_A9Q",
+                    "-Ofast",
                 ],
             },
 
@@ -89,7 +90,7 @@ cc_library_static {
                 "-DDISABLE_NEONINTR",
                 "-DARM",
                 "-DARMGCC",
-
+                "-Ofast",
                 // These are overriden by armv7_a_neon
                 "-DDISABLE_NEON",
                 "-DDEFAULT_ARCH=D_ARCH_ARM_NONEON",
@@ -103,7 +104,7 @@ cc_library_static {
                 "-DDISABLE_NEONINTR",
                 "-DARM",
                 "-DARMGCC",
-
+                "-Ofast",
                 "-DDEFAULT_ARCH=D_ARCH_ARMV8_GENERIC",
             ],
             local_include_dirs: [
@@ -153,6 +154,7 @@ cc_library_static {
                 "-msse4.2",
                 "-mno-avx",
                 "-DDEFAULT_ARCH=D_ARCH_X86_SSE42",
+                "-Ofast",
             ],
 
             local_include_dirs: [
@@ -185,6 +187,7 @@ cc_library_static {
                 "-msse4.2",
                 "-mno-avx",
                 "-DDEFAULT_ARCH=D_ARCH_X86_SSE42",
+                "-Ofast",
             ],
 
             local_include_dirs: [

project external/libogg/
diff --git a/Android.bp b/Android.bp
index 01f038b..a240661 100644
--- a/Android.bp
+++ b/Android.bp
@@ -6,7 +6,7 @@ cc_library_static {
         "src/framing.c",
     ],
 
-    cflags: ["-Wall", "-Werror"],
+    cflags: ["-Wall", "-Werror", "-Ofast"],
 
     export_include_dirs: ["include"],
 

project external/libopus/
diff --git a/Android.bp b/Android.bp
index 82f6a7c..2c01ef6 100644
--- a/Android.bp
+++ b/Android.bp
@@ -167,7 +167,7 @@ cc_library_shared {
         "-DUSE_ALLOCA",
         "-DHAVE_LRINT",
         "-DHAVE_LRINTF",
-        "-O2",
+        "-Ofast",
         "-fno-math-errno",
         "-Wall",
         "-Werror",
@@ -175,7 +175,7 @@ cc_library_shared {
     cppflags: [
         "-DBSD=1",
         "-ffast-math",
-        "-O2",
+        "-Ofast",
         "-funroll-loops",
     ],
 

project external/libpcap/
diff --git a/Android.bp b/Android.bp
index 1d3a5cb..a67a82b 100644
--- a/Android.bp
+++ b/Android.bp
@@ -20,7 +20,7 @@ cc_defaults {
         "-Dlint",
         "-D_U_=__attribute__((__unused__))",
         "-Wall",
-        "-Werror",
+        "-Ofast",
         "-Wno-macro-redefined",
         "-Wno-pointer-arith",
         "-Wno-sign-compare",

project external/libpng/
diff --git a/Android.bp b/Android.bp
index aea02bf..dc27264 100644
--- a/Android.bp
+++ b/Android.bp
@@ -25,6 +25,7 @@ cc_defaults {
         "-Wall",
         "-Werror",
         "-Wno-unused-parameter",
+        "-Ofast",
     ],
     arch: {
         arm: {
@@ -94,7 +95,7 @@ cc_library {
 cc_library_static {
     name: "libpng_ndk",
     defaults: ["libpng-defaults"],
-    cflags: ["-ftrapv"],
+    cflags: ["-ftrapv", "-Ofast"],
 
     shared_libs: ["libz"],
     sdk_version: "14",

project external/libusb/
diff --git a/Android.bp b/Android.bp
index e0fd619..d7cab56 100644
--- a/Android.bp
+++ b/Android.bp
@@ -21,6 +21,7 @@ cc_library {
         "-Wall",
         "-Wno-error=sign-compare",
         "-Wno-error=switch",
+        "-Ofast",
     ],
 
     target: {

project external/libvpx/
diff --git a/Android.bp b/Android.bp
index 432246f..9b31075 100644
--- a/Android.bp
+++ b/Android.bp
@@ -1601,7 +1601,7 @@ cc_library_static {
     },
 
     cflags: [
-        "-O3",
+        "-Ofast",
         "-Wno-unused-parameter",
     ],
 
diff --git a/Android.bp.in b/Android.bp.in
index 0fb7c95..f16b40c 100644
--- a/Android.bp.in
+++ b/Android.bp.in
@@ -83,7 +83,7 @@ cc_library_static {
     },
 
     cflags: [
-        "-O3",
+        "-Ofast",
         "-Wno-unused-parameter",
     ],
 

project external/libxaac/
diff --git a/Android.bp b/Android.bp
index 6f1d23c..4fb8850 100644
--- a/Android.bp
+++ b/Android.bp
@@ -7,7 +7,7 @@ cc_library_static {
     },
 
     cflags: [
-        "-O3"
+        "-Ofast"
     ],
 
     export_include_dirs: [

project external/linux-kselftest/
diff --git a/Android.bp b/Android.bp
index 6cf8cf1129ff..bb7ed130981f 100644
--- a/Android.bp
+++ b/Android.bp
@@ -267,7 +267,7 @@ cc_test {
         "tools/testing/selftests/timers/valid-adjtimex.c",
     ],
     cflags: [
-        "-O3",
+        "-Ofast",
         "-DKTEST",
     ],
     defaults: ["kselftest_defaults"],
@@ -351,7 +351,7 @@ cc_test {
         },
     },
     cflags: [
-        "-O2",
+        "-Ofast",
         "-pthread",
     ],
     c_std: "gnu99",
@@ -374,7 +374,7 @@ cc_test {
         },
     },
     cflags: [
-        "-O2",
+        "-Ofast",
         "-pthread",
     ],
     c_std: "gnu99",
@@ -395,7 +395,7 @@ cc_test {
         "tools/testing/selftests/x86/raw_syscall_helper_32.S",
     ],
     cflags: [
-        "-O2",
+        "-Ofast",
         "-pthread",
     ],
     c_std: "gnu99",
@@ -418,7 +418,7 @@ cc_test {
         "tools/testing/selftests/x86/thunks_32.S",
     ],
     cflags: [
-        "-O2",
+        "-Ofast",
         "-pthread",
     ],
     c_std: "gnu99",

project external/llvm/
diff --git a/Android.bp b/Android.bp
index e81c5b49b3c..77ba3567cc4 100644
--- a/Android.bp
+++ b/Android.bp
@@ -32,11 +32,13 @@ llvm_defaults {
         "-Wwrite-strings",
         "-Werror",
         "-Dsprintf=sprintf",
+        "-O3",
     ],
 
     cppflags: [
         "-Wno-sign-promo",
         "-std=c++11",
+        "-O3",
     ],
 
     clang_cflags: [

project external/lz4/
diff --git a/Makefile b/Makefile
index 1432e6b..7f3cf4f 100644
--- a/Makefile
+++ b/Makefile
@@ -106,21 +106,21 @@ test:
 
 clangtest: clean
 	clang -v
-	@CFLAGS="-O3 -Werror -Wconversion -Wno-sign-conversion" $(MAKE) -C $(LZ4DIR)  all CC=clang
-	@CFLAGS="-O3 -Werror -Wconversion -Wno-sign-conversion" $(MAKE) -C $(PRGDIR)  all CC=clang
-	@CFLAGS="-O3 -Werror -Wconversion -Wno-sign-conversion" $(MAKE) -C $(TESTDIR) all CC=clang
+	@CFLAGS="-Ofast -Werror -Wconversion -Wno-sign-conversion" $(MAKE) -C $(LZ4DIR)  all CC=clang
+	@CFLAGS="-Ofast -Werror -Wconversion -Wno-sign-conversion" $(MAKE) -C $(PRGDIR)  all CC=clang
+	@CFLAGS="-Ofast -Werror -Wconversion -Wno-sign-conversion" $(MAKE) -C $(TESTDIR) all CC=clang
 
 clangtest-native: clean
 	clang -v
-	@CFLAGS="-O3 -Werror -Wconversion -Wno-sign-conversion" $(MAKE) -C $(LZ4DIR)  all    CC=clang
-	@CFLAGS="-O3 -Werror -Wconversion -Wno-sign-conversion" $(MAKE) -C $(PRGDIR)  native CC=clang
-	@CFLAGS="-O3 -Werror -Wconversion -Wno-sign-conversion" $(MAKE) -C $(TESTDIR) native CC=clang
+	@CFLAGS="-Ofast -Werror -Wconversion -Wno-sign-conversion" $(MAKE) -C $(LZ4DIR)  all    CC=clang
+	@CFLAGS="-Ofast -Werror -Wconversion -Wno-sign-conversion" $(MAKE) -C $(PRGDIR)  native CC=clang
+	@CFLAGS="-Ofast -Werror -Wconversion -Wno-sign-conversion" $(MAKE) -C $(TESTDIR) native CC=clang
 
 usan: clean
-	CC=clang CFLAGS="-O3 -g -fsanitize=undefined" $(MAKE) test FUZZER_TIME="-T1mn" NB_LOOPS=-i1
+	CC=clang CFLAGS="-Ofast -g -fsanitize=undefined" $(MAKE) test FUZZER_TIME="-T1mn" NB_LOOPS=-i1
 
 usan32: clean
-	CFLAGS="-m32 -O3 -g -fsanitize=undefined" $(MAKE) test FUZZER_TIME="-T1mn" NB_LOOPS=-i1
+	CFLAGS="-m32 -Ofast -g -fsanitize=undefined" $(MAKE) test FUZZER_TIME="-T1mn" NB_LOOPS=-i1
 
 staticAnalyze: clean
 	CFLAGS=-g scan-build --status-bugs -v $(MAKE) all
@@ -128,9 +128,9 @@ staticAnalyze: clean
 platformTest: clean
 	@echo "\n ---- test lz4 with $(CC) compiler ----"
 	@$(CC) -v
-	CFLAGS="-O3 -Werror"         $(MAKE) -C $(LZ4DIR) all
-	CFLAGS="-O3 -Werror -static" $(MAKE) -C $(PRGDIR) all
-	CFLAGS="-O3 -Werror -static" $(MAKE) -C $(TESTDIR) all
+	CFLAGS="-Ofast -Werror"         $(MAKE) -C $(LZ4DIR) all
+	CFLAGS="-Ofast -Werror -static" $(MAKE) -C $(PRGDIR) all
+	CFLAGS="-Ofast -Werror -static" $(MAKE) -C $(TESTDIR) all
 	$(MAKE) -C $(TESTDIR) test-platform
 
 versionsTest: clean
@@ -160,15 +160,15 @@ cmake:
 
 gpptest: clean
 	g++ -v
-	CC=g++ $(MAKE) -C $(LZ4DIR)  all CFLAGS="-O3 -Wall -Wextra -Wundef -Wshadow -Wcast-align -Werror"
-	CC=g++ $(MAKE) -C $(PRGDIR)  all CFLAGS="-O3 -Wall -Wextra -Wundef -Wshadow -Wcast-align -Werror"
-	CC=g++ $(MAKE) -C $(TESTDIR) all CFLAGS="-O3 -Wall -Wextra -Wundef -Wshadow -Wcast-align -Werror"
+	CC=g++ $(MAKE) -C $(LZ4DIR)  all CFLAGS="-Ofast -Wall -Wextra -Wundef -Wshadow -Wcast-align -Werror"
+	CC=g++ $(MAKE) -C $(PRGDIR)  all CFLAGS="-Ofast -Wall -Wextra -Wundef -Wshadow -Wcast-align -Werror"
+	CC=g++ $(MAKE) -C $(TESTDIR) all CFLAGS="-Ofast -Wall -Wextra -Wundef -Wshadow -Wcast-align -Werror"
 
 gpptest32: clean
 	g++ -v
-	CC=g++ $(MAKE) -C $(LZ4DIR)  all    CFLAGS="-m32 -O3 -Wall -Wextra -Wundef -Wshadow -Wcast-align -Werror"
-	CC=g++ $(MAKE) -C $(PRGDIR)  native CFLAGS="-m32 -O3 -Wall -Wextra -Wundef -Wshadow -Wcast-align -Werror"
-	CC=g++ $(MAKE) -C $(TESTDIR) native CFLAGS="-m32 -O3 -Wall -Wextra -Wundef -Wshadow -Wcast-align -Werror"
+	CC=g++ $(MAKE) -C $(LZ4DIR)  all    CFLAGS="-m32 -Ofast -Wall -Wextra -Wundef -Wshadow -Wcast-align -Werror"
+	CC=g++ $(MAKE) -C $(PRGDIR)  native CFLAGS="-m32 -Ofast -Wall -Wextra -Wundef -Wshadow -Wcast-align -Werror"
+	CC=g++ $(MAKE) -C $(TESTDIR) native CFLAGS="-m32 -Ofast -Wall -Wextra -Wundef -Wshadow -Wcast-align -Werror"
 
 c_standards: clean
 	$(MAKE) all MOREFLAGS="-std=gnu90 -Werror"

project external/mdnsresponder/
diff --git a/Android.bp b/Android.bp
index 68a7959..5966f76 100644
--- a/Android.bp
+++ b/Android.bp
@@ -7,8 +7,8 @@ cc_defaults {
     name: "mdnsresponder_default_cflags",
 
     cflags: [
-        "-O2",
-        "-g",
+        "-Ofast",
+        "-g0",
         "-fno-strict-aliasing",
         "-fwrapv",
         "-D_GNU_SOURCE",

project external/minijail/
diff --git a/common.mk b/common.mk
index 77879d8..0efed60 100644
--- a/common.mk
+++ b/common.mk
@@ -320,7 +320,7 @@ endif
 COMMON_CFLAGS-gcc := -fvisibility=internal -ggdb3 -Wa,--noexecstack
 COMMON_CFLAGS-clang := -fvisibility=hidden -ggdb
 COMMON_CFLAGS := -Wall -Wunused -Wno-unused-parameter -Werror -Wformat=2 \
-  -fno-strict-aliasing $(SSP_CFLAGS) -O1
+  -fno-strict-aliasing $(SSP_CFLAGS) -Ofast
 CXXFLAGS += $(COMMON_CFLAGS) $(COMMON_CFLAGS-$(CXXDRIVER)) -std=gnu++14
 CFLAGS += $(COMMON_CFLAGS) $(COMMON_CFLAGS-$(CDRIVER)) -std=gnu11
 CPPFLAGS += -D_FORTIFY_SOURCE=2
@@ -336,8 +336,8 @@ endif
 
 ifeq ($(MODE),opt)
   # Up the optimizations.
-  CFLAGS := $(filter-out -O1,$(CFLAGS)) -O2
-  CXXFLAGS := $(filter-out -O1,$(CXXFLAGS)) -O2
+  CFLAGS := $(filter-out -Ofast,$(CFLAGS)) -Ofast
+  CXXFLAGS := $(filter-out -Ofast,$(CXXFLAGS)) -Ofast
   # Only drop -g* if symbols aren't desired.
   ifeq ($(NOSTRIP),0)
     # TODO: do we want -fomit-frame-pointer on x86?
@@ -347,8 +347,8 @@ ifeq ($(MODE),opt)
 endif
 
 ifeq ($(MODE),profiling)
-  CFLAGS := $(CFLAGS) -O0 -g  --coverage
-  CXXFLAGS := $(CXXFLAGS) -O0 -g  --coverage
+  CFLAGS := $(CFLAGS) -Ofast -g0  --coverage
+  CXXFLAGS := $(CXXFLAGS) -Ofast -g0  --coverage
   LDFLAGS := $(LDFLAGS) --coverage
 endif
 

project external/mksh/
diff --git a/Android.bp b/Android.bp
index 94c499c..2042ba5 100644
--- a/Android.bp
+++ b/Android.bp
@@ -34,7 +34,7 @@ cc_defaults {
         "-fno-strict-aliasing",
         "-fstack-protector",
         "-fwrapv",
-
+        "-Ofast",
         // ...various options we choose
         "-DDEBUG_LEAKS",
         "-DMKSH_ASSUME_UTF8",
@@ -121,6 +121,7 @@ cc_defaults {
 cc_binary {
     name: "sh",
     defaults: ["sh-defaults"],
+    cflags: ["-Ofast"],
 }
 
 cc_binary {
@@ -137,12 +138,14 @@ cc_binary {
         "-DMKSHRC_PATH=\"/vendor/etc/mkshrc\"",
         "-DMKSH_DEFAULT_EXECSHELL=\"/vendor/bin/sh\"",
         "-DMKSH_DEFPATH_OVERRIDE=\"/vendor/bin:/vendor/xbin\"",
+        "-Ofast",
     ],
 }
 
 cc_library_static {
     name: "libmksh",
     defaults: ["sh-defaults"],
+    cflags: ["-Ofast"]
 }
 
 cc_library_static {
@@ -158,7 +161,7 @@ cc_library_static {
         "-fno-strict-aliasing",
         "-fstack-protector",
         "-fwrapv",
-
+        "-Ofast",
         // ...various options we choose
         "-DDEBUG_LEAKS",
         "-DMKSH_ASSUME_UTF8",
diff --git a/mkshrc b/mkshrc
index 4cc8bac..ae4857b 100644
--- a/mkshrc
+++ b/mkshrc
@@ -1,18 +1,25 @@
-# Copyright (c) 2010, 2012, 2013, 2014
-#	Thorsten Glaser <tg@mirbsd.org>
+# Copyright (c) 2010
+#	Thorsten Glaser <t.glaser@tarent.de>
 # This file is provided under the same terms as mksh.
 #-
 # Minimal /system/etc/mkshrc for Android
-#
-# Support: https://launchpad.net/mksh
 
+: ${TERM:=xterm-256color} ${HOME:=/} ${MKSH:=/system/bin/sh} ${HOSTNAME:=android}
+: ${SHELL:=$MKSH} ${USER:=$(getprop ro.product.device)}
 if (( USER_ID )); then PS1='$'; else PS1='#'; fi
-PS4='[$EPOCHREALTIME] '; PS1='${|
-	local e=$?
 
-	(( e )) && REPLY+="$e|"
+PS1='$USER@$HOSTNAME:${PWD:-?} '"$PS1 "
+if [ -d "/sbin/.magisk/busybox" ]; then
+  BBDIR="/sbin/.magisk/busybox"
+elif [ -d "/sbin/.core/busybox" ]; then
+  BBDIR="/sbin/.core/busybox"
+fi
+PATH=$PATH:/sbin:$BBDIR:.
+export TERM HOME MKSH HOSTNAME SHELL USER PATH
 
-	return $e
-}$HOSTNAME:${PWD:-?} '"$PS1 "
+for p in ~/.bin; do
+	[[ -d $p/. ]] || continue
+	[[ :$PATH: = *:$p:* ]] || PATH=$p:$PATH
+done
 
-export TERM=xterm-256color
\ No newline at end of file
+unset p

project external/mtpd/
diff --git a/Android.bp b/Android.bp
index 064b0c8..2ac0b92 100644
--- a/Android.bp
+++ b/Android.bp
@@ -29,6 +29,7 @@ cc_binary {
         "-DANDROID_CHANGES",
         "-Wall",
         "-Werror",
+        "-Ofast",
     ],
     init_rc: ["mtpd.rc"],
 }

project external/netcat/
diff --git a/Android.mk b/Android.mk
index 0636929..1ce4c68 100644
--- a/Android.mk
+++ b/Android.mk
@@ -7,7 +7,7 @@ LOCAL_SRC_FILES:=\
 
 
 LOCAL_CFLAGS:= \
-    -O2 -g \
+    -Ofast -g0 \
     -Wall -Werror \
     -Wno-deprecated-declarations \
     -Wno-sign-compare \

project external/noto-fonts/
diff --git a/Android.mk b/Android.mk
index 3cfee0c..ed35072 100644
--- a/Android.mk
+++ b/Android.mk
@@ -41,28 +41,13 @@ ifneq ($(MINIMAL_FONT_FOOTPRINT),true)
 LOCAL_PATH := $(NOTO_DIR)/cjk
 
 font_src_files := \
-    NotoSansCJK-Regular.ttc
+    NotoSansCJK.ttc
 
 $(foreach f, $(font_src_files), $(call build-one-font-module, $(f)))
 font_src_files :=
 
 endif # !MINIMAL_FONT_FOOTPRINT
 
-#############################################################################
-# Similary "build" the Noto CJK fonts for serif family.
-# These are not included in SMALLER_FONT_FOOTPRINT builds.
-#############################################################################
-ifeq ($(filter true,$(EXCLUDE_SERIF_FONTS) $(SMALLER_FONT_FOOTPRINT)),)
-LOCAL_PATH := $(NOTO_DIR)/cjk
-
-font_src_files := \
-    NotoSerifCJK-Regular.ttc
-
-$(foreach f, $(font_src_files), $(call build-one-font-module, $(f)))
-font_src_files :=
-
-endif # !EXCLUDE_SERIF_FONTS && !SMALLER_FONT_FOOTPRINT
-
 #############################################################################
 # Now "build" the Noto Color Emoji font, which is in its own directory. It is
 # not included in the MINIMAL_FONT_FOOTPRINT builds.
diff --git a/fonts.mk b/fonts.mk
index fea0aef..abf40ea 100644
--- a/fonts.mk
+++ b/fonts.mk
@@ -46,7 +46,7 @@ PRODUCT_PACKAGES := \
     NotoSansCham-Bold.ttf \
     NotoSansCham-Regular.ttf \
     NotoSansCherokee-Regular.ttf \
-    NotoSansCJK-Regular.ttc \
+    NotoSansCJK.ttc \
     NotoSansCoptic-Regular.ttf \
     NotoSansCuneiform-Regular.ttf \
     NotoSansCypriot-Regular.ttf \
@@ -191,7 +191,6 @@ PRODUCT_PACKAGES := \
     NotoSerifArmenian-Regular.ttf \
     NotoSerifBengali-Bold.ttf \
     NotoSerifBengali-Regular.ttf \
-    NotoSerifCJK-Regular.ttc \
     NotoSerifDevanagari-Bold.ttf \
     NotoSerifDevanagari-Regular.ttf \
     NotoSerifEthiopic-Bold.otf \
diff --git a/other/NotoSerif-Bold.ttf b/other/NotoSerif-Bold.ttf
index 2ffdf8c..128288b 100644
Binary files a/other/NotoSerif-Bold.ttf and b/other/NotoSerif-Bold.ttf differ
diff --git a/other/NotoSerif-Regular.ttf b/other/NotoSerif-Regular.ttf
index 9d9a347..78136ac 100644
Binary files a/other/NotoSerif-Regular.ttf and b/other/NotoSerif-Regular.ttf differ

project external/ntfs-3g/
diff --git a/Android.bp b/Android.bp
index a0bbf008..f19051b9 100644
--- a/Android.bp
+++ b/Android.bp
@@ -24,6 +24,7 @@ cc_defaults {
         "-D_LARGEFILE_SOURCE",
         "-D_FILE_OFFSET_BITS=64",
         "-DHAVE_CONFIG_H",
+        "-Ofast",
     ],
     tags: ["optional"],
 }

project external/openssh/
diff --git a/Android.mk b/Android.mk
index 2593bbc3..1b32422d 100644
--- a/Android.mk
+++ b/Android.mk
@@ -126,7 +126,7 @@ LOCAL_SHARED_LIBRARIES += libssl libcrypto libdl libz
 LOCAL_MODULE := libssh
 
 LOCAL_CFLAGS += \
-    -O3 \
+    -Ofast \
     -Wno-macro-redefined \
     -Wno-pointer-sign \
     -Wno-sign-compare \

project external/p7zip/
diff --git a/Android.mk b/Android.mk
index c05b093..1bd3df5 100644
--- a/Android.mk
+++ b/Android.mk
@@ -1,7 +1,7 @@
 LOCAL_PATH := $(call my-dir)
 
 common_cflags := \
-    -O3 \
+    -Ofast \
     -DANDROID_NDK \
     -DNDEBUG \
     -D_REENTRANT \

project external/pdfium/
diff --git a/Android.bp b/Android.bp
index d11b36e..f97a230 100644
--- a/Android.bp
+++ b/Android.bp
@@ -1,7 +1,7 @@
 cc_defaults {
     name: "pdfium-common",
     cflags: [
-        "-O3",
+        "-Ofast",
         "-fstrict-aliasing",
         "-fprefetch-loop-arrays",
         "-fexceptions",

project external/perfetto/
diff --git a/Android.bp b/Android.bp
index 93919262..f04cbcf6 100644
--- a/Android.bp
+++ b/Android.bp
@@ -230,7 +230,7 @@ cc_binary {
 cc_defaults {
   name: "perfetto_defaults",
   cflags: [
-    "-Oz",
+    "-O3",
     "-Wno-error=return-type",
     "-Wno-sign-compare",
     "-Wno-sign-promo",
@@ -3810,37 +3810,8 @@ cc_binary_host {
 }
 
 // GN target: //:traced
-cc_binary {
-  name: "traced",
-  srcs: [
-    "src/traced/service/main.cc",
-  ],
-  shared_libs: [
-    "liblog",
-    "libtraced_shared",
-  ],
-  init_rc: [
-    "perfetto.rc",
-  ],
-  defaults: [
-    "perfetto_defaults",
-  ],
-}
 
 // GN target: //:traced_probes
-cc_binary {
-  name: "traced_probes",
-  srcs: [
-    "src/traced/probes/main.cc",
-  ],
-  shared_libs: [
-    "liblog",
-    "libtraced_shared",
-  ],
-  defaults: [
-    "perfetto_defaults",
-  ],
-}
 
 // These targets are appended to the autogenerated Android.bp by tools/gen_android_bp.
 cc_library_static {
@@ -3896,4 +3867,4 @@ cc_library_static {
   cflags: [
     "-DPERFETTO_BUILD_WITH_ANDROID",
   ],
-}
\ No newline at end of file
+}

project external/pigz/
diff --git a/Makefile b/Makefile
index c31bd80..2da74ea 100644
--- a/Makefile
+++ b/Makefile
@@ -1,5 +1,5 @@
 CC=gcc
-CFLAGS=-O3 -Wall -Wextra -Wno-unknown-pragmas
+CFLAGS=-Ofast -Wall -Wextra -Wno-unknown-pragmas
 LDFLAGS=
 LIBS=-lm -lpthread -lz
 ZOPFLI=zopfli/src/zopfli/

project external/puffin/
diff --git a/Makefile b/Makefile
index ae86afd..bdfdb80 100644
--- a/Makefile
+++ b/Makefile
@@ -32,7 +32,7 @@ UNITTEST_OBJECTS = $(addprefix $(OBJDIR)/, $(UNITTEST_SOURCES:.cc=.o))
 LIBPUFFIN = libpuffin.so
 UNITTESTS = puffin_unittests
 
-CXXFLAGS ?= -O3 -ggdb
+CXXFLAGS ?= -Ofast -g0
 CXXFLAGS += -Wall -fPIC -std=c++11
 CPPFLAGS += -I../ -Isrc/include
 LDLIBS = -lgflags -lglog -lprotobuf-lite -lgtest -lpthread

project external/sfntly/
diff --git a/Android.bp b/Android.bp
index 862ae81..1c74f63 100644
--- a/Android.bp
+++ b/Android.bp
@@ -84,7 +84,7 @@ cc_library_static {
         "-Wno-extra",
         "-Wno-ignored-qualifiers",
         "-Wno-type-limits",
-        "-Os",
+        "-Ofast",
         "-fno-ident",
         "-fdata-sections",
         "-ffunction-sections",

project external/skia/
diff --git a/Android.bp b/Android.bp
index 4001deb6a5..08ab865fba 100644
--- a/Android.bp
+++ b/Android.bp
@@ -58,6 +58,7 @@ cc_library_static {
         "-Wsign-compare",
         "-Wvla",
         "-fvisibility=hidden",
+        "-Ofast",
     ],
 
     cppflags:[
@@ -68,6 +69,7 @@ cc_library_static {
         "-Wno-weak-vtables",
         "-Wnon-virtual-dtor",
         "-fexceptions",
+        "-Ofast",
     ],
 
     export_include_dirs: [
@@ -978,6 +980,7 @@ cc_defaults {
     cflags: [
         "-Wno-unused-parameter",
         "-Wno-unused-variable",
+        "-Ofast",
     ],
 }
 
diff --git a/src/jumper/build_stages.py b/src/jumper/build_stages.py
index d4d598264a..86f1c0ef50 100755
--- a/src/jumper/build_stages.py
+++ b/src/jumper/build_stages.py
@@ -28,7 +28,7 @@ generated_win = sys.argv[7] if len(sys.argv) > 7 else generated_win
 clang = [ccache, clang, '-x', 'c++']
 
 
-cflags = ['-std=c++11', '-Os', '-DJUMPER_IS_OFFLINE',
+cflags = ['-std=c++11', '-Ofast', '-DJUMPER_IS_OFFLINE',
           '-momit-leaf-frame-pointer', '-ffp-contract=fast',
           '-fno-exceptions', '-fno-rtti', '-fno-unwind-tables']
 

project external/skqp/
diff --git a/src/jumper/build_stages.py b/src/jumper/build_stages.py
index d4d5982..86f1c0e 100755
--- a/src/jumper/build_stages.py
+++ b/src/jumper/build_stages.py
@@ -28,7 +28,7 @@ generated_win = sys.argv[7] if len(sys.argv) > 7 else generated_win
 clang = [ccache, clang, '-x', 'c++']
 
 
-cflags = ['-std=c++11', '-Os', '-DJUMPER_IS_OFFLINE',
+cflags = ['-std=c++11', '-Ofast', '-DJUMPER_IS_OFFLINE',
           '-momit-leaf-frame-pointer', '-ffp-contract=fast',
           '-fno-exceptions', '-fno-rtti', '-fno-unwind-tables']
 

project external/speex/
diff --git a/Android.bp b/Android.bp
index 4fd0d46..8083dd1 100644
--- a/Android.bp
+++ b/Android.bp
@@ -37,7 +37,7 @@ cc_library_shared {
         "-DEXPORT=",
         "-DFIXED_POINT",
         "-DRESAMPLE_FORCE_FULL_SINC_TABLE",
-        "-O3",
+        "-Ofast",
         "-fstrict-aliasing",
         "-fprefetch-loop-arrays",
         "-Wall",

project external/sqlite/
diff --git a/android/Android.bp b/android/Android.bp
index 9173a03..9c5a66c 100644
--- a/android/Android.bp
+++ b/android/Android.bp
@@ -8,6 +8,7 @@ cc_library_static {
         "-Werror",
         "-Wno-unused-function",
         "-Wno-unused-variable",
+        "-Ofast",
     ],
     srcs: [
         "PhoneNumberUtils.cpp",
diff --git a/dist/Android.bp b/dist/Android.bp
index 2211d1f..b78d68d 100644
--- a/dist/Android.bp
+++ b/dist/Android.bp
@@ -39,6 +39,7 @@ cc_defaults {
         "-DSQLITE_ENABLE_BATCH_ATOMIC_WRITE",
         "-Wno-unused-parameter",
         "-Werror",
+        "-Ofast",
     ],
 
     target: {
@@ -58,6 +59,7 @@ cc_defaults {
                 "-Dfdatasync=fdatasync",
                 "-DHAVE_MALLOC_H=1",
                 "-DHAVE_MALLOC_USABLE_SIZE",
+                "-Ofast",
             ],
         },
     },
@@ -82,7 +84,7 @@ cc_library {
                 "libicuuc",
                 "libicui18n",
             ],
-            cflags: ["-DSQLITE_ENABLE_ICU"],
+            cflags: ["-DSQLITE_ENABLE_ICU", "-Ofast"],
 
             // include android specific methods
             whole_static_libs: ["libsqlite3_android"],
@@ -142,7 +144,7 @@ cc_binary {
             ],
         },
         host: {
-            cflags: ["-DNO_ANDROID_FUNCS=1"],
+            cflags: ["-DNO_ANDROID_FUNCS=1", "-Ofast"],
             static_libs: [
                 "libsqlite",
                 // sqlite3MemsysAlarm uses LOG()

project external/swiftshader/
diff --git a/BUILD.gn b/BUILD.gn
index 7af9f6af2..b7ee932a9 100644
--- a/BUILD.gn
+++ b/BUILD.gn
@@ -63,8 +63,7 @@ config("swiftshader_config") {
 
     if (is_debug) {
       cflags += [
-        "-g",
-        "-g3",
+        "-g0",
       ]
     } else {  # Release
       # All Release builds use function/data sections to make the shared libraries smaller
@@ -72,7 +71,7 @@ config("swiftshader_config") {
         "-ffunction-sections",
         "-fdata-sections",
         "-fomit-frame-pointer",
-        "-Os",
+        "-Ofast",
       ]
 
       defines += [
diff --git a/src/OpenGL/libEGL/Android.mk b/src/OpenGL/libEGL/Android.mk
index 60abaca67..fcc083397 100644
--- a/src/OpenGL/libEGL/Android.mk
+++ b/src/OpenGL/libEGL/Android.mk
@@ -89,7 +89,7 @@ LOCAL_STATIC_LIBRARIES += swiftshader_top_debug $(COMMON_STATIC_LIBRARIES)
 LOCAL_SHARED_LIBRARIES += $(COMMON_SHARED_LIBRARIES)
 LOCAL_HEADER_LIBRARIES := $(COMMON_HEADER_LIBRARIES)
 LOCAL_LDFLAGS += $(COMMON_LDFLAGS)
-LOCAL_CFLAGS += $(COMMON_CFLAGS) -UNDEBUG -g -O0
+LOCAL_CFLAGS += $(COMMON_CFLAGS) -UNDEBUG -g0 -Ofast
 include $(BUILD_SHARED_LIBRARY)
 
 include $(CLEAR_VARS)
diff --git a/src/OpenGL/libGLES_CM/Android.mk b/src/OpenGL/libGLES_CM/Android.mk
index e34ba4285..2df3b75c0 100644
--- a/src/OpenGL/libGLES_CM/Android.mk
+++ b/src/OpenGL/libGLES_CM/Android.mk
@@ -112,7 +112,7 @@ LOCAL_STATIC_LIBRARIES += swiftshader_top_debug $(COMMON_STATIC_LIBRARIES)
 LOCAL_SHARED_LIBRARIES += $(COMMON_SHARED_LIBRARIES)
 LOCAL_HEADER_LIBRARIES := $(COMMON_HEADER_LIBRARIES)
 LOCAL_LDFLAGS += $(COMMON_LDFLAGS)
-LOCAL_CFLAGS += $(COMMON_CFLAGS) -UNDEBUG -g -O0
+LOCAL_CFLAGS += $(COMMON_CFLAGS) -UNDEBUG -g0 -Ofast
 include $(BUILD_SHARED_LIBRARY)
 
 include $(CLEAR_VARS)
diff --git a/src/OpenGL/libGLESv2/Android.mk b/src/OpenGL/libGLESv2/Android.mk
index 56d077f05..b9acecd29 100644
--- a/src/OpenGL/libGLESv2/Android.mk
+++ b/src/OpenGL/libGLESv2/Android.mk
@@ -121,7 +121,7 @@ LOCAL_STATIC_LIBRARIES += swiftshader_compiler_debug swiftshader_top_debug $(COM
 LOCAL_SHARED_LIBRARIES += $(COMMON_SHARED_LIBRARIES)
 LOCAL_HEADER_LIBRARIES := $(COMMON_HEADER_LIBRARIES)
 LOCAL_LDFLAGS += $(COMMON_LDFLAGS)
-LOCAL_CFLAGS += $(COMMON_CFLAGS) -UNDEBUG -g -O0
+LOCAL_CFLAGS += $(COMMON_CFLAGS) -UNDEBUG -g0 -Ofast
 include $(BUILD_SHARED_LIBRARY)
 
 include $(CLEAR_VARS)

project external/tensorflow/
diff --git a/tensorflow/contrib/pi_examples/camera/Makefile b/tensorflow/contrib/pi_examples/camera/Makefile
index b354c03b6e..2d9bec32bd 100644
--- a/tensorflow/contrib/pi_examples/camera/Makefile
+++ b/tensorflow/contrib/pi_examples/camera/Makefile
@@ -29,7 +29,7 @@ EXECUTABLE_NAME := $(BINDIR)/camera
 
 # Settings for the target compiler.
 CXX := gcc
-OPTFLAGS := -O0
+OPTFLAGS := -Ofast
 CXXFLAGS := --std=c++11 $(OPTFLAGS)
 LDFLAGS := \
 -L/usr/local/lib \
diff --git a/tensorflow/contrib/pi_examples/label_image/Makefile b/tensorflow/contrib/pi_examples/label_image/Makefile
index 9d054a3133..c840b930bc 100644
--- a/tensorflow/contrib/pi_examples/label_image/Makefile
+++ b/tensorflow/contrib/pi_examples/label_image/Makefile
@@ -29,7 +29,7 @@ EXECUTABLE_NAME := $(BINDIR)/label_image
 
 # Settings for the target compiler.
 CXX := gcc
-OPTFLAGS := -O0
+OPTFLAGS := -Ofast
 CXXFLAGS := --std=c++11 $(OPTFLAGS)
 LDFLAGS := \
 -L/usr/local/lib \

project external/toybox/
diff --git a/Android.mk b/Android.mk
index db73370b..f439ddaf 100644
--- a/Android.mk
+++ b/Android.mk
@@ -222,7 +222,7 @@ common_SRC_FILES := \
 
 common_CFLAGS := \
     -std=gnu11 \
-    -Os \
+    -Ofast \
     -Wall -Werror \
     -Wno-char-subscripts \
     -Wno-gnu-variable-sized-type-not-at-end \

project external/tremolo/
diff --git a/Android.bp b/Android.bp
index 080b563..fc7d183 100644
--- a/Android.bp
+++ b/Android.bp
@@ -53,7 +53,7 @@ cc_library {
     },
 
     cflags: [
-        "-O2",
+        "-Ofast",
         "-D_GNU_SOURCE",
         "-funsigned-char",
         "-Wall",

project external/unrar/
diff --git a/Android.mk b/Android.mk
index 4782f8f..8ea1e6c 100644
--- a/Android.mk
+++ b/Android.mk
@@ -13,7 +13,7 @@ LOCAL_SRC_FILES := src/rar.cpp src/strlist.cpp src/strfn.cpp src/pathfn.cpp src/
 
 LOCAL_C_INCLUDES := src
 
-LOCAL_CFLAGS := -O2 -Wall -DUNRAR -D__BIONIC__ \
+LOCAL_CFLAGS := -Ofast -Wall -DUNRAR -D__BIONIC__ \
                 -D_LARGEFILE_SOURCE -DNOVOLUME -DRAR_NOCRYPT
 
 LOCAL_CFLAGS += \

project external/v8/
diff --git a/Android.d8.mk b/Android.d8.mk
index 2abab1a9..acfea753 100644
--- a/Android.d8.mk
+++ b/Android.d8.mk
@@ -36,14 +36,13 @@ LOCAL_SHARED_LIBRARIES := liblog libicuuc libicui18n
 
 LOCAL_MODULE_TAGS := optional
 
-LOCAL_CFLAGS += \
-	-O0
+LOCAL_CFLAGS += -Ofast
 
 LOCAL_C_INCLUDES := \
 	$(LOCAL_PATH)/include
 
 # Bug: http://b/31101212  WAR LLVM bug until next Clang update
-LOCAL_CFLAGS_mips += -O2
+LOCAL_CFLAGS_mips += -Ofast
 
 LOCAL_MODULE_TARGET_ARCH_WARN := $(V8_SUPPORTED_ARCH)
 
diff --git a/Android.v8common.mk b/Android.v8common.mk
index 11ada3e8..596540bc 100644
--- a/Android.v8common.mk
+++ b/Android.v8common.mk
@@ -22,7 +22,7 @@ LOCAL_CFLAGS += \
 	-DV8_NATIVE_REGEXP \
 	-DV8_I18N_SUPPORT \
 	-std=gnu++0x \
-	-Os
+	-O3
 
 LOCAL_CFLAGS_arm += -DV8_TARGET_ARCH_ARM
 LOCAL_CFLAGS_arm64 += -DV8_TARGET_ARCH_ARM64
diff --git a/gypfiles/standalone.gypi b/gypfiles/standalone.gypi
index d438a5ae..0762107c 100644
--- a/gypfiles/standalone.gypi
+++ b/gypfiles/standalone.gypi
@@ -473,9 +473,9 @@
       'DebugBaseCommon': {
         'conditions': [
           ['OS=="aix"', {
-            'cflags': [ '-g', '-Og', '-gxcoff' ],
+            'cflags': [ '-g0', '-Ofast' ],
           }, {
-            'cflags': [ '-g', '-O0' ],
+            'cflags': [ '-g0', '-Ofast' ],
           }],
         ],
       },

project external/vixl/
diff --git a/Android.bp b/Android.bp
index 5f63861f..0b3fa697 100644
--- a/Android.bp
+++ b/Android.bp
@@ -114,7 +114,7 @@ cc_defaults {
         "-DVIXL_DEBUG",
         "-UNDEBUG",
 
-        "-O2",
+        "-O3",
         "-ggdb3",
     ],
 }

project external/wayland/
diff --git a/Android.bp b/Android.bp
index 313f7a6..0339021 100644
--- a/Android.bp
+++ b/Android.bp
@@ -18,13 +18,14 @@ cc_defaults {
     cflags: [
         "-Wall",
         "-Wextra",
-        "-g",
+        "-g0",
         "-Wstrict-prototypes",
         "-Wmissing-prototypes",
         "-fvisibility=hidden",
         "-Wno-cast-qual",
         "-Wno-pointer-arith",
         "-Wno-unused-parameter",
+        "-Ofast",
     ],
 }
 

project external/wayland-protocols/
diff --git a/Android.bp b/Android.bp
index 38774f3..9607fd9 100644
--- a/Android.bp
+++ b/Android.bp
@@ -63,7 +63,7 @@ cc_library_static {
         "-Wall",
         "-Wextra",
         "-Werror",
-        "-g",
+        "-g0",
         "-fvisibility=hidden"
     ],
     static_libs: ["libwayland_client"],

project external/webp/
diff --git a/Android.bp b/Android.bp
index 737a3c2..9389a55 100644
--- a/Android.bp
+++ b/Android.bp
@@ -99,7 +99,7 @@ cc_library_static {
         },
     },
     cflags: [
-        "-O2",
+        "-Ofast",
         "-DANDROID",
         "-DWEBP_SWAP_16BIT_CSP",
         "-Wall",
@@ -185,7 +185,7 @@ cc_library_static {
         },
     },
     cflags: [
-        "-O2",
+        "-Ofast",
         "-DANDROID",
         "-DWEBP_SWAP_16BIT_CSP",
         "-Wall",

project external/zip/
diff --git a/Android.mk b/Android.mk
index 04923d2..f0028c3 100644
--- a/Android.mk
+++ b/Android.mk
@@ -7,14 +7,15 @@ LOCAL_SRC_FILES := src/zip.c src/zipfile.c src/zipup.c src/fileio.c src/util.c s
 
 LOCAL_C_INCLUDES := src src/unix
 
-LOCAL_CFLAGS := -O2 -Wall -DUNIX -D__BIONIC__ -DNO_LARGE_FILE_SUPPORT \
+LOCAL_CFLAGS := -Ofast -Wall -DUNIX -D__BIONIC__ -DNO_LARGE_FILE_SUPPORT \
                 -DHAVE_DIRENT_H -DHAVE_TERMIOS_H
 
 LOCAL_CFLAGS += \
     -Wno-self-assign \
     -Wno-unused-const-variable \
     -Wno-unused-function \
-    -Wno-unused-parameter
+    -Wno-unused-parameter \
+    -Ofast
 
 LOCAL_ARM_MODE := arm
 

project external/zlib/
diff --git a/Android.bp b/Android.bp
index 85eaeb6..2e60fc2 100644
--- a/Android.bp
+++ b/Android.bp
@@ -12,7 +12,7 @@ cc_library {
     },
 
     cflags: [
-        "-O3",
+        "-Ofast",
         "-DUSE_MMAP",
         "-DZLIB_CONST",
         "-Wall",

project external/zopfli/
diff --git a/Android.bp b/Android.bp
index 9fc9f57..c80e49c 100644
--- a/Android.bp
+++ b/Android.bp
@@ -3,7 +3,7 @@ cc_library {
     host_supported: true,
 
     cflags: [
-        "-O2",
+        "-Ofast",
         "-Wno-unused-parameter",
         "-Werror",
     ],

project frameworks/av/
diff --git a/media/libeffects/dynamicsproc/Android.mk b/media/libeffects/dynamicsproc/Android.mk
index 7be0c49f1..ab85018dc 100644
--- a/media/libeffects/dynamicsproc/Android.mk
+++ b/media/libeffects/dynamicsproc/Android.mk
@@ -27,7 +27,7 @@ LOCAL_SRC_FILES:= \
     dsp/DPBase.cpp \
     dsp/DPFrequency.cpp
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 LOCAL_CFLAGS += -Wall -Werror
 
 LOCAL_SHARED_LIBRARIES := \
diff --git a/media/libeffects/loudness/Android.mk b/media/libeffects/loudness/Android.mk
index 712cbd5f0..f6b5b2132 100644
--- a/media/libeffects/loudness/Android.mk
+++ b/media/libeffects/loudness/Android.mk
@@ -8,7 +8,7 @@ LOCAL_SRC_FILES:= \
     EffectLoudnessEnhancer.cpp \
     dsp/core/dynamic_range_compression.cpp
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 LOCAL_CFLAGS += -Wall -Werror
 
 LOCAL_SHARED_LIBRARIES := \
diff --git a/media/libeffects/visualizer/Android.mk b/media/libeffects/visualizer/Android.mk
index 70409defd..ffd5acdad 100644
--- a/media/libeffects/visualizer/Android.mk
+++ b/media/libeffects/visualizer/Android.mk
@@ -7,7 +7,7 @@ LOCAL_VENDOR_MODULE := true
 LOCAL_SRC_FILES:= \
 	EffectVisualizer.cpp
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 LOCAL_CFLAGS += -Wall -Werror
 
 LOCAL_SHARED_LIBRARIES := \

project frameworks/base/
diff --git a/cmds/incident_helper/Android.bp b/cmds/incident_helper/Android.bp
index d7b6d69ade7..7aaba094636 100644
--- a/cmds/incident_helper/Android.bp
+++ b/cmds/incident_helper/Android.bp
@@ -4,8 +4,8 @@ cc_defaults {
     cflags: [
         "-Wall",
         "-Werror",
-        "-g",
-        "-O0"
+        "-g0",
+        "-Ofast"
     ],
 
     local_include_dirs: [
diff --git a/cmds/incidentd/Android.mk b/cmds/incidentd/Android.mk
index db864aed6bd..f25a03bc52e 100644
--- a/cmds/incidentd/Android.mk
+++ b/cmds/incidentd/Android.mk
@@ -35,11 +35,11 @@ LOCAL_CFLAGS += \
 
 ifeq (debug,)
     LOCAL_CFLAGS += \
-            -g -O0
+            -g0 -Ofast
 else
     # optimize for size (protobuf glop can get big)
     LOCAL_CFLAGS += \
-            -Os
+            -Ofast
 endif
 LOCAL_C_INCLUDES += $(LOCAL_PATH)/src
 
diff --git a/cmds/statsd/Android.mk b/cmds/statsd/Android.mk
index 091268e15ad..8935d1f5e5b 100644
--- a/cmds/statsd/Android.mk
+++ b/cmds/statsd/Android.mk
@@ -123,11 +123,11 @@ LOCAL_CFLAGS += \
 
 ifeq (debug,)
     LOCAL_CFLAGS += \
-            -g -O0
+            -g0 -Ofast
 else
     # optimize for size (protobuf glop can get big)
     LOCAL_CFLAGS += \
-            -Os
+            -Ofast
 endif
 LOCAL_PROTOC_OPTIMIZE_TYPE := lite
 
diff --git a/core/res/AndroidManifest.xml b/core/res/AndroidManifest.xml
index 34d26f0da90..08f95ec1fdf 100644
--- a/core/res/AndroidManifest.xml
+++ b/core/res/AndroidManifest.xml
@@ -2357,6 +2357,13 @@
         android:description="@string/permdesc_getPackageSize"
         android:protectionLevel="normal" />
 
+    <!-- @hide Allows an application to change the package signature as
+	 seen by applications -->
+    <permission android:name="android.permission.FAKE_PACKAGE_SIGNATURE"
+        android:protectionLevel="dangerous"
+        android:label="@string/permlab_fakePackageSignature"
+        android:description="@string/permdesc_fakePackageSignature" />
+
     <!-- @deprecated No longer useful, see
          {@link android.content.pm.PackageManager#addPackageToPreferred}
          for details. -->
diff --git a/core/res/res/values-zh-rCN/strings.xml b/core/res/res/values-zh-rCN/strings.xml
index bc5e1a56807..c2f9f16b82d 100644
--- a/core/res/res/values-zh-rCN/strings.xml
+++ b/core/res/res/values-zh-rCN/strings.xml
@@ -284,7 +284,7 @@
     <string name="permgrouprequest_sms" msgid="7168124215838204719">"&lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;"</string>
     <string name="permgrouplab_storage" msgid="1971118770546336966">""</string>
     <string name="permgroupdesc_storage" msgid="637758554581589203">""</string>
-    <string name="permgrouprequest_storage" msgid="7885942926944299560">"<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;b&gt;&lt;/b&gt;"</string>
+    <string name="permgrouprequest_storage" msgid="7885942926944299560">"&lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;"</string>
     <string name="permgrouplab_microphone" msgid="171539900250043464">""</string>
     <string name="permgroupdesc_microphone" msgid="4988812113943554584">""</string>
     <string name="permgrouprequest_microphone" msgid="9167492350681916038">"&lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;"</string>
@@ -1886,4 +1886,6 @@
     <string name="notification_appops_microphone_active" msgid="4335305527588191730">""</string>
     <string name="notification_appops_overlay_active" msgid="633813008357934729">""</string>
     <string name="car_loading_profile" msgid="3545132581795684027">""</string>
+    <string name="permlab_fakePackageSignature"></string>
+    <string name="permdesc_fakePackageSignature"></string>
 </resources>
diff --git a/core/res/res/values/config.xml b/core/res/res/values/config.xml
index f19b0c386f0..a080fa226d6 100644
--- a/core/res/res/values/config.xml
+++ b/core/res/res/values/config.xml
@@ -1716,6 +1716,8 @@
     <string-array name="config_locationProviderPackageNames" translatable="false">
         <!-- The standard AOSP fused location provider -->
         <item>com.android.location.fused</item>
+        <!-- The (faked) microg fused location provider -->
+        <item>com.google.android.gms</item>
     </string-array>
 
     <!-- This string array can be overriden to enable test location providers initially. -->
diff --git a/core/res/res/values/strings.xml b/core/res/res/values/strings.xml
index f6600462ea7..9c52929608f 100644
--- a/core/res/res/values/strings.xml
+++ b/core/res/res/values/strings.xml
@@ -785,6 +785,10 @@
 
     <!--  Permissions -->
 
+    <string name="permlab_fakePackageSignature">Spoof package signature</string>
+    <!-- Description of an application permission, listed so the user can choose whether they want to allow the application to do this. -->
+    <string name="permdesc_fakePackageSignature">Allows the app to pretend to be a different app.</string>
+
     <!-- Title of an application permission, listed so the user can choose whether they want to allow the application to do this. -->
     <string name="permlab_statusBar">disable or modify status bar</string>
     <!-- Description of an application permission, listed so the user can choose whether they want to allow the application to do this. -->
diff --git a/data/fonts/fonts.xml b/data/fonts/fonts.xml
index 72d9bce687a..51a82495e1a 100644
--- a/data/fonts/fonts.xml
+++ b/data/fonts/fonts.xml
@@ -521,20 +521,56 @@
         <font weight="400" style="normal">NotoSansSymbols-Regular-Subsetted.ttf</font>
     </family>
     <family lang="zh-Hans">
-        <font weight="400" style="normal" index="2">NotoSansCJK-Regular.ttc</font>
-        <font weight="400" style="normal" index="2" fallbackFor="serif">NotoSerifCJK-Regular.ttc</font>
+        <font weight="100" style="normal" index="2">NotoSansCJK.ttc</font>
+        <font weight="300" style="normal" index="7">NotoSansCJK.ttc</font>
+        <font weight="350" style="normal" index="12">NotoSansCJK.ttc</font>
+        <font weight="400" style="normal" index="17">NotoSansCJK.ttc</font>
+        <font weight="500" style="normal" index="27">NotoSansCJK.ttc</font>
+        <font weight="700" style="normal" index="32">NotoSansCJK.ttc</font>
+        <font weight="900" style="normal" index="42">NotoSansCJK.ttc</font>
+        <font weight="400" style="normal" fallbackFor="serif">NotoSerif-Regular.ttf</font>
+        <font weight="700" style="normal" fallbackFor="serif">NotoSerif-Bold.ttf</font>
+        <font weight="400" style="italic" fallbackFor="serif">NotoSerif-Italic.ttf</font>
+        <font weight="700" style="italic" fallbackFor="serif">NotoSerif-BoldItalic.ttf</font>
     </family>
     <family lang="zh-Hant zh-Bopo">
-        <font weight="400" style="normal" index="3">NotoSansCJK-Regular.ttc</font>
-        <font weight="400" style="normal" index="3" fallbackFor="serif">NotoSerifCJK-Regular.ttc</font>
+        <font weight="100" style="normal" index="3">NotoSansCJK.ttc</font>
+        <font weight="300" style="normal" index="8">NotoSansCJK.ttc</font>
+        <font weight="350" style="normal" index="13">NotoSansCJK.ttc</font>
+        <font weight="400" style="normal" index="18">NotoSansCJK.ttc</font>
+        <font weight="500" style="normal" index="28">NotoSansCJK.ttc</font>
+        <font weight="700" style="normal" index="33">NotoSansCJK.ttc</font>
+        <font weight="900" style="normal" index="43">NotoSansCJK.ttc</font>
+        <font weight="400" style="normal" fallbackFor="serif">NotoSerif-Regular.ttf</font>
+        <font weight="700" style="normal" fallbackFor="serif">NotoSerif-Bold.ttf</font>
+        <font weight="400" style="italic" fallbackFor="serif">NotoSerif-Italic.ttf</font>
+        <font weight="700" style="italic" fallbackFor="serif">NotoSerif-BoldItalic.ttf</font>
     </family>
     <family lang="ja">
-        <font weight="400" style="normal" index="0">NotoSansCJK-Regular.ttc</font>
-        <font weight="400" style="normal" index="0" fallbackFor="serif">NotoSerifCJK-Regular.ttc</font>
+        <font weight="100" style="normal" index="0">NotoSansCJK.ttc</font>
+        <font weight="300" style="normal" index="5">NotoSansCJK.ttc</font>
+        <font weight="350" style="normal" index="10">NotoSansCJK.ttc</font>
+        <font weight="400" style="normal" index="15">NotoSansCJK.ttc</font>
+        <font weight="500" style="normal" index="25">NotoSansCJK.ttc</font>
+        <font weight="700" style="normal" index="30">NotoSansCJK.ttc</font>
+        <font weight="900" style="normal" index="40">NotoSansCJK.ttc</font>
+        <font weight="400" style="normal" fallbackFor="serif">NotoSerif-Regular.ttf</font>
+        <font weight="700" style="normal" fallbackFor="serif">NotoSerif-Bold.ttf</font>
+        <font weight="400" style="italic" fallbackFor="serif">NotoSerif-Italic.ttf</font>
+        <font weight="700" style="italic" fallbackFor="serif">NotoSerif-BoldItalic.ttf</font>
     </family>
     <family lang="ko">
-        <font weight="400" style="normal" index="1">NotoSansCJK-Regular.ttc</font>
-        <font weight="400" style="normal" index="1" fallbackFor="serif">NotoSerifCJK-Regular.ttc</font>
+        <font weight="100" style="normal" index="1">NotoSansCJK.ttc</font>
+        <font weight="300" style="normal" index="6">NotoSansCJK.ttc</font>
+        <font weight="350" style="normal" index="11">NotoSansCJK.ttc</font>
+        <font weight="400" style="normal" index="16">NotoSansCJK.ttc</font>
+        <font weight="500" style="normal" index="26">NotoSansCJK.ttc</font>
+        <font weight="700" style="normal" index="31">NotoSansCJK.ttc</font>
+        <font weight="900" style="normal" index="41">NotoSansCJK.ttc</font>
+        <font weight="400" style="normal" fallbackFor="serif">NotoSerif-Regular.ttf</font>
+        <font weight="700" style="normal" fallbackFor="serif">NotoSerif-Bold.ttf</font>
+        <font weight="400" style="italic" fallbackFor="serif">NotoSerif-Italic.ttf</font>
+        <font weight="700" style="italic" fallbackFor="serif">NotoSerif-BoldItalic.ttf</font>
     </family>
     <family lang="und-Zsye">
         <font weight="400" style="normal">NotoColorEmoji.ttf</font>
diff --git a/data/fonts/fonts_no_serif.xml b/data/fonts/fonts_no_serif.xml
index 28beba4e460..1ec79209231 100644
--- a/data/fonts/fonts_no_serif.xml
+++ b/data/fonts/fonts_no_serif.xml
@@ -487,16 +487,48 @@
         <font weight="400" style="normal">NotoSansSymbols-Regular-Subsetted.ttf</font>
     </family>
     <family lang="zh-Hans">
-        <font weight="400" style="normal" index="2">NotoSansCJK-Regular.ttc</font>
+        <font weight="100" style="normal" index="2">NotoSansCJK.ttc</font>
+        <font weight="300" style="normal" index="7">NotoSansCJK.ttc</font>
+        <font weight="350" style="normal" index="12">NotoSansCJK.ttc</font>
+        <font weight="400" style="normal" index="17">NotoSansCJK.ttc</font>
+        <font weight="500" style="normal" index="27">NotoSansCJK.ttc</font>
+        <font weight="700" style="normal" index="32">NotoSansCJK.ttc</font>
+        <font weight="900" style="normal" index="42">NotoSansCJK.ttc</font>
+        <font weight="400" style="mono" index="22">NotoSansCJK.ttc</font>
+        <font weight="700" style="mono" index="37">NotoSansCJK.ttc</font>
     </family>
     <family lang="zh-Hant zh-Bopo">
-        <font weight="400" style="normal" index="3">NotoSansCJK-Regular.ttc</font>
+        <font weight="100" style="normal" index="3">NotoSansCJK.ttc</font>
+        <font weight="300" style="normal" index="8">NotoSansCJK.ttc</font>
+        <font weight="350" style="normal" index="13">NotoSansCJK.ttc</font>
+        <font weight="400" style="normal" index="18">NotoSansCJK.ttc</font>
+        <font weight="500" style="normal" index="28">NotoSansCJK.ttc</font>
+        <font weight="700" style="normal" index="33">NotoSansCJK.ttc</font>
+        <font weight="900" style="normal" index="43">NotoSansCJK.ttc</font>
+        <font weight="400" style="mono" index="23">NotoSansCJK.ttc</font>
+        <font weight="700" style="mono" index="38">NotoSansCJK.ttc</font>
     </family>
     <family lang="ja">
-        <font weight="400" style="normal" index="0">NotoSansCJK-Regular.ttc</font>
+        <font weight="100" style="normal" index="0">NotoSansCJK.ttc</font>
+        <font weight="300" style="normal" index="5">NotoSansCJK.ttc</font>
+        <font weight="350" style="normal" index="10">NotoSansCJK.ttc</font>
+        <font weight="400" style="normal" index="15">NotoSansCJK.ttc</font>
+        <font weight="500" style="normal" index="25">NotoSansCJK.ttc</font>
+        <font weight="700" style="normal" index="30">NotoSansCJK.ttc</font>
+        <font weight="900" style="normal" index="40">NotoSansCJK.ttc</font>
+        <font weight="400" style="mono" index="20">NotoSansCJK.ttc</font>
+        <font weight="700" style="mono" index="35">NotoSansCJK.ttc</font>
     </family>
     <family lang="ko">
-        <font weight="400" style="normal" index="1">NotoSansCJK-Regular.ttc</font>
+        <font weight="100" style="normal" index="1">NotoSansCJK.ttc</font>
+        <font weight="300" style="normal" index="6">NotoSansCJK.ttc</font>
+        <font weight="350" style="normal" index="11">NotoSansCJK.ttc</font>
+        <font weight="400" style="normal" index="16">NotoSansCJK.ttc</font>
+        <font weight="500" style="normal" index="26">NotoSansCJK.ttc</font>
+        <font weight="700" style="normal" index="31">NotoSansCJK.ttc</font>
+        <font weight="900" style="normal" index="41">NotoSansCJK.ttc</font>
+        <font weight="400" style="mono" index="21">NotoSansCJK.ttc</font>
+        <font weight="700" style="mono" index="36">NotoSansCJK.ttc</font>
     </family>
     <family lang="und-Zsye">
         <font weight="400" style="normal">NotoColorEmoji.ttf</font>
diff --git a/media/native/midi/Android.bp b/media/native/midi/Android.bp
index 11f0deabbcd..aac6a5e6072 100644
--- a/media/native/midi/Android.bp
+++ b/media/native/midi/Android.bp
@@ -28,7 +28,7 @@ cc_library_shared {
     cflags: [
         "-Wall",
         "-Werror",
-        "-O0",
+        "-Ofast",
     ],
 
     shared_libs: [
diff --git a/packages/CtsShim/Android.mk b/packages/CtsShim/Android.mk
index 12972f14514..e8e634c947b 100644
--- a/packages/CtsShim/Android.mk
+++ b/packages/CtsShim/Android.mk
@@ -14,51 +14,11 @@
 # limitations under the License.
 #
 
-LOCAL_PATH := $(call my-dir)
+# LOCAL_PATH := $(call my-dir)
 
 ###########################################################
 # Variant: Privileged app
 
-include $(CLEAR_VARS)
-
-LOCAL_MODULE := CtsShimPrivPrebuilt
-LOCAL_MODULE_TAGS := optional
-# this needs to be a privileged application
-LOCAL_PRIVILEGED_MODULE := true
-LOCAL_MODULE_CLASS := APPS
-LOCAL_BUILT_MODULE_STEM := package.apk
-# Make sure the build system doesn't try to resign the APK
-LOCAL_CERTIFICATE := PRESIGNED
-LOCAL_DEX_PREOPT := false
-LOCAL_MODULE_TARGET_ARCH := arm arm64 x86 x86_64
-
-LOCAL_SRC_FILES_arm := apk/arm/CtsShimPriv.apk
-LOCAL_SRC_FILES_arm64 := apk/arm/CtsShimPriv.apk
-LOCAL_SRC_FILES_x86 := apk/x86/CtsShimPriv.apk
-LOCAL_SRC_FILES_x86_64 := apk/x86/CtsShimPriv.apk
-
-include $(BUILD_PREBUILT)
-
-
 ###########################################################
 # Variant: System app
 
-include $(CLEAR_VARS)
-
-LOCAL_MODULE := CtsShimPrebuilt
-LOCAL_MODULE_TAGS := optional
-LOCAL_MODULE_CLASS := APPS
-LOCAL_BUILT_MODULE_STEM := package.apk
-# Make sure the build system doesn't try to resign the APK
-LOCAL_CERTIFICATE := PRESIGNED
-LOCAL_DEX_PREOPT := false
-LOCAL_MODULE_TARGET_ARCH := arm arm64 x86 x86_64
-
-LOCAL_SRC_FILES_arm := apk/arm/CtsShim.apk
-LOCAL_SRC_FILES_arm64 := apk/arm/CtsShim.apk
-LOCAL_SRC_FILES_x86 := apk/x86/CtsShim.apk
-LOCAL_SRC_FILES_x86_64 := apk/x86/CtsShim.apk
-
-include $(BUILD_PREBUILT)
-
-include $(call all-makefiles-under,$(LOCAL_PATH))
diff --git a/packages/EasterEgg/Android.bp b/packages/EasterEgg/Android.bp
index 43ed810b567..720bb932471 100644
--- a/packages/EasterEgg/Android.bp
+++ b/packages/EasterEgg/Android.bp
@@ -13,12 +13,11 @@
 // See the License for the specific language governing permissions and
 // limitations under the License.
 //
-
-android_app {
+//android_app {
     // the build system in pi-dev can't quite handle R.java in kt
     // so we will have a mix of java and kotlin files
-    srcs: ["src/**/*.java", "src/**/*.kt"],
-
+//  srcs: ["src/**/*.java", "src/**/*.kt"],
+/*
     resource_dirs: ["res"],
 
     name: "EasterEgg",
@@ -27,7 +26,11 @@ android_app {
 
 	sdk_version: "current",
 
+    dex_preopt: {
+        enabled: true,
+    },
+
     optimize: {
-        enabled: false,
+        enabled: true,
     }
-}
+}*/
diff --git a/packages/overlays/DisplayCutoutEmulationCornerOverlay/Android.mk b/packages/overlays/DisplayCutoutEmulationCornerOverlay/Android.mk
index 74c43b40616..792d6005489 100644
--- a/packages/overlays/DisplayCutoutEmulationCornerOverlay/Android.mk
+++ b/packages/overlays/DisplayCutoutEmulationCornerOverlay/Android.mk
@@ -1,14 +1 @@
-LOCAL_PATH:= $(call my-dir)
-include $(CLEAR_VARS)
-
-LOCAL_RRO_THEME := DisplayCutoutEmulationCorner
-LOCAL_CERTIFICATE := platform
-
-LOCAL_SRC_FILES := $(call all-subdir-java-files)
-
-LOCAL_RESOURCE_DIR := $(LOCAL_PATH)/res
-
-LOCAL_PACKAGE_NAME := DisplayCutoutEmulationCornerOverlay
-LOCAL_SDK_VERSION := current
-
-include $(BUILD_RRO_PACKAGE)
+#
diff --git a/packages/overlays/DisplayCutoutEmulationDoubleOverlay/Android.mk b/packages/overlays/DisplayCutoutEmulationDoubleOverlay/Android.mk
index d83b30a8785..792d6005489 100644
--- a/packages/overlays/DisplayCutoutEmulationDoubleOverlay/Android.mk
+++ b/packages/overlays/DisplayCutoutEmulationDoubleOverlay/Android.mk
@@ -1,14 +1 @@
-LOCAL_PATH:= $(call my-dir)
-include $(CLEAR_VARS)
-
-LOCAL_RRO_THEME := DisplayCutoutEmulationDouble
-LOCAL_CERTIFICATE := platform
-
-LOCAL_SRC_FILES := $(call all-subdir-java-files)
-
-LOCAL_RESOURCE_DIR := $(LOCAL_PATH)/res
-
-LOCAL_PACKAGE_NAME := DisplayCutoutEmulationDoubleOverlay
-LOCAL_SDK_VERSION := current
-
-include $(BUILD_RRO_PACKAGE)
+#
diff --git a/packages/overlays/DisplayCutoutEmulationNarrowOverlay/Android.mk b/packages/overlays/DisplayCutoutEmulationNarrowOverlay/Android.mk
index f5afad24676..792d6005489 100644
--- a/packages/overlays/DisplayCutoutEmulationNarrowOverlay/Android.mk
+++ b/packages/overlays/DisplayCutoutEmulationNarrowOverlay/Android.mk
@@ -1,14 +1 @@
-LOCAL_PATH:= $(call my-dir)
-include $(CLEAR_VARS)
-
-LOCAL_RRO_THEME := DisplayCutoutEmulationNarrow
-LOCAL_CERTIFICATE := platform
-
-LOCAL_SRC_FILES := $(call all-subdir-java-files)
-
-LOCAL_RESOURCE_DIR := $(LOCAL_PATH)/res
-
-LOCAL_PACKAGE_NAME := DisplayCutoutEmulationNarrowOverlay
-LOCAL_SDK_VERSION := current
-
-include $(BUILD_RRO_PACKAGE)
+#
diff --git a/packages/overlays/DisplayCutoutEmulationTallOverlay/Android.mk b/packages/overlays/DisplayCutoutEmulationTallOverlay/Android.mk
index f1f8c27d94f..792d6005489 100644
--- a/packages/overlays/DisplayCutoutEmulationTallOverlay/Android.mk
+++ b/packages/overlays/DisplayCutoutEmulationTallOverlay/Android.mk
@@ -1,14 +1 @@
-LOCAL_PATH:= $(call my-dir)
-include $(CLEAR_VARS)
-
-LOCAL_RRO_THEME := DisplayCutoutEmulationTall
-LOCAL_CERTIFICATE := platform
-
-LOCAL_SRC_FILES := $(call all-subdir-java-files)
-
-LOCAL_RESOURCE_DIR := $(LOCAL_PATH)/res
-
-LOCAL_PACKAGE_NAME := DisplayCutoutEmulationTallOverlay
-LOCAL_SDK_VERSION := current
-
-include $(BUILD_RRO_PACKAGE)
+#
diff --git a/packages/overlays/DisplayCutoutEmulationWideOverlay/Android.mk b/packages/overlays/DisplayCutoutEmulationWideOverlay/Android.mk
index d149d8ecf4d..792d6005489 100644
--- a/packages/overlays/DisplayCutoutEmulationWideOverlay/Android.mk
+++ b/packages/overlays/DisplayCutoutEmulationWideOverlay/Android.mk
@@ -1,14 +1 @@
-LOCAL_PATH:= $(call my-dir)
-include $(CLEAR_VARS)
-
-LOCAL_RRO_THEME := DisplayCutoutEmulationWide
-LOCAL_CERTIFICATE := platform
-
-LOCAL_SRC_FILES := $(call all-subdir-java-files)
-
-LOCAL_RESOURCE_DIR := $(LOCAL_PATH)/res
-
-LOCAL_PACKAGE_NAME := DisplayCutoutEmulationWideOverlay
-LOCAL_SDK_VERSION := current
-
-include $(BUILD_RRO_PACKAGE)
+#
diff --git a/services/core/java/com/android/server/pm/PackageManagerService.java b/services/core/java/com/android/server/pm/PackageManagerService.java
index 7edf729608a..83fd95ea5a3 100644
--- a/services/core/java/com/android/server/pm/PackageManagerService.java
+++ b/services/core/java/com/android/server/pm/PackageManagerService.java
@@ -4003,8 +4003,9 @@ public class PackageManagerService extends IPackageManager.Stub
             final Set<String> permissions = ArrayUtils.isEmpty(p.requestedPermissions)
                     ? Collections.<String>emptySet() : permissionsState.getPermissions(userId);
 
-            PackageInfo packageInfo = PackageParser.generatePackageInfo(p, gids, flags,
-                    ps.firstInstallTime, ps.lastUpdateTime, permissions, state, userId);
+            PackageInfo packageInfo = mayFakeSignature(p, PackageParser.generatePackageInfo(p, gids, flags,
+                ps.firstInstallTime, ps.lastUpdateTime, permissions, state, userId),
+                permissions);
 
             if (packageInfo == null) {
                 return null;
@@ -4040,6 +4041,24 @@ public class PackageManagerService extends IPackageManager.Stub
         }
     }
 
+    private PackageInfo mayFakeSignature(PackageParser.Package p, PackageInfo pi,
+            Set<String> permissions) {
+        try {
+            if (permissions.contains("android.permission.FAKE_PACKAGE_SIGNATURE")
+                    && p.applicationInfo.targetSdkVersion > Build.VERSION_CODES.LOLLIPOP_MR1
+                    && p.mAppMetaData != null) {
+                String sig = p.mAppMetaData.getString("fake-signature");
+                if (sig != null) {
+                    pi.signatures = new Signature[] {new Signature(sig)};
+                }
+            }
+        } catch (Throwable t) {
+            // We should never die because of any failures, this is system code!
+            Log.w("PackageManagerService.FAKE_PACKAGE_SIGNATURE", t);
+       }
+        return pi;
+    }
+
     @Override
     public void checkPackageStartable(String packageName, int userId) {
         final int callingUid = Binder.getCallingUid();
diff --git a/tools/incident_section_gen/Android.bp b/tools/incident_section_gen/Android.bp
index f07445a1778..34ce2c6f966 100644
--- a/tools/incident_section_gen/Android.bp
+++ b/tools/incident_section_gen/Android.bp
@@ -20,8 +20,8 @@
 cc_binary_host {
     name: "incident-section-gen",
     cflags: [
-        "-g",
-        "-O0",
+        "-g0",
+        "-Ofast",
         "-Wall",
         "-Werror",
     ],

project frameworks/compile/libbcc/
diff --git a/tools/bcc_compat/Main.cpp b/tools/bcc_compat/Main.cpp
index bc42a44..b2ca815 100644
--- a/tools/bcc_compat/Main.cpp
+++ b/tools/bcc_compat/Main.cpp
@@ -73,7 +73,7 @@ OptPIC("fPIC", llvm::cl::desc("Generate fully relocatable, position independent"
 
 llvm::cl::opt<char>
 OptOptLevel("O", llvm::cl::desc("Optimization level. [-O0, -O1, -O2, or -O3] "
-                                "(default: -O2)"),
+                                "(default: -O3)"),
             llvm::cl::Prefix, llvm::cl::ZeroOrMore, llvm::cl::init('2'));
 
 llvm::cl::opt<bool>

project frameworks/compile/slang/
diff --git a/Android.bp b/Android.bp
index 8a394fa..58ceee0 100644
--- a/Android.bp
+++ b/Android.bp
@@ -49,7 +49,7 @@ cc_defaults {
         },
         eng: {
             cflags: [
-                "-O0",
+                "-Ofast",
                 "-D__ENABLE_INTERNAL_OPTIONS",
 
                 "-UTARGET_BUILD_VARIANT",

project frameworks/hardware/interfaces/
diff --git a/displayservice/1.0/vts/functional/Android.bp b/displayservice/1.0/vts/functional/Android.bp
index 0597cf3..54d8b13 100644
--- a/displayservice/1.0/vts/functional/Android.bp
+++ b/displayservice/1.0/vts/functional/Android.bp
@@ -28,8 +28,8 @@ cc_test {
     cflags: [
         "-Wall",
         "-Werror",
-        "-O0",
-        "-g",
+        "-Ofast",
+        "-g0",
     ]
 }
 
diff --git a/sensorservice/1.0/vts/functional/Android.bp b/sensorservice/1.0/vts/functional/Android.bp
index 44d8046..72127df 100644
--- a/sensorservice/1.0/vts/functional/Android.bp
+++ b/sensorservice/1.0/vts/functional/Android.bp
@@ -31,7 +31,7 @@ cc_test {
         "android.hardware.sensors@1.0-convert",
     ],
     cflags: [
-        "-O0",
-        "-g",
+        "-Ofast",
+        "-g0",
     ],
 }

project frameworks/ml/
diff --git a/nn/driver/cache/Android.bp b/nn/driver/cache/Android.bp
index ceed7cc0..8cd38d38 100644
--- a/nn/driver/cache/Android.bp
+++ b/nn/driver/cache/Android.bp
@@ -37,7 +37,7 @@ cc_defaults {
     defaults: ["ml_nn_cache_libs_defaults"],
     target: {
         host: {
-            cflags: [ "-O0", "-g" ],
+            cflags: [ "-Ofast", "-g0" ],
         },
     },
 }

project frameworks/native/
diff --git a/libs/vr/libbufferhubqueue/benchmarks/Android.bp b/libs/vr/libbufferhubqueue/benchmarks/Android.bp
index 8ae7a0b8a..c894cb7c7 100644
--- a/libs/vr/libbufferhubqueue/benchmarks/Android.bp
+++ b/libs/vr/libbufferhubqueue/benchmarks/Android.bp
@@ -18,7 +18,7 @@ cc_benchmark {
     cflags: [
         "-DLOG_TAG=\"buffer_transport_benchmark\"",
         "-DTRACE=0",
-        "-O2",
+        "-Ofast",
         "-Wall",
         "-Werror",
     ],
diff --git a/libs/vr/libpdx/Android.bp b/libs/vr/libpdx/Android.bp
index 1a9d7274a..362c573ec 100644
--- a/libs/vr/libpdx/Android.bp
+++ b/libs/vr/libpdx/Android.bp
@@ -65,7 +65,7 @@ cc_test {
         "-Wall",
         "-Wextra",
         "-Werror",
-        "-O2",
+        "-Ofast",
     ],
     srcs: [
         "encoder_performance_test.cpp",

project frameworks/rs/
diff --git a/driver/runtime/Android.mk b/driver/runtime/Android.mk
index 71b5ab2c..31db6150 100755
--- a/driver/runtime/Android.mk
+++ b/driver/runtime/Android.mk
@@ -150,7 +150,7 @@ include $(CLEAR_VARS)
 LOCAL_MODULE := libclcore_g.bc
 rs_g_runtime := 1
 LOCAL_CFLAGS += $(clcore_cflags)
-LOCAL_CFLAGS += -g -O0
+LOCAL_CFLAGS += -g0 -Ofast
 LOCAL_SRC_FILES := $(clcore_base_files) $(clcore_g_files)
 LOCAL_SRC_FILES_32 := $(clcore_base_files_32)
 LOCAL_SRC_FILES_64 := $(clcore_base_files_64)
@@ -168,7 +168,7 @@ LOCAL_MODULE := libclcore_debug_g.bc
 rs_debug_runtime := 1
 rs_g_runtime := 1
 LOCAL_CFLAGS += $(clcore_cflags)
-LOCAL_CFLAGS += -g -O0
+LOCAL_CFLAGS += -g0 -Ofast
 LOCAL_SRC_FILES := $(clcore_base_files)
 LOCAL_SRC_FILES += rs_abi_debuginfo.c
 LOCAL_SRC_FILES_32 := $(clcore_base_files_32)
diff --git a/rsov/compiler/Android.mk b/rsov/compiler/Android.mk
index 9eab5a21..c8d5b5ba 100644
--- a/rsov/compiler/Android.mk
+++ b/rsov/compiler/Android.mk
@@ -100,7 +100,7 @@ LOCAL_SHARED_LIBRARIES := libspirit
 LOCAL_MODULE := Builtin_test
 LOCAL_MULTILIB := first
 LOCAL_MODULE_TAGS := tests
-LOCAL_CFLAGS := -Wall -Werror
+LOCAL_CFLAGS := -Wall -Werror -Ofast
 
 LOCAL_MODULE_CLASS := NATIVE_TESTS
 
@@ -138,7 +138,7 @@ LOCAL_CFLAGS += $(TOOL_CFLAGS) \
   -Wno-error=non-virtual-dtor
 
 ifeq (true, $(FORCE_RS2SPIRV_DEBUG_BUILD))
-  LOCAL_CFLAGS += -O0 -DRS2SPIRV_DEBUG=1
+  LOCAL_CFLAGS += -Ofast -DRS2SPIRV_DEBUG=1
 endif
 
 LOCAL_SHARED_LIBRARIES := libLLVM_android libbcinfo libSPIRV libspirit
@@ -182,7 +182,7 @@ LOCAL_CFLAGS += $(TOOL_CFLAGS) \
   -Wno-error=non-virtual-dtor \
 
 ifeq (true, $(FORCE_RS2SPIRV_DEBUG_BUILD))
-  LOCAL_CFLAGS += -O0 -DRS2SPIRV_DEBUG=1
+  LOCAL_CFLAGS += -Ofast -DRS2SPIRV_DEBUG=1
 endif
 
 include $(LLVM_GEN_INTRINSICS_MK)

project hardware/intel/img/psb_video/
diff --git a/debian/rules b/debian/rules
index bec3f5c..ca605d1 100644
--- a/debian/rules
+++ b/debian/rules
@@ -12,12 +12,12 @@
 
 
 
-CFLAGS = -Wall -g
+CFLAGS = -Wall -g0
 
 ifneq (,$(findstring noopt,$(DEB_BUILD_OPTIONS)))
-	CFLAGS += -O0
+	CFLAGS += -Ofast
 else
-	CFLAGS += -O2
+	CFLAGS += -Ofast
 endif
 
 # shared library versions, option 1

project hardware/interfaces/
diff --git a/Android.bp b/Android.bp
index 5cb85b49..6452bf33 100644
--- a/Android.bp
+++ b/Android.bp
@@ -34,8 +34,8 @@ cc_defaults {
         "libutils",
     ],
     cflags: [
-        "-O0",
-        "-g",
+        "-Ofast",
+        "-g0",
     ],
 
 }
diff --git a/automotive/audiocontrol/1.0/default/Android.bp b/automotive/audiocontrol/1.0/default/Android.bp
index 0e074dd8..a8322b4c 100644
--- a/automotive/audiocontrol/1.0/default/Android.bp
+++ b/automotive/audiocontrol/1.0/default/Android.bp
@@ -33,7 +33,7 @@ cc_binary {
 
     cflags: [
         "-DLOG_TAG=\"AudCntrlDrv\"",
-        "-O0",
-        "-g",
+        "-Ofast",
+        "-g0",
     ],
 }
diff --git a/automotive/evs/1.0/default/Android.bp b/automotive/evs/1.0/default/Android.bp
index 7286478a..28675781 100644
--- a/automotive/evs/1.0/default/Android.bp
+++ b/automotive/evs/1.0/default/Android.bp
@@ -25,7 +25,7 @@ cc_binary {
     ],
 
     cflags: [
-        "-O0",
-        "-g",
+        "-Ofast",
+        "-g0",
     ],
 }
diff --git a/automotive/evs/1.0/vts/functional/Android.bp b/automotive/evs/1.0/vts/functional/Android.bp
index 6ac24589..8d6323fb 100644
--- a/automotive/evs/1.0/vts/functional/Android.bp
+++ b/automotive/evs/1.0/vts/functional/Android.bp
@@ -39,7 +39,7 @@ cc_test {
     static_libs: ["VtsHalHidlTargetTestBase"],
 
     cflags: [
-        "-O0",
-        "-g",
+        "-Ofast",
+        "-g0",
     ],
 }
diff --git a/confirmationui/support/Android.bp b/confirmationui/support/Android.bp
index 62156b34..1b482cdd 100644
--- a/confirmationui/support/Android.bp
+++ b/confirmationui/support/Android.bp
@@ -47,5 +47,5 @@ cc_test {
         "libhidlbase",
     ],
     clang: true,
-    cflags: [ "-O0" ],
+    cflags: [ "-Ofast" ],
 }
diff --git a/graphics/composer/2.1/utils/vts/Android.bp b/graphics/composer/2.1/utils/vts/Android.bp
index 846cfdf3..fe32a615 100644
--- a/graphics/composer/2.1/utils/vts/Android.bp
+++ b/graphics/composer/2.1/utils/vts/Android.bp
@@ -30,8 +30,8 @@ cc_library_static {
         "android.hardware.graphics.composer@2.1-command-buffer",
     ],
     cflags: [
-        "-O0",
-        "-g",
+        "-Ofast",
+        "-g0",
         "-DLOG_TAG=\"ComposerVts\"",
     ],
     export_include_dirs: ["include"],
diff --git a/graphics/composer/2.2/utils/vts/Android.bp b/graphics/composer/2.2/utils/vts/Android.bp
index c6b524d2..7fa3230e 100644
--- a/graphics/composer/2.2/utils/vts/Android.bp
+++ b/graphics/composer/2.2/utils/vts/Android.bp
@@ -38,8 +38,8 @@ cc_library_static {
         "android.hardware.graphics.composer@2.2-command-buffer",
     ],
     cflags: [
-        "-O0",
-        "-g",
+        "-Ofast",
+        "-g0",
         "-DLOG_TAG=\"ComposerVts\"",
     ],
     export_include_dirs: ["include"],
diff --git a/graphics/mapper/2.0/utils/vts/Android.bp b/graphics/mapper/2.0/utils/vts/Android.bp
index 1aa31853..46fcce56 100644
--- a/graphics/mapper/2.0/utils/vts/Android.bp
+++ b/graphics/mapper/2.0/utils/vts/Android.bp
@@ -19,8 +19,8 @@ cc_library_static {
     defaults: ["hidl_defaults"],
     srcs: ["MapperVts.cpp"],
     cflags: [
-        "-O0",
-        "-g",
+        "-Ofast",
+        "-g0",
     ],
     shared_libs: [
         "libutils",
diff --git a/graphics/mapper/2.1/utils/vts/Android.bp b/graphics/mapper/2.1/utils/vts/Android.bp
index ca02aadf..4aa763a8 100644
--- a/graphics/mapper/2.1/utils/vts/Android.bp
+++ b/graphics/mapper/2.1/utils/vts/Android.bp
@@ -19,8 +19,8 @@ cc_library_static {
     defaults: ["hidl_defaults"],
     srcs: ["MapperVts.cpp"],
     cflags: [
-        "-O0",
-        "-g",
+        "-Ofast",
+        "-g0",
     ],
     static_libs: [
         "VtsHalHidlTargetTestBase",

project hardware/qcom/audio-caf/msm8916/
diff --git a/post_proc/Android.mk b/post_proc/Android.mk
index 0c504db7f..779cf6c57 100644
--- a/post_proc/Android.mk
+++ b/post_proc/Android.mk
@@ -1,7 +1,7 @@
 LOCAL_PATH:= $(call my-dir)
 
 qcom_post_proc_common_cflags := \
-    -O2 -fvisibility=hidden \
+    -Ofast -fvisibility=hidden \
     -Wall -Werror \
     -Wno-unused-function \
     -Wno-unused-variable \
diff --git a/visualizer/Android.mk b/visualizer/Android.mk
index bf22fbcb7..8aa1eb843 100644
--- a/visualizer/Android.mk
+++ b/visualizer/Android.mk
@@ -19,7 +19,7 @@ include $(CLEAR_VARS)
 LOCAL_SRC_FILES:= \
 	offload_visualizer.c
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 
 LOCAL_SHARED_LIBRARIES := \
 	libcutils \

project hardware/qcom/audio-caf/msm8952/
diff --git a/post_proc/Android.mk b/post_proc/Android.mk
index 7412658a0..e2f8ec50e 100644
--- a/post_proc/Android.mk
+++ b/post_proc/Android.mk
@@ -2,7 +2,7 @@
 LOCAL_PATH:= $(call my-dir)
 
 qcom_post_proc_common_cflags := \
-    -O2 -fvisibility=hidden \
+    -Ofast -fvisibility=hidden \
     -Wall -Werror \
     -Wno-unused-function \
     -Wno-unused-variable \
diff --git a/visualizer/Android.mk b/visualizer/Android.mk
index ba9e5b5fd..660eca26e 100644
--- a/visualizer/Android.mk
+++ b/visualizer/Android.mk
@@ -19,7 +19,7 @@ include $(CLEAR_VARS)
 LOCAL_SRC_FILES:= \
 	offload_visualizer.c
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 
 LOCAL_SHARED_LIBRARIES := \
 	libcutils \

project hardware/qcom/audio-caf/msm8960/
diff --git a/legacy/libalsa-intf/Makefile.am b/legacy/libalsa-intf/Makefile.am
index 8485d75dc..1d1821555 100644
--- a/legacy/libalsa-intf/Makefile.am
+++ b/legacy/libalsa-intf/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
         -Wstrict-prototypes \
         -Wno-trigraphs \
-        -g -O0 \
+        -g0 -Ofast \
         -fno-inline \
         -fno-short-enums \
         -fpic \
diff --git a/post_proc/Android.mk b/post_proc/Android.mk
index 0738c9889..e80519075 100644
--- a/post_proc/Android.mk
+++ b/post_proc/Android.mk
@@ -2,7 +2,7 @@ ifeq ($(strip $(AUDIO_FEATURE_ENABLED_EXTN_POST_PROC)),true)
 LOCAL_PATH:= $(call my-dir)
 
 qcom_post_proc_common_cflags := \
-    -O2 -fvisibility=hidden \
+    -Ofast -fvisibility=hidden \
     -Wall -Werror \
     -Wno-unused-function \
     -Wno-unused-variable
diff --git a/visualizer/Android.mk b/visualizer/Android.mk
index e81c67881..de75314fb 100644
--- a/visualizer/Android.mk
+++ b/visualizer/Android.mk
@@ -19,7 +19,7 @@ include $(CLEAR_VARS)
 LOCAL_SRC_FILES:= \
 	offload_visualizer.c
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 
 LOCAL_CFLAGS += \
     -Wall \

project hardware/qcom/audio-caf/msm8974/
diff --git a/legacy/libalsa-intf/Makefile.am b/legacy/libalsa-intf/Makefile.am
index a05d07324..f834857ef 100644
--- a/legacy/libalsa-intf/Makefile.am
+++ b/legacy/libalsa-intf/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
         -Wstrict-prototypes \
         -Wno-trigraphs \
-        -g -O0 \
+        -g0 -Ofast \
         -fno-inline \
         -fno-short-enums \
         -fpic \
diff --git a/post_proc/Android.mk b/post_proc/Android.mk
index d36e8b972..9917f99db 100644
--- a/post_proc/Android.mk
+++ b/post_proc/Android.mk
@@ -15,7 +15,7 @@ LOCAL_SRC_FILES:= \
 	reverb.c \
 	effect_api.c
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 LOCAL_CFLAGS+= -Wno-error
 
 LOCAL_SHARED_LIBRARIES := \
diff --git a/visualizer/Android.mk b/visualizer/Android.mk
index 899b31f49..78b9a45ed 100644
--- a/visualizer/Android.mk
+++ b/visualizer/Android.mk
@@ -19,7 +19,7 @@ include $(CLEAR_VARS)
 LOCAL_SRC_FILES:= \
 	offload_visualizer.c
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 LOCAL_CFLAGS+= -Wno-error
 
 LOCAL_HEADER_LIBRARIES := \

project hardware/qcom/audio-caf/msm8994/
diff --git a/mm-audio/aenc-aac/qdsp6/Android.mk b/mm-audio/aenc-aac/qdsp6/Android.mk
index 7561751cc..6198d57ac 100644
--- a/mm-audio/aenc-aac/qdsp6/Android.mk
+++ b/mm-audio/aenc-aac/qdsp6/Android.mk
@@ -7,7 +7,7 @@ include $(CLEAR_VARS)
 #                 Common definitons
 # ---------------------------------------------------------------------------------
 
-libOmxAacEnc-def := -g -O3
+libOmxAacEnc-def := -g0 -Ofast
 libOmxAacEnc-def += -DQC_MODIFIED
 libOmxAacEnc-def += -D_ANDROID_
 libOmxAacEnc-def += -D_ENABLE_QC_MSG_LOG_
diff --git a/mm-audio/aenc-aac/qdsp6/Makefile b/mm-audio/aenc-aac/qdsp6/Makefile
index e9da876d6..93c01edf9 100644
--- a/mm-audio/aenc-aac/qdsp6/Makefile
+++ b/mm-audio/aenc-aac/qdsp6/Makefile
@@ -20,7 +20,7 @@ CPPFLAGS += -DFEATURE_LINUX
 CPPFLAGS += -DFEATURE_NATIVELINUX
 CPPFLAGS += -DFEATURE_DSM_DUP_ITEMS
 
-CPPFLAGS += -g
+CPPFLAGS += -g0
 CPPFALGS += -D_DEBUG
 CPPFLAGS += -Iinc
 
diff --git a/mm-audio/aenc-aac/qdsp6/Makefile.am b/mm-audio/aenc-aac/qdsp6/Makefile.am
index 12800a950..3474cc602 100644
--- a/mm-audio/aenc-aac/qdsp6/Makefile.am
+++ b/mm-audio/aenc-aac/qdsp6/Makefile.am
@@ -4,7 +4,7 @@ AM_CFLAGS = -Wall
 AM_CFLAGS += -Wundef
 AM_CFLAGS += -Wstrict-prototypes
 AM_CFLAGS += -Wno-trigraphs
-AM_CFLAGS += -g -O3
+AM_CFLAGS += -g0 -Ofast
 
 AM_CPPFLAGS = -D__packed__=
 AM_CPPFLAGS += -DIMAGE_APPS_PROC
diff --git a/mm-audio/aenc-amrnb/qdsp6/Android.mk b/mm-audio/aenc-amrnb/qdsp6/Android.mk
index 68dfde922..045031204 100644
--- a/mm-audio/aenc-amrnb/qdsp6/Android.mk
+++ b/mm-audio/aenc-amrnb/qdsp6/Android.mk
@@ -7,7 +7,7 @@ include $(CLEAR_VARS)
 #                 Common definitons
 # ---------------------------------------------------------------------------------
 
-libOmxAmrEnc-def := -g -O3
+libOmxAmrEnc-def := -g0 -Ofast
 libOmxAmrEnc-def += -DQC_MODIFIED
 libOmxAmrEnc-def += -D_ANDROID_
 libOmxAmrEnc-def += -D_ENABLE_QC_MSG_LOG_
diff --git a/mm-audio/aenc-evrc/qdsp6/Android.mk b/mm-audio/aenc-evrc/qdsp6/Android.mk
index 28785757b..4bfee47b2 100644
--- a/mm-audio/aenc-evrc/qdsp6/Android.mk
+++ b/mm-audio/aenc-evrc/qdsp6/Android.mk
@@ -7,7 +7,7 @@ include $(CLEAR_VARS)
 #                 Common definitons
 # ---------------------------------------------------------------------------------
 
-libOmxEvrcEnc-def := -g -O3
+libOmxEvrcEnc-def := -g0 -Ofast
 libOmxEvrcEnc-def += -DQC_MODIFIED
 libOmxEvrcEnc-def += -D_ANDROID_
 libOmxEvrcEnc-def += -D_ENABLE_QC_MSG_LOG_
diff --git a/mm-audio/aenc-qcelp13/qdsp6/Android.mk b/mm-audio/aenc-qcelp13/qdsp6/Android.mk
index b8039d970..046130170 100644
--- a/mm-audio/aenc-qcelp13/qdsp6/Android.mk
+++ b/mm-audio/aenc-qcelp13/qdsp6/Android.mk
@@ -7,7 +7,7 @@ include $(CLEAR_VARS)
 #                 Common definitons
 # ---------------------------------------------------------------------------------
 
-libOmxQcelp13Enc-def := -g -O3
+libOmxQcelp13Enc-def := -g0 -Ofast
 libOmxQcelp13Enc-def += -DQC_MODIFIED
 libOmxQcelp13Enc-def += -D_ANDROID_
 libOmxQcelp13Enc-def += -D_ENABLE_QC_MSG_LOG_
diff --git a/post_proc/Android.mk b/post_proc/Android.mk
index 4ea329520..9df81c76d 100644
--- a/post_proc/Android.mk
+++ b/post_proc/Android.mk
@@ -21,7 +21,7 @@ ifeq ($(strip $(AUDIO_FEATURE_ENABLED_HW_ACCELERATED_EFFECTS)),true)
     LOCAL_SRC_FILES += hw_accelerator.c
 endif
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 LOCAL_CFLAGS += -Wno-sign-compare -Wno-unused-variable -Wno-unused-label -Wno-format
 
 ifeq ($(strip $(AUDIO_FEATURE_ENABLED_DTS_EAGLE)), true)
@@ -62,7 +62,7 @@ LOCAL_SHARED_LIBRARIES := \
 
 LOCAL_MODULE_TAGS := optional
 
-LOCAL_CFLAGS += -O2 -fvisibility=hidden
+LOCAL_CFLAGS += -Ofast -fvisibility=hidden
 LOCAL_CFLAGS += -Wno-sign-compare -Wno-unused-variable -Wno-unused-label -Wno-format
 
 ifeq ($(strip $(AUDIO_FEATURE_ENABLED_DTS_EAGLE)), true)
diff --git a/visualizer/Android.mk b/visualizer/Android.mk
index 3484643a3..c28eed0f0 100644
--- a/visualizer/Android.mk
+++ b/visualizer/Android.mk
@@ -19,7 +19,7 @@ include $(CLEAR_VARS)
 LOCAL_SRC_FILES:= \
 	offload_visualizer.c
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 LOCAL_CFLAGS += -Wno-unused-variable
 
 LOCAL_SHARED_LIBRARIES := \

project hardware/qcom/audio-caf/msm8996/
diff --git a/mm-audio/aenc-amrnb/qdsp6/Makefile.am b/mm-audio/aenc-amrnb/qdsp6/Makefile.am
index 1b7ed7c52..e9159382c 100644
--- a/mm-audio/aenc-amrnb/qdsp6/Makefile.am
+++ b/mm-audio/aenc-amrnb/qdsp6/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
         -Wstrict-prototypes \
         -Wno-trigraphs \
-        -g  -O0 \
+        -g0 -Ofast \
         -fno-inline \
         -fno-short-enums \
         -fpic \
@@ -19,7 +19,7 @@ AM_CPPFLAGS += -DFEATURE_DSM_DUP_ITEMS
 AM_CPPFLAGS += -I ${WORKSPACE}/hardware/qcom/media/mm-core/inc/
 AM_CPPFLAGS += -I $(PKG_CONFIG_SYSROOT_DIR)/usr/include/audio-kernel
 
-AM_CPPFLAGS += -g
+AM_CPPFLAGS += -g0
 AM_CPPFLAGS += -DNDEBUG
 AM_CPPFLAGS += -Iinc
 
diff --git a/post_proc/Android.mk b/post_proc/Android.mk
index fdb9d9505..a37fba0bf 100644
--- a/post_proc/Android.mk
+++ b/post_proc/Android.mk
@@ -42,7 +42,7 @@ ifeq ($(strip $(AUDIO_FEATURE_ENABLED_INSTANCE_ID)), true)
     LOCAL_CFLAGS += -DINSTANCE_ID_ENABLED
 endif
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 
 ifneq ($(strip $(AUDIO_FEATURE_DISABLED_DTS_EAGLE)),true)
     LOCAL_CFLAGS += -DDTS_EAGLE
@@ -115,7 +115,7 @@ LOCAL_SHARED_LIBRARIES := \
 
 LOCAL_MODULE_TAGS := optional
 
-LOCAL_CFLAGS += -O2 -fvisibility=hidden
+LOCAL_CFLAGS += -Ofast -fvisibility=hidden
 
 ifeq ($(strip $(AUDIO_FEATURE_ENABLED_DTS_EAGLE)), true)
 LOCAL_CFLAGS += -DHW_ACC_HPX
@@ -151,7 +151,7 @@ LOCAL_CFLAGS += -Wno-format
 LOCAL_SRC_FILES:= \
         volume_listener.c
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 
 LOCAL_HEADER_LIBRARIES := libhardware_headers \
                           libsystem_headers \
diff --git a/visualizer/Android.mk b/visualizer/Android.mk
index de6bc878a..d09a3d761 100644
--- a/visualizer/Android.mk
+++ b/visualizer/Android.mk
@@ -19,7 +19,7 @@ include $(CLEAR_VARS)
 LOCAL_SRC_FILES:= \
 	offload_visualizer.c
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 
 LOCAL_CFLAGS += -Wno-unused-variable -Wno-unused-parameter -Wno-gnu-designator -Wno-unused-value -Wno-typedef-redefinition
 

project hardware/qcom/audio-caf/msm8998/
diff --git a/mm-audio/aenc-amrnb/qdsp6/Makefile.am b/mm-audio/aenc-amrnb/qdsp6/Makefile.am
index 1b7ed7c52..e9159382c 100644
--- a/mm-audio/aenc-amrnb/qdsp6/Makefile.am
+++ b/mm-audio/aenc-amrnb/qdsp6/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
         -Wstrict-prototypes \
         -Wno-trigraphs \
-        -g  -O0 \
+        -g0 -Ofast \
         -fno-inline \
         -fno-short-enums \
         -fpic \
@@ -19,7 +19,7 @@ AM_CPPFLAGS += -DFEATURE_DSM_DUP_ITEMS
 AM_CPPFLAGS += -I ${WORKSPACE}/hardware/qcom/media/mm-core/inc/
 AM_CPPFLAGS += -I $(PKG_CONFIG_SYSROOT_DIR)/usr/include/audio-kernel
 
-AM_CPPFLAGS += -g
+AM_CPPFLAGS += -g0
 AM_CPPFLAGS += -DNDEBUG
 AM_CPPFLAGS += -Iinc
 
diff --git a/post_proc/Android.mk b/post_proc/Android.mk
index fdb9d9505..a37fba0bf 100644
--- a/post_proc/Android.mk
+++ b/post_proc/Android.mk
@@ -42,7 +42,7 @@ ifeq ($(strip $(AUDIO_FEATURE_ENABLED_INSTANCE_ID)), true)
     LOCAL_CFLAGS += -DINSTANCE_ID_ENABLED
 endif
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 
 ifneq ($(strip $(AUDIO_FEATURE_DISABLED_DTS_EAGLE)),true)
     LOCAL_CFLAGS += -DDTS_EAGLE
@@ -115,7 +115,7 @@ LOCAL_SHARED_LIBRARIES := \
 
 LOCAL_MODULE_TAGS := optional
 
-LOCAL_CFLAGS += -O2 -fvisibility=hidden
+LOCAL_CFLAGS += -Ofast -fvisibility=hidden
 
 ifeq ($(strip $(AUDIO_FEATURE_ENABLED_DTS_EAGLE)), true)
 LOCAL_CFLAGS += -DHW_ACC_HPX
@@ -151,7 +151,7 @@ LOCAL_CFLAGS += -Wno-format
 LOCAL_SRC_FILES:= \
         volume_listener.c
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 
 LOCAL_HEADER_LIBRARIES := libhardware_headers \
                           libsystem_headers \
diff --git a/visualizer/Android.mk b/visualizer/Android.mk
index de6bc878a..d09a3d761 100644
--- a/visualizer/Android.mk
+++ b/visualizer/Android.mk
@@ -19,7 +19,7 @@ include $(CLEAR_VARS)
 LOCAL_SRC_FILES:= \
 	offload_visualizer.c
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 
 LOCAL_CFLAGS += -Wno-unused-variable -Wno-unused-parameter -Wno-gnu-designator -Wno-unused-value -Wno-typedef-redefinition
 

project hardware/qcom/audio-caf/sdm845/
diff --git a/mm-audio/aenc-amrnb/qdsp6/Makefile.am b/mm-audio/aenc-amrnb/qdsp6/Makefile.am
index 1b7ed7c52..e9159382c 100644
--- a/mm-audio/aenc-amrnb/qdsp6/Makefile.am
+++ b/mm-audio/aenc-amrnb/qdsp6/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
         -Wstrict-prototypes \
         -Wno-trigraphs \
-        -g  -O0 \
+        -g0 -Ofast \
         -fno-inline \
         -fno-short-enums \
         -fpic \
@@ -19,7 +19,7 @@ AM_CPPFLAGS += -DFEATURE_DSM_DUP_ITEMS
 AM_CPPFLAGS += -I ${WORKSPACE}/hardware/qcom/media/mm-core/inc/
 AM_CPPFLAGS += -I $(PKG_CONFIG_SYSROOT_DIR)/usr/include/audio-kernel
 
-AM_CPPFLAGS += -g
+AM_CPPFLAGS += -g0
 AM_CPPFLAGS += -DNDEBUG
 AM_CPPFLAGS += -Iinc
 
diff --git a/post_proc/Android.mk b/post_proc/Android.mk
index e2981fa47..4d664db46 100644
--- a/post_proc/Android.mk
+++ b/post_proc/Android.mk
@@ -42,7 +42,7 @@ ifeq ($(strip $(AUDIO_FEATURE_ENABLED_INSTANCE_ID)), true)
     LOCAL_CFLAGS += -DINSTANCE_ID_ENABLED
 endif
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 
 ifneq ($(strip $(AUDIO_FEATURE_DISABLED_DTS_EAGLE)),true)
     LOCAL_CFLAGS += -DDTS_EAGLE
@@ -115,7 +115,7 @@ LOCAL_SHARED_LIBRARIES := \
 
 LOCAL_MODULE_TAGS := optional
 
-LOCAL_CFLAGS += -O2 -fvisibility=hidden
+LOCAL_CFLAGS += -Ofast -fvisibility=hidden
 
 ifeq ($(strip $(AUDIO_FEATURE_ENABLED_DTS_EAGLE)), true)
 LOCAL_CFLAGS += -DHW_ACC_HPX
@@ -151,7 +151,7 @@ LOCAL_CFLAGS += -Wno-format
 LOCAL_SRC_FILES:= \
         volume_listener.c
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 
 LOCAL_HEADER_LIBRARIES := libhardware_headers \
                           libsystem_headers \
diff --git a/visualizer/Android.mk b/visualizer/Android.mk
index e90f57db4..2964cfd4a 100644
--- a/visualizer/Android.mk
+++ b/visualizer/Android.mk
@@ -19,7 +19,7 @@ include $(CLEAR_VARS)
 LOCAL_SRC_FILES:= \
 	offload_visualizer.c
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 
 LOCAL_CFLAGS += -Wno-unused-variable -Wno-unused-parameter -Wno-gnu-designator -Wno-unused-value -Wno-typedef-redefinition
 

project hardware/qcom/audio-caf/sm8150/
diff --git a/mm-audio/aenc-amrnb/qdsp6/Makefile.am b/mm-audio/aenc-amrnb/qdsp6/Makefile.am
index 1b7ed7c52..e9159382c 100644
--- a/mm-audio/aenc-amrnb/qdsp6/Makefile.am
+++ b/mm-audio/aenc-amrnb/qdsp6/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
         -Wstrict-prototypes \
         -Wno-trigraphs \
-        -g  -O0 \
+        -g0 -Ofast \
         -fno-inline \
         -fno-short-enums \
         -fpic \
@@ -19,7 +19,7 @@ AM_CPPFLAGS += -DFEATURE_DSM_DUP_ITEMS
 AM_CPPFLAGS += -I ${WORKSPACE}/hardware/qcom/media/mm-core/inc/
 AM_CPPFLAGS += -I $(PKG_CONFIG_SYSROOT_DIR)/usr/include/audio-kernel
 
-AM_CPPFLAGS += -g
+AM_CPPFLAGS += -g0
 AM_CPPFLAGS += -DNDEBUG
 AM_CPPFLAGS += -Iinc
 
diff --git a/post_proc/Android.mk b/post_proc/Android.mk
index b24b2e859..4bcd24a72 100644
--- a/post_proc/Android.mk
+++ b/post_proc/Android.mk
@@ -48,7 +48,7 @@ ifeq ($(strip $(AUDIO_FEATURE_ENABLED_GCOV)),true)
     LOCAL_STATIC_LIBRARIES += libprofile_rt
 endif
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 
 ifneq ($(strip $(AUDIO_FEATURE_DISABLED_DTS_EAGLE)),true)
     LOCAL_CFLAGS += -DDTS_EAGLE
@@ -121,7 +121,7 @@ LOCAL_SHARED_LIBRARIES := \
 
 LOCAL_MODULE_TAGS := optional
 
-LOCAL_CFLAGS += -O2 -fvisibility=hidden
+LOCAL_CFLAGS += -Ofast -fvisibility=hidden
 
 ifeq ($(strip $(AUDIO_FEATURE_ENABLED_DTS_EAGLE)), true)
 LOCAL_CFLAGS += -DHW_ACC_HPX
@@ -157,7 +157,7 @@ LOCAL_CFLAGS += -Wno-format
 LOCAL_SRC_FILES:= \
         volume_listener.c
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 
 LOCAL_HEADER_LIBRARIES := libhardware_headers \
                           libsystem_headers \
diff --git a/visualizer/Android.mk b/visualizer/Android.mk
index 42cd62ef3..537533274 100644
--- a/visualizer/Android.mk
+++ b/visualizer/Android.mk
@@ -19,7 +19,7 @@ include $(CLEAR_VARS)
 LOCAL_SRC_FILES:= \
 	offload_visualizer.c
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 
 LOCAL_CFLAGS += -Wno-unused-variable -Wno-unused-parameter -Wno-gnu-designator -Wno-unused-value -Wno-typedef-redefinition
 

project hardware/qcom/audio/default/
diff --git a/hal/Android.mk b/hal/Android.mk
index 88dbbe5af..19c7cc71f 100644
--- a/hal/Android.mk
+++ b/hal/Android.mk
@@ -233,8 +233,6 @@ LOCAL_MODULE_OWNER := qcom
 
 LOCAL_PROPRIETARY_MODULE := true
 
-LOCAL_CFLAGS += -Werror
-
 include $(BUILD_SHARED_LIBRARY)
 
 endif
diff --git a/legacy/libalsa-intf/Makefile.am b/legacy/libalsa-intf/Makefile.am
index a05d07324..f834857ef 100644
--- a/legacy/libalsa-intf/Makefile.am
+++ b/legacy/libalsa-intf/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
         -Wstrict-prototypes \
         -Wno-trigraphs \
-        -g -O0 \
+        -g0 -Ofast \
         -fno-inline \
         -fno-short-enums \
         -fpic \
diff --git a/post_proc/Android.mk b/post_proc/Android.mk
index b19e8ad09..447b37331 100644
--- a/post_proc/Android.mk
+++ b/post_proc/Android.mk
@@ -3,7 +3,7 @@ ifneq ($(filter msm8974 msm8226 msm8084 msm8992 msm8994 msm8996 msm8909 msm8998
 LOCAL_PATH:= $(call my-dir)
 
 qcom_post_proc_common_cflags := \
-    -O2 -fvisibility=hidden \
+    -Ofast -fvisibility=hidden \
     -Wall -Werror \
     -Wno-unused-function \
     -Wno-unused-variable \
diff --git a/visualizer/Android.mk b/visualizer/Android.mk
index 13a45c734..094bd7d65 100644
--- a/visualizer/Android.mk
+++ b/visualizer/Android.mk
@@ -19,7 +19,7 @@ include $(CLEAR_VARS)
 LOCAL_SRC_FILES:= \
 	offload_visualizer.c
 
-LOCAL_CFLAGS+= -O2 -fvisibility=hidden
+LOCAL_CFLAGS+= -Ofast -fvisibility=hidden
 
 LOCAL_SHARED_LIBRARIES := \
 	libcutils \

project hardware/qcom/camera/
diff --git a/msm8998/mm-image-codec/qomx_core/Android.mk b/msm8998/mm-image-codec/qomx_core/Android.mk
index fd72b8a..641a4dc 100644
--- a/msm8998/mm-image-codec/qomx_core/Android.mk
+++ b/msm8998/mm-image-codec/qomx_core/Android.mk
@@ -7,8 +7,7 @@ LOCAL_PATH := $(call my-dir)
 include $(CLEAR_VARS)
 LOCAL_MODULE_TAGS := optional
 
-LOCAL_CFLAGS := -Werror \
-                   -g -O0
+LOCAL_CFLAGS := -g0 -Ofast
 
 LOCAL_C_INCLUDES := frameworks/native/include/media/openmax \
                     $(LOCAL_PATH)/../qexif

project hardware/qcom/display-caf/msm8916/
diff --git a/libgralloc/Makefile.am b/libgralloc/Makefile.am
index d188f6f19..9157b0c1a 100644
--- a/libgralloc/Makefile.am
+++ b/libgralloc/Makefile.am
@@ -3,7 +3,7 @@ AM_CFLAGS = -Wundef \
          -Wno-trigraphs \
 	 -Wno-multichar\
 		 -Werror \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \
diff --git a/libqdutils/Makefile.am b/libqdutils/Makefile.am
index 38c19b1f5..83932c266 100644
--- a/libqdutils/Makefile.am
+++ b/libqdutils/Makefile.am
@@ -3,7 +3,7 @@ AM_CFLAGS = -Wundef \
          -Wno-trigraphs \
 	 -Wno-multichar\
 		 -Werror \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \

project hardware/qcom/gps/
diff --git a/msm8084/utils/Makefile.am b/msm8084/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/msm8084/utils/Makefile.am
+++ b/msm8084/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \
diff --git a/msm8909/utils/Makefile.am b/msm8909/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/msm8909/utils/Makefile.am
+++ b/msm8909/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \
diff --git a/msm8960/utils/Makefile.am b/msm8960/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/msm8960/utils/Makefile.am
+++ b/msm8960/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \
diff --git a/msm8974/utils/Makefile.am b/msm8974/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/msm8974/utils/Makefile.am
+++ b/msm8974/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \
diff --git a/msm8994/utils/Makefile.am b/msm8994/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/msm8994/utils/Makefile.am
+++ b/msm8994/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \
diff --git a/msm8996/utils/Makefile.am b/msm8996/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/msm8996/utils/Makefile.am
+++ b/msm8996/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \
diff --git a/utils/Makefile.am b/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/utils/Makefile.am
+++ b/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \

project hardware/qcom/media/
diff --git a/msm8974/mm-core/Android.mk b/msm8974/mm-core/Android.mk
index e2727f5d2..a6a3893a9 100644
--- a/msm8974/mm-core/Android.mk
+++ b/msm8974/mm-core/Android.mk
@@ -3,8 +3,8 @@ ifneq ($(BUILD_TINY_ANDROID),true)
 LOCAL_PATH:= $(call my-dir)
 include $(CLEAR_VARS)
 
-OMXCORE_CFLAGS := -g -O3 -DVERBOSE
-OMXCORE_CFLAGS += -O0 -fno-inline -fno-short-enums
+OMXCORE_CFLAGS := -g0 -Ofast -DVERBOSE
+OMXCORE_CFLAGS += -Ofast -fno-inline -fno-short-enums
 OMXCORE_CFLAGS += -D_ANDROID_
 OMXCORE_CFLAGS += -U_ENABLE_QC_MSG_LOG_
 OMXCORE_CFLAGS += -Wno-error
diff --git a/msm8974/mm-video-v4l2/vidc/vdec.mk b/msm8974/mm-video-v4l2/vidc/vdec.mk
index 740b54ff5..7f79959bb 100644
--- a/msm8974/mm-video-v4l2/vidc/vdec.mk
+++ b/msm8974/mm-video-v4l2/vidc/vdec.mk
@@ -13,7 +13,7 @@ LOCAL_PATH:= $(ROOT_DIR)
 libOmxVdec-def := -D__alignx\(x\)=__attribute__\(\(__aligned__\(x\)\)\)
 libOmxVdec-def += -D__align=__alignx
 libOmxVdec-def += -Dinline=__inline
-libOmxVdec-def += -g -O3
+libOmxVdec-def += -g0 -Ofast
 libOmxVdec-def += -DIMAGE_APPS_PROC
 libOmxVdec-def += -D_ANDROID_
 libOmxVdec-def += -DCDECL
diff --git a/msm8974/mm-video-v4l2/vidc/venc.mk b/msm8974/mm-video-v4l2/vidc/venc.mk
index 49c543680..c2e1f824d 100644
--- a/msm8974/mm-video-v4l2/vidc/venc.mk
+++ b/msm8974/mm-video-v4l2/vidc/venc.mk
@@ -9,7 +9,7 @@ LOCAL_PATH:= $(ROOT_DIR)
 # 				Common definitons
 # ---------------------------------------------------------------------------------
 
-libmm-venc-def := -g -O3 -Dlrintf=_ffix_r
+libmm-venc-def := -g0 -Ofast -Dlrintf=_ffix_r
 libmm-venc-def += -D__align=__alignx
 libmm-venc-def += -D__alignx\(x\)=__attribute__\(\(__aligned__\(x\)\)\)
 libmm-venc-def += -DT_ARM
diff --git a/msm8996/mm-core/Android.mk b/msm8996/mm-core/Android.mk
index 14594d4c3..85c99dff8 100644
--- a/msm8996/mm-core/Android.mk
+++ b/msm8996/mm-core/Android.mk
@@ -3,8 +3,8 @@ ifneq ($(BUILD_TINY_ANDROID),true)
 LOCAL_PATH:= $(call my-dir)
 include $(CLEAR_VARS)
 
-OMXCORE_CFLAGS := -g -O3 -DVERBOSE
-OMXCORE_CFLAGS += -O0 -fno-inline -fno-short-enums
+OMXCORE_CFLAGS := -g0 -Ofast -DVERBOSE
+OMXCORE_CFLAGS += -Ofast -fno-inline -fno-short-enums
 OMXCORE_CFLAGS += -D_ANDROID_
 OMXCORE_CFLAGS += -U_ENABLE_QC_MSG_LOG_
 OMXCORE_CFLAGS += -Wno-error
diff --git a/msm8998/mm-core/Android.mk b/msm8998/mm-core/Android.mk
index 9a55a75f8..1d9939f27 100644
--- a/msm8998/mm-core/Android.mk
+++ b/msm8998/mm-core/Android.mk
@@ -3,8 +3,8 @@ ifneq ($(BUILD_TINY_ANDROID),true)
 LOCAL_PATH:= $(call my-dir)
 include $(CLEAR_VARS)
 
-OMXCORE_CFLAGS := -g -O3 -DVERBOSE
-OMXCORE_CFLAGS += -O0 -fno-inline -fno-short-enums
+OMXCORE_CFLAGS := -g0 -Ofast -DVERBOSE
+OMXCORE_CFLAGS += -Ofast -fno-inline -fno-short-enums
 OMXCORE_CFLAGS += -D_ANDROID_
 OMXCORE_CFLAGS += -U_ENABLE_QC_MSG_LOG_
 OMXCORE_CFLAGS += \
diff --git a/msm8998/mm-core/Makefile.am b/msm8998/mm-core/Makefile.am
index 011e155b7..dc9f31247 100644
--- a/msm8998/mm-core/Makefile.am
+++ b/msm8998/mm-core/Makefile.am
@@ -4,14 +4,14 @@
 #AM_CFLAGS += -Wundef
 #AM_CFLAGS += -Wstrict-prototypes
 #AM_CFLAGS += -Wno-trigraphs
-#AM_CFLAGS += -g -O3
+AM_CFLAGS += -g0 -Ofast
 #AM_CFLAGS += -O0 -fno-inline -fno-short-enums
 #AM_CFLAGS += -fPIC
 
 AM_CPPFLAGS = -D__packed__=
 AM_CPPFLAGS += -D_ANDROID_
 AM_CPPFLAGS += -U_ENABLE_QC_MSG_LOG_
-#AM_CPPFLAGS += -g -O3
+AM_CPPFLAGS += -g0 -Ofast
 #AM_CPPFLAGS += -O0 -fno-inline -fno-short-enums
 AM_CPPFLAGS += -I$(top_srcdir)/mm-core/inc/
 AM_CPPFLAGS += -I$(top_srcdir)/mm-core/src/common/

project hardware/qcom/media-caf/apq8084/
diff --git a/mm-core/Android.mk b/mm-core/Android.mk
index c5a88fd82..f5e1d238a 100644
--- a/mm-core/Android.mk
+++ b/mm-core/Android.mk
@@ -3,8 +3,8 @@ ifneq ($(BUILD_TINY_ANDROID),true)
 LOCAL_PATH:= $(call my-dir)
 include $(CLEAR_VARS)
 
-OMXCORE_CFLAGS := -g -O3 -DVERBOSE
-OMXCORE_CFLAGS += -O0 -fno-inline -fno-short-enums
+OMXCORE_CFLAGS := -g0 -Ofast -DVERBOSE
+OMXCORE_CFLAGS += -Ofast -fno-inline -fno-short-enums
 OMXCORE_CFLAGS += -D_ANDROID_
 OMXCORE_CFLAGS += -U_ENABLE_QC_MSG_LOG_
 

project hardware/qcom/media-caf/msm8916/
diff --git a/mm-core/Android.mk b/mm-core/Android.mk
index 5234239d1..8f76c098c 100644
--- a/mm-core/Android.mk
+++ b/mm-core/Android.mk
@@ -3,8 +3,8 @@ ifneq ($(BUILD_TINY_ANDROID),true)
 LOCAL_PATH:= $(call my-dir)
 include $(CLEAR_VARS)
 
-OMXCORE_CFLAGS := -g -O3 -DVERBOSE
-OMXCORE_CFLAGS += -O0 -fno-inline -fno-short-enums
+OMXCORE_CFLAGS := -g0 -Ofast -DVERBOSE
+OMXCORE_CFLAGS += -Ofast -fno-inline -fno-short-enums
 OMXCORE_CFLAGS += -D_ANDROID_
 OMXCORE_CFLAGS += -U_ENABLE_QC_MSG_LOG_
 OMXCORE_CFLAGS += -Wno-error

project hardware/qcom/media-caf/msm8952/
diff --git a/mm-core/Android.mk b/mm-core/Android.mk
index f306052a7..5ccfc7a26 100644
--- a/mm-core/Android.mk
+++ b/mm-core/Android.mk
@@ -3,8 +3,8 @@ ifneq ($(BUILD_TINY_ANDROID),true)
 LOCAL_PATH:= $(call my-dir)
 include $(CLEAR_VARS)
 
-OMXCORE_CFLAGS := -g -O3 -DVERBOSE
-OMXCORE_CFLAGS += -O0 -fno-inline -fno-short-enums
+OMXCORE_CFLAGS := -g0 -Ofast -DVERBOSE
+OMXCORE_CFLAGS += -Ofast -fno-inline -fno-short-enums
 OMXCORE_CFLAGS += -D_ANDROID_
 OMXCORE_CFLAGS += -U_ENABLE_QC_MSG_LOG_
 

project hardware/qcom/media-caf/msm8974/
diff --git a/mm-core/Android.mk b/mm-core/Android.mk
index f98f3cd4e..3a932b424 100644
--- a/mm-core/Android.mk
+++ b/mm-core/Android.mk
@@ -3,8 +3,8 @@ ifneq ($(BUILD_TINY_ANDROID),true)
 LOCAL_PATH:= $(call my-dir)
 include $(CLEAR_VARS)
 
-OMXCORE_CFLAGS := -g -O3 -DVERBOSE
-OMXCORE_CFLAGS += -O0 -fno-inline -fno-short-enums
+OMXCORE_CFLAGS := -g0 -Ofast -DVERBOSE
+OMXCORE_CFLAGS += -Ofast -fno-inline -fno-short-enums
 OMXCORE_CFLAGS += -D_ANDROID_
 OMXCORE_CFLAGS += -U_ENABLE_QC_MSG_LOG_
 

project hardware/qcom/media-caf/msm8994/
diff --git a/mm-core/Android.mk b/mm-core/Android.mk
index c8ad43f4b..b45f6bf64 100644
--- a/mm-core/Android.mk
+++ b/mm-core/Android.mk
@@ -3,8 +3,8 @@ ifneq ($(BUILD_TINY_ANDROID),true)
 LOCAL_PATH:= $(call my-dir)
 include $(CLEAR_VARS)
 
-OMXCORE_CFLAGS := -g -O3 -DVERBOSE
-OMXCORE_CFLAGS += -O0 -fno-inline -fno-short-enums
+OMXCORE_CFLAGS := -g0 -Ofast -DVERBOSE
+OMXCORE_CFLAGS += -Ofast -fno-inline -fno-short-enums
 OMXCORE_CFLAGS += -D_ANDROID_
 OMXCORE_CFLAGS += -U_ENABLE_QC_MSG_LOG_
 
diff --git a/mm-video-v4l2/vidc/common/Android.mk b/mm-video-v4l2/vidc/common/Android.mk
index 6f783c429..535a1314d 100644
--- a/mm-video-v4l2/vidc/common/Android.mk
+++ b/mm-video-v4l2/vidc/common/Android.mk
@@ -7,13 +7,12 @@ LOCAL_PATH:= $(ROOT_DIR)
 # 				Common definitons
 # ---------------------------------------------------------------------------------
 
-libmm-vidc-def := -g -O3 -Dlrintf=_ffix_r
+libmm-vidc-def := -g0 -Ofast -Dlrintf=_ffix_r
 libmm-vidc-def += -D__align=__alignx
 libmm-vidc-def += -D__alignx\(x\)=__attribute__\(\(__aligned__\(x\)\)\)
 libmm-vidc-def += -DT_ARM
 libmm-vidc-def += -Dinline=__inline
 libmm-vidc-def += -D_ANDROID_
-libmm-vidc-def += -Werror
 libmm-vidc-def += -D_ANDROID_ICS_
 
 # ---------------------------------------------------------------------------------
diff --git a/mm-video-v4l2/vidc/vdec/Android.mk b/mm-video-v4l2/vidc/vdec/Android.mk
index aedca2059..8e5632529 100644
--- a/mm-video-v4l2/vidc/vdec/Android.mk
+++ b/mm-video-v4l2/vidc/vdec/Android.mk
@@ -8,7 +8,7 @@ include $(CLEAR_VARS)
 libmm-vdec-def := -D__alignx\(x\)=__attribute__\(\(__aligned__\(x\)\)\)
 libmm-vdec-def += -D__align=__alignx
 libmm-vdec-def += -Dinline=__inline
-libmm-vdec-def += -g -O3
+libmm-vdec-def += -g0 -Ofast
 libmm-vdec-def += -DIMAGE_APPS_PROC
 libmm-vdec-def += -D_ANDROID_
 libmm-vdec-def += -DCDECL
@@ -97,7 +97,7 @@ include $(CLEAR_VARS)
 LOCAL_MODULE                    := libOmxVdec
 LOCAL_MODULE_TAGS               := optional
 LOCAL_VENDOR_MODULE             := true
-LOCAL_CFLAGS                    := $(libmm-vdec-def) -Werror
+LOCAL_CFLAGS                    := $(libmm-vdec-def)
 LOCAL_C_INCLUDES                += $(libmm-vdec-inc)
 
 LOCAL_HEADER_LIBRARIES := generated_kernel_headers
diff --git a/mm-video-v4l2/vidc/venc/Android.mk b/mm-video-v4l2/vidc/venc/Android.mk
index ff43abdcd..206bccf92 100644
--- a/mm-video-v4l2/vidc/venc/Android.mk
+++ b/mm-video-v4l2/vidc/venc/Android.mk
@@ -5,7 +5,7 @@ include $(CLEAR_VARS)
 # 				Common definitons
 # ---------------------------------------------------------------------------------
 
-libmm-venc-def := -g -O3 -Dlrintf=_ffix_r
+libmm-venc-def := -g0 -Ofast -Dlrintf=_ffix_r
 libmm-venc-def += -D__align=__alignx
 libmm-venc-def += -D__alignx\(x\)=__attribute__\(\(__aligned__\(x\)\)\)
 libmm-venc-def += -DT_ARM
@@ -17,7 +17,6 @@ libmm-venc-def += -DENABLE_DEBUG_ERROR
 libmm-venc-def += -UINPUT_BUFFER_LOG
 libmm-venc-def += -UOUTPUT_BUFFER_LOG
 libmm-venc-def += -USINGLE_ENCODER_INSTANCE
-libmm-venc-def += -Werror
 libmm-venc-def += -D_ANDROID_ICS_
 libmm-venc-def += -D_MSM8974_
 

project hardware/qcom/media-caf/msm8996/
diff --git a/mm-core/Android.mk b/mm-core/Android.mk
index e4922cb04..c11af148e 100644
--- a/mm-core/Android.mk
+++ b/mm-core/Android.mk
@@ -3,8 +3,8 @@ ifneq ($(BUILD_TINY_ANDROID),true)
 LOCAL_PATH:= $(call my-dir)
 include $(CLEAR_VARS)
 
-OMXCORE_CFLAGS := -g -O3 -DVERBOSE
-OMXCORE_CFLAGS += -O0 -fno-inline -fno-short-enums
+OMXCORE_CFLAGS := -g0 -Ofast -DVERBOSE
+OMXCORE_CFLAGS += -Ofast -fno-inline -fno-short-enums
 OMXCORE_CFLAGS += -D_ANDROID_
 OMXCORE_CFLAGS += -U_ENABLE_QC_MSG_LOG_
 
diff --git a/mm-core/Makefile.am b/mm-core/Makefile.am
index 011e155b7..dc9f31247 100644
--- a/mm-core/Makefile.am
+++ b/mm-core/Makefile.am
@@ -4,14 +4,14 @@
 #AM_CFLAGS += -Wundef
 #AM_CFLAGS += -Wstrict-prototypes
 #AM_CFLAGS += -Wno-trigraphs
-#AM_CFLAGS += -g -O3
+AM_CFLAGS += -g0 -Ofast
 #AM_CFLAGS += -O0 -fno-inline -fno-short-enums
 #AM_CFLAGS += -fPIC
 
 AM_CPPFLAGS = -D__packed__=
 AM_CPPFLAGS += -D_ANDROID_
 AM_CPPFLAGS += -U_ENABLE_QC_MSG_LOG_
-#AM_CPPFLAGS += -g -O3
+AM_CPPFLAGS += -g0 -Ofast
 #AM_CPPFLAGS += -O0 -fno-inline -fno-short-enums
 AM_CPPFLAGS += -I$(top_srcdir)/mm-core/inc/
 AM_CPPFLAGS += -I$(top_srcdir)/mm-core/src/common/

project hardware/qcom/media-caf/msm8998/
diff --git a/mm-core/Android.mk b/mm-core/Android.mk
index b9231096b..94cc88832 100644
--- a/mm-core/Android.mk
+++ b/mm-core/Android.mk
@@ -3,8 +3,8 @@ ifneq ($(BUILD_TINY_ANDROID),true)
 LOCAL_PATH:= $(call my-dir)
 include $(CLEAR_VARS)
 
-OMXCORE_CFLAGS := -g -O3 -DVERBOSE
-OMXCORE_CFLAGS += -O0 -fno-inline -fno-short-enums
+OMXCORE_CFLAGS := -g0 -Ofast -DVERBOSE
+OMXCORE_CFLAGS += -Ofast -fno-inline -fno-short-enums
 OMXCORE_CFLAGS += -D_ANDROID_
 OMXCORE_CFLAGS += -U_ENABLE_QC_MSG_LOG_
 
diff --git a/mm-core/Makefile.am b/mm-core/Makefile.am
index 011e155b7..dc9f31247 100644
--- a/mm-core/Makefile.am
+++ b/mm-core/Makefile.am
@@ -4,14 +4,14 @@
 #AM_CFLAGS += -Wundef
 #AM_CFLAGS += -Wstrict-prototypes
 #AM_CFLAGS += -Wno-trigraphs
-#AM_CFLAGS += -g -O3
+AM_CFLAGS += -g0 -Ofast
 #AM_CFLAGS += -O0 -fno-inline -fno-short-enums
 #AM_CFLAGS += -fPIC
 
 AM_CPPFLAGS = -D__packed__=
 AM_CPPFLAGS += -D_ANDROID_
 AM_CPPFLAGS += -U_ENABLE_QC_MSG_LOG_
-#AM_CPPFLAGS += -g -O3
+AM_CPPFLAGS += -g0 -Ofast
 #AM_CPPFLAGS += -O0 -fno-inline -fno-short-enums
 AM_CPPFLAGS += -I$(top_srcdir)/mm-core/inc/
 AM_CPPFLAGS += -I$(top_srcdir)/mm-core/src/common/

project hardware/qcom/media-caf/sdm845/
diff --git a/mm-core/Android.mk b/mm-core/Android.mk
index 25364bde9..183419b65 100644
--- a/mm-core/Android.mk
+++ b/mm-core/Android.mk
@@ -3,8 +3,8 @@ ifneq ($(BUILD_TINY_ANDROID),true)
 LOCAL_PATH:= $(call my-dir)
 include $(CLEAR_VARS)
 
-OMXCORE_CFLAGS := -g -O3 -DVERBOSE
-OMXCORE_CFLAGS += -O0 -fno-inline -fno-short-enums
+OMXCORE_CFLAGS := -g0 -Ofast -DVERBOSE
+OMXCORE_CFLAGS += -Ofast -fno-inline -fno-short-enums
 OMXCORE_CFLAGS += -D_ANDROID_
 OMXCORE_CFLAGS += -U_ENABLE_QC_MSG_LOG_
 
diff --git a/mm-core/Makefile.am b/mm-core/Makefile.am
index 834964759..5f545853c 100644
--- a/mm-core/Makefile.am
+++ b/mm-core/Makefile.am
@@ -4,14 +4,14 @@
 #AM_CFLAGS += -Wundef
 #AM_CFLAGS += -Wstrict-prototypes
 #AM_CFLAGS += -Wno-trigraphs
-#AM_CFLAGS += -g -O3
+AM_CFLAGS += -g0 -Ofast
 #AM_CFLAGS += -O0 -fno-inline -fno-short-enums
 #AM_CFLAGS += -fPIC
 
 AM_CPPFLAGS = -D__packed__=
 AM_CPPFLAGS += -D_ANDROID_
 AM_CPPFLAGS += -D_ENABLE_QC_MSG_LOG_
-#AM_CPPFLAGS += -g -O3
+AM_CPPFLAGS += -g0 -Ofast
 #AM_CPPFLAGS += -O0 -fno-inline -fno-short-enums
 AM_CPPFLAGS += -I$(top_srcdir)/mm-core/inc/
 AM_CPPFLAGS += -I$(top_srcdir)/mm-core/src/common/

project hardware/qcom/media-caf/sm8150/
diff --git a/mm-core/Android.mk b/mm-core/Android.mk
index fba891194..32a916d25 100644
--- a/mm-core/Android.mk
+++ b/mm-core/Android.mk
@@ -3,8 +3,8 @@ ifneq ($(BUILD_TINY_ANDROID),true)
 LOCAL_PATH:= $(call my-dir)
 include $(CLEAR_VARS)
 
-OMXCORE_CFLAGS := -g -O3 -DVERBOSE
-OMXCORE_CFLAGS += -O0 -fno-inline -fno-short-enums
+OMXCORE_CFLAGS := -g0 -Ofast -DVERBOSE
+OMXCORE_CFLAGS += -Ofast -fno-inline -fno-short-enums
 OMXCORE_CFLAGS += -D_ANDROID_
 OMXCORE_CFLAGS += -U_ENABLE_QC_MSG_LOG_
 
diff --git a/mm-core/Makefile.am b/mm-core/Makefile.am
index 4b544dac8..7a213836e 100644
--- a/mm-core/Makefile.am
+++ b/mm-core/Makefile.am
@@ -4,14 +4,14 @@
 #AM_CFLAGS += -Wundef
 #AM_CFLAGS += -Wstrict-prototypes
 #AM_CFLAGS += -Wno-trigraphs
-#AM_CFLAGS += -g -O3
+AM_CFLAGS += -g0 -Ofast
 #AM_CFLAGS += -O0 -fno-inline -fno-short-enums
 #AM_CFLAGS += -fPIC
 
 AM_CPPFLAGS = -D__packed__=
 AM_CPPFLAGS += -D_ANDROID_
 AM_CPPFLAGS += -U_ENABLE_QC_MSG_LOG_
-#AM_CPPFLAGS += -g -O3
+AM_CPPFLAGS += -g0 -Ofast
 #AM_CPPFLAGS += -O0 -fno-inline -fno-short-enums
 AM_CPPFLAGS += -I$(top_srcdir)/mm-core/inc/
 AM_CPPFLAGS += -I$(top_srcdir)/mm-core/src/common/

project hardware/qcom/sdm710/gps/
diff --git a/msm8084/utils/Makefile.am b/msm8084/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/msm8084/utils/Makefile.am
+++ b/msm8084/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \
diff --git a/msm8909/utils/Makefile.am b/msm8909/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/msm8909/utils/Makefile.am
+++ b/msm8909/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \
diff --git a/msm8960/utils/Makefile.am b/msm8960/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/msm8960/utils/Makefile.am
+++ b/msm8960/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \
diff --git a/msm8994/utils/Makefile.am b/msm8994/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/msm8994/utils/Makefile.am
+++ b/msm8994/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \
diff --git a/msm8996/utils/Makefile.am b/msm8996/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/msm8996/utils/Makefile.am
+++ b/msm8996/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \
diff --git a/sdm845/utils/Makefile.am b/sdm845/utils/Makefile.am
index 3801fdd..1c17a80 100644
--- a/sdm845/utils/Makefile.am
+++ b/sdm845/utils/Makefile.am
@@ -3,7 +3,7 @@ ACLOCAL_AMFLAGS = -I m4
 AM_CFLAGS = -Wundef \
         -MD \
         -Wno-trigraphs \
-        -g -O0 \
+        -g0 -Ofast \
         -fno-inline \
         -fno-short-enums \
         -fpic \
diff --git a/utils/Makefile.am b/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/utils/Makefile.am
+++ b/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \

project hardware/qcom/sdm710/media/
diff --git a/mm-core/Android.mk b/mm-core/Android.mk
index 6a9c6915..e13f0a0d 100644
--- a/mm-core/Android.mk
+++ b/mm-core/Android.mk
@@ -3,8 +3,8 @@ ifneq ($(BUILD_TINY_ANDROID),true)
 LOCAL_PATH:= $(call my-dir)
 include $(CLEAR_VARS)
 
-OMXCORE_CFLAGS := -g -O3 -DVERBOSE
-OMXCORE_CFLAGS += -O0 -fno-inline -fno-short-enums
+OMXCORE_CFLAGS := -g0 -Ofast -DVERBOSE
+OMXCORE_CFLAGS += -Ofast -fno-inline -fno-short-enums
 OMXCORE_CFLAGS += -D_ANDROID_
 OMXCORE_CFLAGS += -U_ENABLE_QC_MSG_LOG_
 
diff --git a/mm-core/Makefile.am b/mm-core/Makefile.am
index 9fa9b32f..6cf6bf9f 100644
--- a/mm-core/Makefile.am
+++ b/mm-core/Makefile.am
@@ -4,14 +4,14 @@
 #AM_CFLAGS += -Wundef
 #AM_CFLAGS += -Wstrict-prototypes
 #AM_CFLAGS += -Wno-trigraphs
-#AM_CFLAGS += -g -O3
+AM_CFLAGS += -g0 -Ofast
 #AM_CFLAGS += -O0 -fno-inline -fno-short-enums
 #AM_CFLAGS += -fPIC
 
 AM_CPPFLAGS = -D__packed__=
 AM_CPPFLAGS += -D_ANDROID_
 AM_CPPFLAGS += -D_ENABLE_QC_MSG_LOG_
-#AM_CPPFLAGS += -g -O3
+AM_CPPFLAGS += -g0 -Ofast
 #AM_CPPFLAGS += -O0 -fno-inline -fno-short-enums
 AM_CPPFLAGS += -I$(top_srcdir)/mm-core/inc/
 AM_CPPFLAGS += -I$(top_srcdir)/mm-core/src/common/

project hardware/qcom/sdm845/gps/
diff --git a/msm8084/utils/Makefile.am b/msm8084/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/msm8084/utils/Makefile.am
+++ b/msm8084/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \
diff --git a/msm8909/utils/Makefile.am b/msm8909/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/msm8909/utils/Makefile.am
+++ b/msm8909/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \
diff --git a/msm8960/utils/Makefile.am b/msm8960/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/msm8960/utils/Makefile.am
+++ b/msm8960/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \
diff --git a/msm8994/utils/Makefile.am b/msm8994/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/msm8994/utils/Makefile.am
+++ b/msm8994/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \
diff --git a/msm8996/utils/Makefile.am b/msm8996/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/msm8996/utils/Makefile.am
+++ b/msm8996/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \
diff --git a/sdm845/utils/Makefile.am b/sdm845/utils/Makefile.am
index 3801fdd..1c17a80 100644
--- a/sdm845/utils/Makefile.am
+++ b/sdm845/utils/Makefile.am
@@ -3,7 +3,7 @@ ACLOCAL_AMFLAGS = -I m4
 AM_CFLAGS = -Wundef \
         -MD \
         -Wno-trigraphs \
-        -g -O0 \
+        -g0 -Ofast \
         -fno-inline \
         -fno-short-enums \
         -fpic \
diff --git a/utils/Makefile.am b/utils/Makefile.am
index e5935f0..fbe8349 100644
--- a/utils/Makefile.am
+++ b/utils/Makefile.am
@@ -1,7 +1,7 @@
 AM_CFLAGS = -Wundef \
          -MD \
          -Wno-trigraphs \
-         -g -O0 \
+         -g0 -Ofast \
          -fno-inline \
          -fno-short-enums \
          -fpic \

project hardware/qcom/sdm845/media/
diff --git a/mm-core/Android.mk b/mm-core/Android.mk
index c9cb62aa..09c0ab8b 100755
--- a/mm-core/Android.mk
+++ b/mm-core/Android.mk
@@ -3,8 +3,8 @@ ifneq ($(BUILD_TINY_ANDROID),true)
 LOCAL_PATH:= $(call my-dir)
 include $(CLEAR_VARS)
 
-OMXCORE_CFLAGS := -g -O3 -DVERBOSE
-OMXCORE_CFLAGS += -O0 -fno-inline -fno-short-enums
+OMXCORE_CFLAGS := -g0 -Ofast -DVERBOSE
+OMXCORE_CFLAGS += -Ofast -fno-inline -fno-short-enums
 OMXCORE_CFLAGS += -D_ANDROID_
 OMXCORE_CFLAGS += -U_ENABLE_QC_MSG_LOG_
 OMXCORE_CFLAGS += -Wno-error
diff --git a/mm-core/Makefile.am b/mm-core/Makefile.am
index 9fa9b32f..6cf6bf9f 100644
--- a/mm-core/Makefile.am
+++ b/mm-core/Makefile.am
@@ -4,14 +4,14 @@
 #AM_CFLAGS += -Wundef
 #AM_CFLAGS += -Wstrict-prototypes
 #AM_CFLAGS += -Wno-trigraphs
-#AM_CFLAGS += -g -O3
+AM_CFLAGS += -g0 -Ofast
 #AM_CFLAGS += -O0 -fno-inline -fno-short-enums
 #AM_CFLAGS += -fPIC
 
 AM_CPPFLAGS = -D__packed__=
 AM_CPPFLAGS += -D_ANDROID_
 AM_CPPFLAGS += -D_ENABLE_QC_MSG_LOG_
-#AM_CPPFLAGS += -g -O3
+AM_CPPFLAGS += -g0 -Ofast
 #AM_CPPFLAGS += -O0 -fno-inline -fno-short-enums
 AM_CPPFLAGS += -I$(top_srcdir)/mm-core/inc/
 AM_CPPFLAGS += -I$(top_srcdir)/mm-core/src/common/

project hardware/qcom/wlan-caf/
diff --git a/cld80211-lib/Makefile.am b/cld80211-lib/Makefile.am
index 19cdc49..43df31d 100644
--- a/cld80211-lib/Makefile.am
+++ b/cld80211-lib/Makefile.am
@@ -4,9 +4,9 @@ ACLOCAL_AMFLAGS = -I m4
 AM_CFLAGS = -Wall
 
 if DEBUG
-AM_CFLAGS += -g
+AM_CFLAGS += -g0
 else
-AM_CFLAGS += -O2
+AM_CFLAGS += -Ofast
 endif
 
 AM_CFLAGS += -Wno-unused-parameter -Wno-int-to-pointer-cast \

project lineage-sdk/
diff --git a/packages/LineageSettingsProvider/Android.bp b/packages/LineageSettingsProvider/Android.bp
index 3b9d3e6..076d6c9 100644
--- a/packages/LineageSettingsProvider/Android.bp
+++ b/packages/LineageSettingsProvider/Android.bp
@@ -14,20 +14,3 @@
 // limitations under the License.
 //
 
-android_app {
-    srcs: ["src/**/*.java"],
-    resource_dirs: ["res"],
-
-    name: "LineageSettingsProvider",
-    certificate: "platform",
-    privileged: true,
-
-    static_libs: [
-        "android-support-v4",
-        "android-support-v7-appcompat",
-        "android-support-v7-preference",
-        "android-support-v7-recyclerview",
-        "android-support-v14-preference",
-        "org.lineageos.platform.internal",
-    ],
-}

project packages/apps/AudioFX/
diff --git a/Android.mk b/Android.mk
index ba2c9ba..792d600 100644
--- a/Android.mk
+++ b/Android.mk
@@ -1,35 +1 @@
-ifneq ($(TARGET_EXCLUDES_AUDIOFX),true)
-
-LOCAL_PATH := $(call my-dir)
-
-include $(CLEAR_VARS)
-LOCAL_PACKAGE_NAME	:= AudioFX
-LOCAL_MODULE_TAGS	:= optional
-
-LOCAL_SRC_FILES := $(call all-java-files-under, src)
-
-LOCAL_STATIC_ANDROID_LIBRARIES := \
-    android-support-v4
-
-LOCAL_STATIC_JAVA_LIBRARIES := \
-    org.lineageos.platform.internal
-
-LOCAL_RESOURCE_DIR := $(LOCAL_PATH)/res
-LOCAL_USE_AAPT2 := true
-
-LOCAL_PROGUARD_ENABLED := disabled
-
-LOCAL_PRIVATE_PLATFORM_APIS := true
-
-LOCAL_PRIVILEGED_MODULE := true
-
-LOCAL_CERTIFICATE := platform
-
-include $(BUILD_PACKAGE)
-
-# Use the following include to make our test apk.
-ifeq (,$(ONE_SHOT_MAKEFILE))
-include $(call all-makefiles-under,$(LOCAL_PATH))
-endif
-
-endif # TARGET_EXCLUDES_AUDIOFX
+#

project packages/apps/Bluetooth/
diff --git a/tests/Android.mk b/tests/Android.mk
index fd297e35..792d6005 100644
--- a/tests/Android.mk
+++ b/tests/Android.mk
@@ -1,5 +1 @@
-LOCAL_PATH := $(call my-dir)
-include $(CLEAR_VARS)
-
-# Include all makefiles in subdirectories
-include $(call all-makefiles-under,$(LOCAL_PATH))
+#

project packages/apps/Calendar/
diff --git a/Android.mk b/Android.mk
index 656f3847..792d6005 100644
--- a/Android.mk
+++ b/Android.mk
@@ -1,52 +1 @@
-LOCAL_PATH:= $(call my-dir)
-include $(CLEAR_VARS)
-
-# Include res dir from chips
-chips_dir := ../../../frameworks/opt/chips/res
-color_picker_dir := ../../../frameworks/opt/colorpicker/res
-datetimepicker_dir := ../../../frameworks/opt/datetimepicker/res
-timezonepicker_dir := ../../../frameworks/opt/timezonepicker/res
-res_dirs := $(chips_dir) $(color_picker_dir) $(datetimepicker_dir) $(timezonepicker_dir) res
-src_dirs := src
-
-LOCAL_JACK_COVERAGE_INCLUDE_FILTER := com.android.calendar.*
-
-LOCAL_MODULE_TAGS := optional
-
-LOCAL_SRC_FILES := $(call all-java-files-under,$(src_dirs))
-
-# bundled
-#LOCAL_STATIC_JAVA_LIBRARIES += \
-#        android-common \
-#        libchips \
-#        calendar-common
-
-# unbundled
-LOCAL_STATIC_JAVA_LIBRARIES := \
-        android-common \
-        libchips \
-        colorpicker \
-        android-opt-datetimepicker \
-        android-opt-timezonepicker \
-        android-support-v4 \
-        calendar-common
-
-LOCAL_SDK_VERSION := current
-
-LOCAL_RESOURCE_DIR := $(addprefix $(LOCAL_PATH)/, $(res_dirs))
-
-LOCAL_PACKAGE_NAME := Calendar
-
-LOCAL_PROGUARD_FLAG_FILES := proguard.flags \
-                             ../../../frameworks/opt/datetimepicker/proguard.flags
-
-LOCAL_AAPT_FLAGS := --auto-add-overlay
-LOCAL_AAPT_FLAGS += --extra-packages com.android.ex.chips
-LOCAL_AAPT_FLAGS += --extra-packages com.android.colorpicker
-LOCAL_AAPT_FLAGS += --extra-packages com.android.datetimepicker
-LOCAL_AAPT_FLAGS += --extra-packages com.android.timezonepicker
-
-include $(BUILD_PACKAGE)
-
-# Use the following include to make our test apk.
-include $(call all-makefiles-under,$(LOCAL_PATH))
+#

project packages/apps/Email/
diff --git a/Android.mk b/Android.mk
index cfc205b89..c54a7949e 100644
--- a/Android.mk
+++ b/Android.mk
@@ -12,69 +12,3 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-LOCAL_PATH := $(call my-dir)
-
-# Build the Email application itself, along with its tests and tests for the emailcommon
-# static library.  All tests can be run via runtest email
-
-include $(CLEAR_VARS)
-
-unified_email_dir := ../UnifiedEmail
-res_dir := res $(unified_email_dir)/res
-
-LOCAL_MODULE_TAGS := optional
-
-LOCAL_SRC_FILES := $(call all-java-files-under, $(unified_email_dir)/src)
-LOCAL_SRC_FILES += $(call all-java-files-under, src/com/android)
-LOCAL_SRC_FILES += $(call all-java-files-under, provider_src/com/android)
-LOCAL_SRC_FILES += $(call all-java-files-under, src/com/beetstra)
-
-LOCAL_RESOURCE_DIR := $(addprefix $(LOCAL_PATH)/, $(res_dir))
-LOCAL_USE_AAPT2 := true
-
-# Use assets dir from UnifiedEmail
-# (the default package target doesn't seem to deal with multiple asset dirs)
-LOCAL_ASSET_DIR := $(LOCAL_PATH)/$(unified_email_dir)/assets
-
-LOCAL_AAPT_FLAGS := --auto-add-overlay
-LOCAL_AAPT_FLAGS += --extra-packages com.android.mail:com.android.email:com.android.emailcommon
-
-LOCAL_STATIC_ANDROID_LIBRARIES := \
-    com.android.emailcommon \
-    libchips \
-    libphotoviewer_appcompat \
-    android-opt-bitmap \
-    android-opt-datetimepicker \
-    android-support-compat \
-    android-support-media-compat \
-    android-support-core-utils \
-    android-support-core-ui \
-    android-support-fragment \
-    android-support-v7-appcompat \
-    android-support-v7-gridlayout \
-    android-support-v13
-
-LOCAL_STATIC_JAVA_LIBRARIES := \
-    android-support-annotations \
-    android-common \
-    guava \
-    owasp-html-sanitizer
-
-LOCAL_JAVA_LIBRARIES := org.apache.http.legacy
-
-LOCAL_PACKAGE_NAME := Email
-
-LOCAL_PROGUARD_FLAG_FILES := proguard.flags $(unified_email_dir)/proguard.flags
-ifeq (eng,$(TARGET_BUILD_VARIANT))
-  LOCAL_PROGUARD_FLAG_FILES += proguard-test.flags
-endif
-
-LOCAL_SDK_VERSION := current
-
-include $(BUILD_PACKAGE)
-
-# only include rules to build other stuff for the original package, not the derived package.
-ifeq ($(strip $(LOCAL_PACKAGE_OVERRIDES)),)
-# additionally, build unit tests in a separate .apk
-include $(call all-makefiles-under,$(LOCAL_PATH))
-endif

project packages/apps/Exchange/
diff --git a/Android.mk b/Android.mk
index a3a7d20b..c54a7949 100644
--- a/Android.mk
+++ b/Android.mk
@@ -12,39 +12,3 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-LOCAL_PATH:= $(call my-dir)
-include $(CLEAR_VARS)
-
-#
-# Exchange2
-#
-LOCAL_MODULE_TAGS := optional
-
-# Include res dir from emailcommon
-emailcommon_dir := ../Email/emailcommon
-res_dir := res $(emailcommon_dir)/res
-
-LOCAL_RESOURCE_DIR := $(addprefix $(LOCAL_PATH)/, $(res_dir))
-
-LOCAL_AAPT_FLAGS := --auto-add-overlay
-LOCAL_AAPT_FLAGS += --extra-packages com.android.emailcommon
-
-LOCAL_SRC_FILES := $(call all-java-files-under, src)
-LOCAL_SRC_FILES += $(call all-java-files-under, build/src)
-
-LOCAL_STATIC_JAVA_LIBRARIES := android-common com.android.emailcommon
-LOCAL_STATIC_JAVA_LIBRARIES += calendar-common
-LOCAL_STATIC_JAVA_LIBRARIES += android-support-v4
-
-LOCAL_PACKAGE_NAME := Exchange2
-LOCAL_OVERRIDES_PACKAGES := Exchange
-
-LOCAL_PROGUARD_FLAG_FILES := proguard.flags
-LOCAL_SDK_VERSION := 19
-
-LOCAL_JACK_COVERAGE_INCLUDE_FILTER += com.android.exchange.*
-
-include $(BUILD_PACKAGE)
-
-# additionally, build unit tests in a separate .apk
-include $(call all-makefiles-under,$(LOCAL_PATH))

project packages/apps/LockClock/
diff --git a/Android.mk b/Android.mk
index 603f888..7fb560b 100644
--- a/Android.mk
+++ b/Android.mk
@@ -14,25 +14,3 @@
 # limitations under the License.
 #
 
-LOCAL_PATH := $(call my-dir)
-include $(CLEAR_VARS)
-
-LOCAL_SRC_FILES := $(call all-java-files-under, src)
-
-LOCAL_PRIVATE_PLATFORM_APIS := true
-LOCAL_PACKAGE_NAME := LockClock
-LOCAL_PROGUARD_FLAG_FILES := proguard.flags
-
-LOCAL_RESOURCE_DIR := $(LOCAL_PATH)/res
-LOCAL_USE_AAPT2 := true
-
-LOCAL_STATIC_ANDROID_LIBRARIES := \
-    android-support-v4 \
-    android-support-v7-appcompat \
-    android-support-v7-preference \
-    android-support-v7-recyclerview
-
-LOCAL_STATIC_JAVA_LIBRARIES := \
-    org.lineageos.platform.internal
-
-include $(BUILD_PACKAGE)

project packages/apps/Stk/
diff --git a/Android.mk b/Android.mk
index 135fcf9..ca8204e 100644
--- a/Android.mk
+++ b/Android.mk
@@ -1,16 +1,2 @@
 # Copyright 2007-2008 The Android Open Source Project
 
-LOCAL_PATH:= $(call my-dir)
-include $(CLEAR_VARS)
-
-LOCAL_MODULE_TAGS := optional
-
-LOCAL_JAVA_LIBRARIES := telephony-common
-LOCAL_STATIC_JAVA_LIBRARIES := android-support-v4
-LOCAL_SRC_FILES := $(call all-subdir-java-files)
-
-LOCAL_PACKAGE_NAME := Stk
-LOCAL_PRIVATE_PLATFORM_APIS := true
-LOCAL_CERTIFICATE := platform
-
-include $(BUILD_PACKAGE)

project packages/apps/Traceur/
diff --git a/Android.mk b/Android.mk
index 2c5803e..792d600 100644
--- a/Android.mk
+++ b/Android.mk
@@ -1,26 +1 @@
-LOCAL_PATH := $(call my-dir)
-
-include $(CLEAR_VARS)
-
-LOCAL_PACKAGE_NAME := Traceur
-LOCAL_PRIVATE_PLATFORM_APIS := true
-LOCAL_CERTIFICATE := platform
-LOCAL_USE_AAPT2 := true
-
-LOCAL_STATIC_ANDROID_LIBRARIES := \
-    android-support-v17-leanback \
-    android-support-v14-preference \
-    android-support-v7-appcompat \
-    android-support-v7-preference \
-    android-support-v7-recyclerview \
-    android-support-v4
-
-LOCAL_RESOURCE_DIR := $(LOCAL_PATH)/res
-LOCAL_SRC_FILES := $(call all-java-files-under, src)
-
-include frameworks/base/packages/SettingsLib/common.mk
-
-include $(BUILD_PACKAGE)
-
-# Use the following include to make our test apk.
-include $(call all-makefiles-under,$(LOCAL_PATH))
+#

project packages/apps/Updater/
diff --git a/Android.mk b/Android.mk
index df2b1f5..792d600 100644
--- a/Android.mk
+++ b/Android.mk
@@ -1,49 +1 @@
-LOCAL_PATH:= $(call my-dir)
-
-include $(CLEAR_VARS)
-
-LOCAL_MODULE_TAGS := optional
-
-LOCAL_SRC_FILES := $(call all-java-files-under, src)
-
-LOCAL_USE_AAPT2 := true
-
-LOCAL_STATIC_ANDROID_LIBRARIES := \
-    android-support-design \
-    android-support-transition \
-    android-support-v4 \
-    android-support-v7-appcompat \
-    android-support-v7-cardview \
-    android-support-v7-preference \
-    android-support-v7-recyclerview
-
-LOCAL_RESOURCE_DIR := \
-    $(LOCAL_PATH)/res
-
-LOCAL_PACKAGE_NAME := Updater
-LOCAL_PRIVATE_PLATFORM_APIS := true
-LOCAL_PRIVILEGED_MODULE := true
-LOCAL_PROGUARD_FLAG_FILES := proguard.flags
-
-include $(BUILD_PACKAGE)
-
-
-include $(CLEAR_VARS)
-LOCAL_MODULE := UpdaterStudio
-LOCAL_MODULE_CLASS := FAKE
-LOCAL_MODULE_SUFFIX := -timestamp
-updater_system_deps := $(call java-lib-deps,framework)
-updater_system_libs_path := $(abspath $(LOCAL_PATH))/system_libs
-
-include $(BUILD_SYSTEM)/base_rules.mk
-
-.PHONY: copy_updater_system_deps
-copy_updater_system_deps: $(updater_system_deps)
-	$(hide) mkdir -p $(updater_system_libs_path)
-	$(hide) rm -rf $(updater_system_libs_path)/*.jar
-	$(hide) cp $(updater_system_deps) $(updater_system_libs_path)/framework.jar
-
-$(LOCAL_BUILT_MODULE): copy_updater_system_deps
-	$(hide) echo "Fake: $@"
-	$(hide) mkdir -p $(dir $@)
-	$(hide) touch $@
+#

project packages/providers/BookmarkProvider/
diff --git a/Android.mk b/Android.mk
index f2100b5..7305ebf 100644
--- a/Android.mk
+++ b/Android.mk
@@ -12,17 +12,3 @@
 # License for the specific language governing permissions and limitations under
 # the License.
 
-LOCAL_PATH:= $(call my-dir)
-
-include $(CLEAR_VARS)
-
-LOCAL_MODULE_TAGS := optional
-
-LOCAL_SRC_FILES := \
-        $(call all-java-files-under, src)
-
-LOCAL_PACKAGE_NAME := BookmarkProvider
-LOCAL_PRIVATE_PLATFORM_APIS := true
-
-include $(BUILD_PACKAGE)
-

project packages/providers/WeatherProvider/
diff --git a/Android.mk b/Android.mk
index 10087e2..792d600 100644
--- a/Android.mk
+++ b/Android.mk
@@ -1,26 +1 @@
-LOCAL_PATH := $(call my-dir)
-include $(CLEAR_VARS)
-
-LOCAL_SRC_FILES := $(call all-java-files-under, src)
-
-LOCAL_RESOURCE_DIR := $(LOCAL_PATH)/res
-LOCAL_USE_AAPT2 := true
-
-LOCAL_STATIC_ANDROID_LIBRARIES := \
-    android-support-v4 \
-    android-support-v7-appcompat \
-    android-support-v7-preference \
-    android-support-v7-recyclerview \
-    android-support-v14-preference
-
-LOCAL_STATIC_JAVA_LIBRARIES := \
-    org.lineageos.platform.internal
-
-LOCAL_MODULE_TAGS := optional
-
-LOCAL_PACKAGE_NAME := WeatherProvider
-LOCAL_CERTIFICATE := platform
-LOCAL_PRIVATE_PLATFORM_APIS := true
-LOCAL_PRIVILEGED_MODULE := true
-
-include $(BUILD_PACKAGE)
+#

project packages/screensavers/Basic/
diff --git a/Android.mk b/Android.mk
index 59d54fb..792d600 100644
--- a/Android.mk
+++ b/Android.mk
@@ -1,18 +1 @@
-LOCAL_PATH:= $(call my-dir)
-include $(CLEAR_VARS)
-
-LOCAL_MODULE_TAGS := optional
-
-# Only compile source java files in this apk.
-LOCAL_SRC_FILES := $(call all-java-files-under, src)
-
-LOCAL_PACKAGE_NAME := BasicDreams
-LOCAL_PRIVATE_PLATFORM_APIS := true
-
-# need tasty bits
-# LOCAL_CERTIFICATE := platform
-
-include $(BUILD_PACKAGE)
-
-# Use the following include to make our test apk.
-include $(call all-makefiles-under,$(LOCAL_PATH))
+#

project packages/screensavers/PhotoTable/
diff --git a/Android.mk b/Android.mk
index e2f2f3a..792d600 100644
--- a/Android.mk
+++ b/Android.mk
@@ -1,16 +1 @@
-LOCAL_PATH:= $(call my-dir)
-include $(CLEAR_VARS)
-
-LOCAL_MODULE_TAGS := optional
-
-# Only compile source java files in this apk.
-LOCAL_SRC_FILES := $(call all-java-files-under, src)
-
-LOCAL_PACKAGE_NAME := PhotoTable
-
-LOCAL_SDK_VERSION := current
-
-include $(BUILD_PACKAGE)
-
-# Use the following include to make our test apk.
-include $(call all-makefiles-under,$(LOCAL_PATH))
+#

project packages/screensavers/WebView/
diff --git a/Android.mk b/Android.mk
index 7f79bc3..792d600 100644
--- a/Android.mk
+++ b/Android.mk
@@ -1,18 +1 @@
-LOCAL_PATH:= $(call my-dir)
-include $(CLEAR_VARS)
-
-LOCAL_MODULE_TAGS := optional
-
-# Only compile source java files in this apk.
-LOCAL_SRC_FILES := $(call all-java-files-under, src)
-
-LOCAL_PACKAGE_NAME := WebViewDream
-LOCAL_SDK_VERSION := current
-
-# need tasty bits
-# LOCAL_CERTIFICATE := platform
-
-include $(BUILD_PACKAGE)
-
-# Use the following include to make our test apk.
-include $(call all-makefiles-under,$(LOCAL_PATH))
+#

project packages/services/BuiltInPrintService/
diff --git a/jni/Android.mk b/jni/Android.mk
index d57c115..165a152 100644
--- a/jni/Android.mk
+++ b/jni/Android.mk
@@ -24,7 +24,7 @@ IPP_HELPER_DIR := ipphelper
 LOCAL_SDK_VERSION := current
 
 LOCAL_CFLAGS += \
-      -DINCLUDE_PDF=1 -Werror -Wextra -Wno-unused-parameter \
+      -DINCLUDE_PDF=1 -Wextra -Wno-unused-parameter \
       -Wno-sign-compare -Wno-missing-field-initializers \
       -Wno-implicit-function-declaration -Wno-format -Wno-missing-braces
 

project system/bt/
diff --git a/build/BUILD.gn b/build/BUILD.gn
index f09a27453..0b4299a4b 100644
--- a/build/BUILD.gn
+++ b/build/BUILD.gn
@@ -29,8 +29,8 @@ config("linux") {
     #    "-Wall",
     #    "-Werror",
     "-Wno-gnu-variable-sized-type-not-at-end",
-    "-g",
-    "-O0",
+    "-g0",
+    "-Ofast",
     "-fpic",
     "-fdata-sections",
     "-ffunction-sections",
diff --git a/build/secondary/third_party/libldac/BUILD.gn b/build/secondary/third_party/libldac/BUILD.gn
index 23b191dee..e30094551 100644
--- a/build/secondary/third_party/libldac/BUILD.gn
+++ b/build/secondary/third_party/libldac/BUILD.gn
@@ -30,7 +30,7 @@ shared_library("libldacBT_enc") {
 
   public_configs = [ ":libldacBT_enc_config" ]
 
-  cflags = [ "-O2" ]
+  cflags = [ "-Ofast" ]
 
   defines = [ "EXPORT_SYMBOL=" ]
 }
@@ -42,7 +42,7 @@ shared_library("libldacBT_abr") {
 
   public_configs = [ ":libldacBT_abr_config" ]
 
-  cflags = [ "-O2" ]
+  cflags = [ "-Ofast" ]
 
   defines = [ "EXPORT_SYMBOL=" ]
 }

project system/core/
diff --git a/debuggerd/Android.bp b/debuggerd/Android.bp
index 7e6f24d15..5835c3735 100644
--- a/debuggerd/Android.bp
+++ b/debuggerd/Android.bp
@@ -7,7 +7,7 @@ cc_defaults {
         "-Wno-unused-argument",
         "-Wno-unused-function",
         "-Wno-nullability-completeness",
-        "-Os",
+        "-Ofast",
     ],
     cpp_std: "gnu++17",
 
@@ -233,77 +233,6 @@ cc_benchmark {
     ],
 }
 
-cc_binary {
-    name: "crash_dump",
-    srcs: [
-        "crash_dump.cpp",
-        "util.cpp",
-    ],
-    defaults: ["debuggerd_defaults"],
-
-    compile_multilib: "both",
-    multilib: {
-        lib32: {
-            suffix: "32",
-        },
-        lib64: {
-            suffix: "64",
-        },
-    },
-
-    static_libs: [
-        "libtombstoned_client_static",
-        "libdebuggerd",
-        "libcutils",
-    ],
-
-    shared_libs: [
-        "libbacktrace",
-        "libbase",
-        "liblog",
-        "libprocinfo",
-        "libunwindstack",
-    ],
-}
-
-cc_binary {
-    name: "debuggerd",
-    srcs: [
-        "debuggerd.cpp",
-    ],
-    defaults: ["debuggerd_defaults"],
-
-    shared_libs: [
-        "libbase",
-        "libdebuggerd_client",
-        "liblog",
-        "libprocinfo",
-    ],
-
-    local_include_dirs: ["include"],
-}
-
-cc_binary {
-    name: "tombstoned",
-    srcs: [
-        "util.cpp",
-        "tombstoned/intercept_manager.cpp",
-        "tombstoned/tombstoned.cpp",
-    ],
-    defaults: ["debuggerd_defaults"],
-
-    header_libs: ["libdebuggerd_common_headers"],
-
-    static_libs: [
-        "libbase",
-        "libcutils",
-        "libevent",
-        "liblog",
-    ],
-
-    init_rc: ["tombstoned/tombstoned.rc"],
-}
-
 subdirs = [
     "crasher",
 ]
diff --git a/healthd/Android.bp b/healthd/Android.bp
index cefe09d5e..fb1075c54 100644
--- a/healthd/Android.bp
+++ b/healthd/Android.bp
@@ -9,7 +9,7 @@ cc_library_headers {
 cc_library_static {
     name: "libbatterymonitor",
     srcs: ["BatteryMonitor.cpp"],
-    cflags: ["-Wall", "-Werror"],
+    cflags: ["-Wall"],
     vendor_available: true,
     export_include_dirs: ["include"],
     shared_libs: [
@@ -31,7 +31,6 @@ cc_defaults {
 
     cflags: [
         "-Wall",
-        "-Werror",
     ],
 
     static_libs: [
@@ -78,7 +77,6 @@ cc_binary {
 
     cflags: [
         "-Wall",
-        "-Werror",
     ],
 
     static_libs: [
diff --git a/healthd/Android.mk b/healthd/Android.mk
index 89a6ae07b..b158c3ae2 100644
--- a/healthd/Android.mk
+++ b/healthd/Android.mk
@@ -28,7 +28,6 @@ include $(BUILD_STATIC_LIBRARY)
 
 include $(CLEAR_VARS)
 
-LOCAL_CFLAGS := -Werror
 ifeq ($(strip $(BOARD_CHARGER_DISABLE_INIT_BLANK)),true)
 LOCAL_CFLAGS += -DCHARGER_DISABLE_INIT_BLANK
 endif
@@ -88,7 +87,6 @@ LOCAL_MODULE_PATH := $(TARGET_ROOT_OUT_SBIN)
 LOCAL_UNSTRIPPED_PATH := $(TARGET_ROOT_OUT_SBIN_UNSTRIPPED)
 LOCAL_C_INCLUDES := $(LOCAL_PATH)/include
 
-LOCAL_CFLAGS := -Werror
 ifeq ($(strip $(LOCAL_CHARGER_NO_UI)),true)
 LOCAL_CFLAGS += -DCHARGER_NO_UI
 endif
@@ -140,7 +138,7 @@ LOCAL_MODULE := charger_test
 LOCAL_MODULE_TAGS := optional
 LOCAL_FORCE_STATIC_EXECUTABLE := true
 LOCAL_C_INCLUDES := $(LOCAL_PATH)/include
-LOCAL_CFLAGS := -Wall -Werror -DCHARGER_TEST -DCHARGER_NO_UI
+LOCAL_CFLAGS := -Wall -DCHARGER_TEST -DCHARGER_NO_UI
 LOCAL_STATIC_LIBRARIES := $(CHARGER_STATIC_LIBRARIES)
 LOCAL_SRC_FILES := \
     charger.cpp \
diff --git a/init/Android.bp b/init/Android.bp
index 3287331e2..a024f0021 100644
--- a/init/Android.bp
+++ b/init/Android.bp
@@ -25,9 +25,10 @@ cc_defaults {
         "-Wall",
         "-Wextra",
         "-Wno-unused-parameter",
-        "-Werror",
+        "-UALLOW_LOCAL_PROP_OVERRIDE",
         "-DALLOW_LOCAL_PROP_OVERRIDE=1",
-        "-DALLOW_PERMISSIVE_SELINUX=0",
+        "-UALLOW_PERMISSIVE_SELINUX",
+        "-DALLOW_PERMISSIVE_SELINUX=1",
         "-DREBOOT_BOOTLOADER_ON_PANIC=0",
         "-DWORLD_WRITABLE_KMSG=0",
         "-DDUMP_ON_UMOUNT_FAILURE=0",
diff --git a/init/Android.mk b/init/Android.mk
index 2295bd719..163dc4067 100644
--- a/init/Android.mk
+++ b/init/Android.mk
@@ -13,8 +13,8 @@ init_options += \
     -DDUMP_ON_UMOUNT_FAILURE=1
 else
 init_options += \
-    -DALLOW_LOCAL_PROP_OVERRIDE=0 \
-    -DALLOW_PERMISSIVE_SELINUX=0 \
+    -DALLOW_LOCAL_PROP_OVERRIDE=1 \
+    -DALLOW_PERMISSIVE_SELINUX=1 \
     -DREBOOT_BOOTLOADER_ON_PANIC=0 \
     -DWORLD_WRITABLE_KMSG=0 \
     -DDUMP_ON_UMOUNT_FAILURE=0
diff --git a/libdiskconfig/Android.bp b/libdiskconfig/Android.bp
index b92f0863d..e0913b061 100644
--- a/libdiskconfig/Android.bp
+++ b/libdiskconfig/Android.bp
@@ -25,8 +25,8 @@ cc_library {
         },
         linux_glibc: {
             cflags: [
-                "-O2",
-                "-g",
+                "-Ofast",
+                "-g0",
                 "-W",
                 "-Wall",
                 "-D_LARGEFILE64_SOURCE",
diff --git a/libunwindstack/Android.bp b/libunwindstack/Android.bp
index adbacdbcd..84913cf04 100644
--- a/libunwindstack/Android.bp
+++ b/libunwindstack/Android.bp
@@ -21,7 +21,6 @@ cc_defaults {
 
     cflags: [
         "-Wall",
-        "-Werror",
         "-Wextra",
     ],
 
@@ -79,8 +78,8 @@ cc_library {
         // Always disable optimizations for host to make it easier to debug.
         host: {
             cflags: [
-                "-O0",
-                "-g",
+                "-O3",
+                "-g0",
             ],
         },
         vendor: {
@@ -135,8 +134,8 @@ cc_library_static {
         // Always disable optimizations for host to make it easier to debug.
         host: {
             cflags: [
-                "-O0",
-                "-g",
+                "-O3",
+                "-g0",
             ],
         },
     },
@@ -234,8 +233,8 @@ cc_test {
     ],
 
     cflags: [
-        "-O0",
-        "-g",
+        "-O3",
+        "-g0",
     ],
 
     shared_libs: [
diff --git a/rootdir/init.rc b/rootdir/init.rc
index 4a8a60a96..d9e4f3aca 100644
--- a/rootdir/init.rc
+++ b/rootdir/init.rc
@@ -397,11 +397,6 @@ on post-fs-data
     start vold
     installkey /data
 
-    # Start bootcharting as soon as possible after the data partition is
-    # mounted to collect more data.
-    mkdir /data/bootchart 0755 shell shell
-    bootchart start
-
     # Avoid predictable entropy pool. Carry over entropy from previous boot.
     copy /data/system/entropy.dat /dev/urandom
 
@@ -447,7 +442,6 @@ on post-fs-data
     mkdir /data/misc/ethernet 0770 system system
     mkdir /data/misc/dhcp 0770 dhcp dhcp
     mkdir /data/misc/user 0771 root root
-    mkdir /data/misc/perfprofd 0775 root root
     # give system access to wpa_supplicant.conf for backup and restore
     chmod 0660 /data/misc/wifi/wpa_supplicant.conf
     mkdir /data/local 0751 root root
@@ -455,18 +449,11 @@ on post-fs-data
     mkdir /data/misc/audioserver 0700 audioserver audioserver
     mkdir /data/misc/cameraserver 0700 cameraserver cameraserver
     mkdir /data/misc/vold 0700 root root
-    mkdir /data/misc/boottrace 0771 system shell
-    mkdir /data/misc/update_engine 0700 root root
-    mkdir /data/misc/update_engine_log 02750 root log
-    mkdir /data/misc/trace 0700 root root
     # create location to store surface and window trace files
-    mkdir /data/misc/wmtrace 0700 system system
     # profile file layout
     mkdir /data/misc/profiles 0771 system system
     mkdir /data/misc/profiles/cur 0771 system system
     mkdir /data/misc/profiles/ref 0771 system system
-    mkdir /data/misc/profman 0770 system shell
-    mkdir /data/misc/gcov 0770 root root
 
     mkdir /data/vendor 0771 root root
     mkdir /data/vendor_ce 0771 root root
@@ -476,7 +463,6 @@ on post-fs-data
     # For security reasons, /data/local/tmp should always be empty.
     # Do not place files or directories in /data/local/tmp
     mkdir /data/local/tmp 0771 shell shell
-    mkdir /data/local/traces 0777 shell shell
     mkdir /data/data 0771 system system
     mkdir /data/app-private 0771 system system
     mkdir /data/app-ephemeral 0771 system system
@@ -484,18 +470,9 @@ on post-fs-data
     mkdir /data/app-lib 0771 system system
     mkdir /data/app 0771 system system
     mkdir /data/property 0700 root root
-    mkdir /data/tombstones 0771 system system
-    mkdir /data/vendor/tombstones 0771 root root
-    mkdir /data/vendor/tombstones/wifi 0771 wifi wifi
 
     # create dalvik-cache, so as to enforce our permissions
     mkdir /data/dalvik-cache 0771 root root
-    # create the A/B OTA directory, so as to enforce our permissions
-    mkdir /data/ota 0771 root root
-
-    # create the OTA package directory. It will be accessed by GmsCore (cache
-    # group), update_engine and update_verifier.
-    mkdir /data/ota_package 0770 system cache
 
     # create resource-cache and double-check the perms
     mkdir /data/resource-cache 0771 system system
@@ -513,19 +490,11 @@ on post-fs-data
     # the following directory.
     mkdir /data/mediadrm 0770 mediadrm mediadrm
 
-    mkdir /data/anr 0775 system system
-
-    # NFC: create data/nfc for nv storage
-    mkdir /data/nfc 0770 nfc nfc
-    mkdir /data/nfc/param 0770 nfc nfc
-
     # Create all remaining /data root dirs so that they are made through init
     # and get proper encryption policy installed
     mkdir /data/backup 0700 system system
-    mkdir /data/ss 0700 system system
 
     mkdir /data/system 0775 system system
-    mkdir /data/system/heapdump 0700 system system
     mkdir /data/system/users 0775 system system
 
     mkdir /data/system_de 0770 system system
@@ -714,6 +683,9 @@ on property:vold.decrypt=trigger_shutdown_framework
 on property:sys.boot_completed=1
     bootchart stop
 
+    # SELinux Enforcing
+    exec /system/bin/setenforce 1
+
 # system server cannot write to /proc/sys files,
 # and chown/chmod does not work for /proc/sys/ entries.
 # So proxy writes through init.
diff --git a/toolbox/Android.bp b/toolbox/Android.bp
index ddd95b207..a6b76c219 100644
--- a/toolbox/Android.bp
+++ b/toolbox/Android.bp
@@ -7,6 +7,7 @@ cc_defaults {
         "-Wno-unused-const-variable",
         "-include bsd-compatibility.h",
         "-D_FILE_OFFSET_BITS=64",
+        "-Ofast",
     ],
     local_include_dirs: ["upstream-netbsd/include/"],
 }
@@ -31,6 +32,7 @@ cc_library_static {
     cflags: [
         "-Dmain=dd_main",
         "-DNO_CONV",
+        "-Ofast",
     ],
 }
 
diff --git a/trusty/keymaster/Makefile b/trusty/keymaster/Makefile
index f57538189..f4fbaf37f 100644
--- a/trusty/keymaster/Makefile
+++ b/trusty/keymaster/Makefile
@@ -44,7 +44,7 @@ else
 COMPILER_SPECIFIC_ARGS=-std=c++0x -fprofile-arcs
 endif
 
-CPPFLAGS=$(INCLUDES) -g -O0 -MD
+CPPFLAGS=$(INCLUDES) -g0 -Ofast -MD
 CXXFLAGS=-Wall -Werror -Wno-unused -Winit-self -Wpointer-arith	-Wunused-parameter \
 	-Wmissing-declarations -ftest-coverage \
 	-Wno-deprecated-declarations -fno-exceptions -DKEYMASTER_NAME_TAGS \

project system/extras/
diff --git a/crypto-perf/Android.mk b/crypto-perf/Android.mk
index 4a3cbe41..35905d45 100644
--- a/crypto-perf/Android.mk
+++ b/crypto-perf/Android.mk
@@ -2,7 +2,7 @@ LOCAL_PATH := $(call my-dir)
 ifeq ($(TARGET_ARCH),arm64)
 include $(CLEAR_VARS)
 
-LOCAL_CFLAGS := -O0 -march=armv8-a+crypto -Wall -Werror
+LOCAL_CFLAGS := -Ofast -march=armv8-a+crypto -Wall -Werror
 LOCAL_SRC_FILES := crypto.cpp
 
 LOCAL_MODULE_PATH := $(TARGET_OUT_OPTIONAL_EXECUTABLES)
diff --git a/ioshark/Android.mk b/ioshark/Android.mk
index b15d64a0..4c67548b 100644
--- a/ioshark/Android.mk
+++ b/ioshark/Android.mk
@@ -17,7 +17,7 @@ LOCAL_PATH:= $(call my-dir)
 include $(CLEAR_VARS)
 LOCAL_MODULE_HOST_OS := linux
 LOCAL_SRC_FILES := ioshark_bench.c ioshark_bench_subr.c ioshark_bench_mmap.c
-LOCAL_CFLAGS := -g -O2 -Wall  -Werror
+LOCAL_CFLAGS := -g0 -Ofast -Wall  -Werror
 LOCAL_MODULE := ioshark_bench
 LOCAL_MODULE_TAGS := debug
 LOCAL_MODULE_PATH := $(TARGET_OUT_OPTIONAL_EXECUTABLES)
@@ -26,7 +26,7 @@ include $(BUILD_EXECUTABLE)
 include $(CLEAR_VARS)
 LOCAL_MODULE_HOST_OS := linux
 LOCAL_SRC_FILES := compile_ioshark.c compile_ioshark_subr.c
-LOCAL_CFLAGS := -g -O2 -Wall -Werror -D_GNU_SOURCE
+LOCAL_CFLAGS := -g0 -Ofast -Wall -Werror -D_GNU_SOURCE
 LOCAL_MODULE := compile_ioshark
 LOCAL_MODULE_TAGS := debug
 include $(BUILD_HOST_EXECUTABLE)
@@ -34,7 +34,7 @@ include $(BUILD_HOST_EXECUTABLE)
 include $(CLEAR_VARS)
 LOCAL_MODULE_HOST_OS := linux
 LOCAL_SRC_FILES := dump_ioshark_filenames.c
-LOCAL_CFLAGS := -g -O2 -Wall -Werror -D_GNU_SOURCE
+LOCAL_CFLAGS := -g0 -Ofast -Wall -Werror -D_GNU_SOURCE
 LOCAL_MODULE := dump_ioshark_filenames
 LOCAL_MODULE_TAGS := debug
 include $(BUILD_HOST_EXECUTABLE)
@@ -42,7 +42,7 @@ include $(BUILD_HOST_EXECUTABLE)
 include $(CLEAR_VARS)
 LOCAL_MODULE_HOST_OS := linux
 LOCAL_SRC_FILES := convert_format.c
-LOCAL_CFLAGS := -g -O2 -Wall -Werror -D_GNU_SOURCE
+LOCAL_CFLAGS := -g0 -Ofast -Wall -Werror -D_GNU_SOURCE
 LOCAL_MODULE := convert_format
 LOCAL_MODULE_TAGS := debug
 include $(BUILD_HOST_EXECUTABLE)
diff --git a/libfec/Android.bp b/libfec/Android.bp
index 209465d9..02976039 100644
--- a/libfec/Android.bp
+++ b/libfec/Android.bp
@@ -9,7 +9,7 @@ cc_library {
         "fec_verity.cpp",
         "fec_process.cpp",
     ],
-    cflags: ["-Wall", "-Werror", "-O3", "-D_LARGEFILE64_SOURCE"],
+    cflags: ["-Wall", "-Werror", "-Ofast", "-D_LARGEFILE64_SOURCE"],
     export_include_dirs: ["include"],
     // Exported header include/fec/io.h includes crypto_utils headers.
     export_static_lib_headers: ["libcrypto_utils"],
diff --git a/memcpy-perf/Android.mk b/memcpy-perf/Android.mk
index a2b3399a..956f2050 100644
--- a/memcpy-perf/Android.mk
+++ b/memcpy-perf/Android.mk
@@ -2,7 +2,7 @@ LOCAL_PATH:= $(call my-dir)
 
 include $(CLEAR_VARS)
 LOCAL_MODULE := memcpy-perf
-LOCAL_CFLAGS += -g -Wall -Werror -Wno-missing-field-initializers -Wno-sign-compare -O3
+LOCAL_CFLAGS += -g0 -Wall -Werror -Wno-missing-field-initializers -Wno-sign-compare -Ofast
 LOCAL_SRC_FILES := memcpy-perf.cpp test-funcs.cpp
 LOCAL_FORCE_STATIC_EXECUTABLE := true
 LOCAL_CXX_STL := libc++_static
diff --git a/mmap-perf/Android.mk b/mmap-perf/Android.mk
index 96de5ea5..7789ff0a 100644
--- a/mmap-perf/Android.mk
+++ b/mmap-perf/Android.mk
@@ -23,7 +23,7 @@ LOCAL_COMPATIBILITY_SUITE := device-tests
 LOCAL_MULTILIB := both
 LOCAL_MODULE_STEM_32 := $(LOCAL_MODULE)
 LOCAL_MODULE_STEM_64 := $(LOCAL_MODULE)64
-LOCAL_CFLAGS += -g -Wall -Werror -Wno-missing-field-initializers -Wno-sign-compare -O3
+LOCAL_CFLAGS += -g0 -Wall -Werror -Wno-missing-field-initializers -Wno-sign-compare -Ofast
 LOCAL_FORCE_STATIC_EXECUTABLE := true
 LOCAL_CXX_STL := libc++_static
 LOCAL_STATIC_LIBRARIES := libc
diff --git a/perfprofd/Android.bp b/perfprofd/Android.bp
index 256b95cf..b8d67112 100644
--- a/perfprofd/Android.bp
+++ b/perfprofd/Android.bp
@@ -51,8 +51,8 @@ cc_defaults {
     name: "perfprofd_debug_defaults",
 
     cflags: [
-        "-O0",
-        "-g",
+        "-Ofast",
+        "-g0",
         "-UNDEBUG",
     ],
 }
diff --git a/simpleperf/runtest/Android.build.mk b/simpleperf/runtest/Android.build.mk
index acba92bd..5dd9593d 100644
--- a/simpleperf/runtest/Android.build.mk
+++ b/simpleperf/runtest/Android.build.mk
@@ -16,7 +16,7 @@
 
 # -O0 is need to prevent optimizations like function inlining in runtest executables.
 simpleperf_runtest_cppflags := -Wall -Wextra -Werror -Wunused \
-                               -O0 \
+                               -Ofast \
 
 include $(CLEAR_VARS)
 LOCAL_CPPFLAGS := $(simpleperf_runtest_cppflags)
@@ -41,4 +41,4 @@ LOCAL_MODULE_STEM_32 := $(module)32
 LOCAL_MODULE_STEM_64 := $(module)64
 LOCAL_LDLIBS_linux := -lrt
 LOCAL_ADDITIONAL_DEPENDENCIES := $(LOCAL_PATH)/Android.build.mk
-include $(BUILD_HOST_EXECUTABLE)
\ No newline at end of file
+include $(BUILD_HOST_EXECUTABLE)
diff --git a/verity/fec/Android.mk b/verity/fec/Android.mk
index 8273d0d1..7fb0144d 100644
--- a/verity/fec/Android.mk
+++ b/verity/fec/Android.mk
@@ -17,6 +17,6 @@ LOCAL_STATIC_LIBRARIES := \
     libext4_utils \
     libsquashfs_utils
 LOCAL_SHARED_LIBRARIES := libbase
-LOCAL_CFLAGS += -Wall -Werror -O3
+LOCAL_CFLAGS += -Wall -Werror -Ofast
 LOCAL_C_INCLUDES += external/fec
 include $(BUILD_HOST_EXECUTABLE)

project system/extras/su/
diff --git a/su.c b/su.c
index 5ec7ee4..5b402ef 100644
--- a/su.c
+++ b/su.c
@@ -277,12 +277,6 @@ int access_disabled(const struct su_initiator* from) {
         return 1;
     }
 
-    /* Only allow su on debuggable builds */
-    if (!property_get_bool("ro.debuggable", false)) {
-        ALOGE("Root access is disabled on non-debug builds");
-        return 1;
-    }
-
     /* Enforce persist.sys.root_access on non-eng builds for apps */
     enabled = property_get_int32("persist.sys.root_access", 2);
     property_get("ro.build.type", build_type, "");

project system/hardware/interfaces/
diff --git a/wifi/keystore/1.0/vts/functional/Android.bp b/wifi/keystore/1.0/vts/functional/Android.bp
index cd591ec..b2cada6 100644
--- a/wifi/keystore/1.0/vts/functional/Android.bp
+++ b/wifi/keystore/1.0/vts/functional/Android.bp
@@ -31,8 +31,8 @@ cc_test {
     ],
     static_libs: ["VtsHalHidlTargetTestBase"],
     cflags: [
-        "-O0",
-        "-g",
+        "-Ofast",
+        "-g0",
         "-Wall",
         "-Werror",
     ],

project system/keymaster/
diff --git a/Makefile b/Makefile
index a3f06d9..c680424 100644
--- a/Makefile
+++ b/Makefile
@@ -49,7 +49,7 @@ CFLAGS += -DKEYMASTER_CLANG_TEST_BUILD
 endif
 
 LDFLAGS += $(ARCH_FLAGS)
-CPPFLAGS = $(INCLUDES) -g -O0 -MD -MP $(ARCH_FLAGS) -DKEYMASTER_UNIT_TEST_BUILD -DHOST_BUILD
+CPPFLAGS = $(INCLUDES) -g0 -Ofast -MD -MP $(ARCH_FLAGS) -DKEYMASTER_UNIT_TEST_BUILD -DHOST_BUILD
 CXXFLAGS += -Wall -Werror -Wno-unused -Winit-self -Wpointer-arith -Wunused-parameter \
 	-Werror=sign-compare -Werror=return-type -fno-permissive \
 	-Wno-deprecated-declarations -fno-exceptions -DKEYMASTER_NAME_TAGS $(ARCH_FLAGS)

project system/libhidl/
diff --git a/Android.bp b/Android.bp
index 032a61a..3ddde58 100644
--- a/Android.bp
+++ b/Android.bp
@@ -43,7 +43,7 @@ cc_test {
     ],
 
     cflags: [
-        "-O0",
-        "-g",
+        "-Ofast",
+        "-g0",
     ],
 }

project system/sepolicy/
diff --git a/Android.mk b/Android.mk
index ff38a43a..a3fba7c8 100644
--- a/Android.mk
+++ b/Android.mk
@@ -10,6 +10,7 @@ POLICYVERS ?= 30
 
 MLS_SENS=1
 MLS_CATS=1024
+SELINUX_IGNORE_NEVERALLOWS := true
 
 ifdef BOARD_SEPOLICY_REPLACE
 $(error BOARD_SEPOLICY_REPLACE is no longer supported; please remove from your BoardConfig.mk or other .mk file.)
@@ -80,10 +81,11 @@ ifndef BOARD_SEPOLICY_VERS
 BOARD_SEPOLICY_VERS := $(PLATFORM_SEPOLICY_VERSION)
 endif
 
-NEVERALLOW_ARG :=
+NEVERALLOW_ARG := -N
 ifeq ($(SELINUX_IGNORE_NEVERALLOWS),true)
 ifeq ($(TARGET_BUILD_VARIANT),user)
-$(error SELINUX_IGNORE_NEVERALLOWS := true cannot be used in user builds)
+$(warning SELINUX_IGNORE_NEVERALLOWS := true cannot be used in user builds)
+NEVERALLOW_ARG := -N
 endif
 $(warning Be careful when using the SELINUX_IGNORE_NEVERALLOWS flag. \
           It does not work in user builds and using it will \
@@ -705,10 +707,9 @@ $(built_sepolicy_neverallows)
 	$(hide) $(HOST_OUT_EXECUTABLES)/sepolicy-analyze $@.tmp permissive > $@.permissivedomains
 	$(hide) if [ "$(TARGET_BUILD_VARIANT)" = "user" -a -s $@.permissivedomains ]; then \
 		echo "==========" 1>&2; \
-		echo "ERROR: permissive domains not allowed in user builds" 1>&2; \
+		echo "WARNING: permissive domains not allowed in user builds" 1>&2; \
 		echo "List of invalid domains:" 1>&2; \
 		cat $@.permissivedomains 1>&2; \
-		exit 1; \
 		fi
 	$(hide) mv $@.tmp $@
 
@@ -756,10 +757,9 @@ $(LOCAL_BUILT_MODULE): $(sepolicy.recovery.conf) $(HOST_OUT_EXECUTABLES)/checkpo
 	$(hide) $(HOST_OUT_EXECUTABLES)/sepolicy-analyze $@.tmp permissive > $@.permissivedomains
 	$(hide) if [ "$(TARGET_BUILD_VARIANT)" = "user" -a -s $@.permissivedomains ]; then \
 		echo "==========" 1>&2; \
-		echo "ERROR: permissive domains not allowed in user builds" 1>&2; \
+		echo "WARNING: permissive domains not allowed in user builds" 1>&2; \
 		echo "List of invalid domains:" 1>&2; \
 		cat $@.permissivedomains 1>&2; \
-		exit 1; \
 		fi
 	$(hide) mv $@.tmp $@
 
diff --git a/prebuilts/api/28.0/private/adbd.te b/prebuilts/api/28.0/private/adbd.te
index 3ac47443..1b44403d 100644
--- a/prebuilts/api/28.0/private/adbd.te
+++ b/prebuilts/api/28.0/private/adbd.te
@@ -7,10 +7,10 @@ init_daemon_domain(adbd)
 
 domain_auto_trans(adbd, shell_exec, shell)
 
-userdebug_or_eng(`
+
   allow adbd self:process setcurrent;
   allow adbd su:process dyntransition;
-')
+
 
 # Do not sanitize the environment or open fds of the shell. Allow signaling
 # created processes.
@@ -90,13 +90,13 @@ hal_client_domain(adbd, hal_graphics_allocator)
 allow adbd adb_keys_file:dir search;
 allow adbd adb_keys_file:file r_file_perms;
 
-userdebug_or_eng(`
+
   # Write debugging information to /data/adb
   # when persist.adb.trace_mask is set
   # https://code.google.com/p/android/issues/detail?id=72895
   allow adbd adb_data_file:dir rw_dir_perms;
   allow adbd adb_data_file:file create_file_perms;
-')
+
 
 # ndk-gdb invokes adb forward to forward the gdbserver socket.
 allow adbd app_data_file:dir search;
@@ -149,4 +149,4 @@ allow adbd rootfs:dir r_dir_perms;
 # transitions to the shell domain (except when it crashes). In particular, we
 # never want to see a transition from adbd to su (aka "adb root")
 neverallow adbd { domain -crash_dump -shell }:process transition;
-neverallow adbd { domain userdebug_or_eng(`-su') }:process dyntransition;
+neverallow adbd { domain -su }:process dyntransition;
diff --git a/prebuilts/api/28.0/private/compat/26.0/26.0.ignore.cil b/prebuilts/api/28.0/private/compat/26.0/26.0.ignore.cil
index b07350c4..635726b0 100644
--- a/prebuilts/api/28.0/private/compat/26.0/26.0.ignore.cil
+++ b/prebuilts/api/28.0/private/compat/26.0/26.0.ignore.cil
@@ -157,3 +157,5 @@
      ( adbd_tmpfs
        untrusted_app_27_tmpfs
      ))
+
+allow sudaemon untrusted_app_all_devpts:chr_file *;
diff --git a/prebuilts/api/28.0/private/su.te b/prebuilts/api/28.0/private/su.te
index 16e47bbb..27a97bdb 100644
--- a/prebuilts/api/28.0/private/su.te
+++ b/prebuilts/api/28.0/private/su.te
@@ -1,4 +1,4 @@
-userdebug_or_eng(`
+
   typeattribute su coredomain;
 
   domain_auto_trans(shell, su_exec, su)
@@ -20,4 +20,4 @@ userdebug_or_eng(`
   permissive su;
 
   app_domain(su)
-')
+
diff --git a/prebuilts/api/28.0/private/untrusted_app_25.te b/prebuilts/api/28.0/private/untrusted_app_25.te
index ba2c1e1c..ad66b60b 100644
--- a/prebuilts/api/28.0/private/untrusted_app_25.te
+++ b/prebuilts/api/28.0/private/untrusted_app_25.te
@@ -40,3 +40,4 @@ allow untrusted_app_25 proc_misc:file r_file_perms;
 # https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
 # This will go away in a future Android release
 allow untrusted_app_25 proc_tty_drivers:file r_file_perms;
+allow untrusted_app socket_device:sock_file *;
diff --git a/prebuilts/api/28.0/private/untrusted_app_all.te b/prebuilts/api/28.0/private/untrusted_app_all.te
index 6cf16682..b19c0cc0 100644
--- a/prebuilts/api/28.0/private/untrusted_app_all.te
+++ b/prebuilts/api/28.0/private/untrusted_app_all.te
@@ -138,3 +138,4 @@ dontaudit untrusted_app_all net_dns_prop:file read;
 dontaudit untrusted_app_all proc_stat:file read;
 dontaudit untrusted_app_all proc_vmstat:file read;
 dontaudit untrusted_app_all proc_uptime:file read;
+allow untrusted_app socket_device:sock_file write;
diff --git a/prebuilts/api/28.0/public/app.te b/prebuilts/api/28.0/public/app.te
index 239332c1..35a679b5 100644
--- a/prebuilts/api/28.0/public/app.te
+++ b/prebuilts/api/28.0/public/app.te
@@ -306,7 +306,7 @@ allowxperm { appdomain -bluetooth } self:{ rawip_socket tcp_socket udp_socket }
 
 allow { appdomain -isolated_app } ion_device:chr_file rw_file_perms;
 # TODO is write really necessary ?
-auditallow { appdomain userdebug_or_eng(`-su') } ion_device:chr_file { write append };
+auditallow { appdomain -su' } ion_device:chr_file { write append };
 
 # TODO(b/36375899) replace with hal_client_domain for mediacodec (hal_omx)
 get_prop({ appdomain -isolated_app }, hwservicemanager_prop);
@@ -433,9 +433,9 @@ neverallow appdomain { domain -appdomain }:process
 # Transition to a non-app domain.
 # Exception for the shell and su domains, can transition to runas, etc.
 # Exception for crash_dump.
-neverallow { appdomain -shell userdebug_or_eng(`-su') } { domain -appdomain -crash_dump }:process
+neverallow { appdomain -shell -su } { domain -appdomain -crash_dump }:process
     { transition };
-neverallow { appdomain -shell userdebug_or_eng(`-su') } { domain -appdomain }:process
+neverallow { appdomain -shell -su } { domain -appdomain }:process
     { dyntransition };
 
 # Write to rootfs.
diff --git a/prebuilts/api/28.0/public/domain.te b/prebuilts/api/28.0/public/domain.te
index 14f2f767..67264033 100644
--- a/prebuilts/api/28.0/public/domain.te
+++ b/prebuilts/api/28.0/public/domain.te
@@ -32,7 +32,7 @@ allow domain self:unix_stream_socket { create_stream_socket_perms connectto };
 # Inherit or receive open files from others.
 allow domain init:fd use;
 
-userdebug_or_eng(`
+
   allow domain su:fd use;
   allow domain su:unix_stream_socket { connectto getattr getopt read write shutdown };
   allow domain su:unix_dgram_socket sendto;
@@ -46,6 +46,7 @@ userdebug_or_eng(`
   # allow "gdbserver --attach" to work for su.
   allow domain su:process sigchld;
 
+userdebug_or_eng(`
   # Allow writing coredumps to /cores/*
   allow domain coredump_file:file create_file_perms;
   allow domain coredump_file:dir ra_dir_perms;
@@ -111,7 +112,7 @@ compatible_property_only(`
     get_prop({coredomain appdomain shell}, exported3_default_prop)
     get_prop({coredomain appdomain shell}, exported3_radio_prop)
     get_prop({coredomain appdomain shell}, exported3_system_prop)
-    userdebug_or_eng(`
+
         get_prop(su, core_property_type)
         get_prop(su, exported_dalvik_prop)
         get_prop(su, exported_ffs_prop)
@@ -123,7 +124,7 @@ compatible_property_only(`
         get_prop(su, exported3_default_prop)
         get_prop(su, exported3_radio_prop)
         get_prop(su, exported3_system_prop)
-    ')
+
     get_prop({domain -coredomain -appdomain}, vendor_default_prop)
 ')
 
@@ -315,7 +316,7 @@ neverallow {
 # Limit raw I/O to these whitelisted domains. Do not apply to debug builds.
 neverallow {
   domain
-  userdebug_or_eng(`-domain')
+  -domain
   -kernel
   -init
   -recovery
@@ -432,7 +433,7 @@ neverallow {
     with_asan(`-asan_extract')
     -dumpstate
     -shell
-    userdebug_or_eng(`-su')
+    -su
     -webview_zygote
     -zygote
     userdebug_or_eng(`-mediaextractor')
@@ -603,7 +604,7 @@ neverallow { domain -install_recovery -recovery } recovery_block_device:blk_file
 # this partition for testing purposes.
 neverallow {
   domain
-  userdebug_or_eng(`-domain') # exclude debuggable builds
+  -domain # exclude debuggable builds
   -hal_bootctl_server
   -init
   -uncrypt
@@ -682,7 +683,7 @@ full_treble_only(`
   neverallow {
     coredomain
     -shell
-    userdebug_or_eng(`-su')
+    -su
     -ueventd # uevent is granted create for this device, but we still neverallow I/O below
   } vndbinder_device:chr_file rw_file_perms;
 ')
@@ -693,14 +694,14 @@ full_treble_only(`
   neverallow {
     coredomain
     -shell
-    userdebug_or_eng(`-su')
+    -su
   } vndservice_manager_type:service_manager *;
 ')
 full_treble_only(`
   neverallow {
     coredomain
     -shell
-    userdebug_or_eng(`-su')
+    -su
   } vndservicemanager:binder *;
 ')
 
@@ -736,7 +737,7 @@ full_treble_only(`
     -logd # Logging by writing to logd Unix domain socket is public API
     -netd # netdomain needs this
     -mdnsd # netdomain needs this
-    userdebug_or_eng(`-su') # communications with su are permitted only on userdebug or eng builds
+    -su # communications with su are permitted only on userdebug or eng builds
     -init
     -incidentd # TODO(b/35870313): Remove incidentd from this list once vendor domains no longer declare Binder services
     -tombstoned # TODO(b/36604251): Remove tombstoned from this list once mediacodec (OMX HAL) no longer declares Binder services
@@ -1112,7 +1113,7 @@ neverallow * { file_type fs_type dev_type }:{ lnk_file fifo_file sock_file } mou
 # Nobody should be able to execute su on user builds.
 # On userdebug/eng builds, only dumpstate, shell, and
 # su itself execute su.
-neverallow { domain userdebug_or_eng(`-dumpstate -shell -su') } su_exec:file no_x_file_perms;
+neverallow { domain -shell -su -dumpstate } su_exec:file no_x_file_perms;
 
 # Do not allow the introduction of new execmod rules. Text relocations
 # and modification of executable pages are unsafe.
@@ -1206,7 +1207,7 @@ neverallow {
 
 # Only domains spawned from zygote and runas may have the appdomain attribute.
 neverallow { domain -runas -webview_zygote -zygote } {
-  appdomain -shell userdebug_or_eng(`-su')
+  appdomain -shell -su
 }:process { transition dyntransition };
 
 # Minimize read access to shell- or app-writable symlinks.
diff --git a/prebuilts/api/28.0/public/hal_configstore.te b/prebuilts/api/28.0/public/hal_configstore.te
index c8051e14..b3761db6 100644
--- a/prebuilts/api/28.0/public/hal_configstore.te
+++ b/prebuilts/api/28.0/public/hal_configstore.te
@@ -36,7 +36,7 @@ neverallow hal_configstore_server {
   domain
   -hal_configstore_server
   -logd
-  userdebug_or_eng(`-su')
+  -su
   -tombstoned
 }:{ unix_dgram_socket unix_stream_socket } *;
 
diff --git a/prebuilts/api/28.0/public/installd.te b/prebuilts/api/28.0/public/installd.te
index f34ef0c5..07801629 100644
--- a/prebuilts/api/28.0/public/installd.te
+++ b/prebuilts/api/28.0/public/installd.te
@@ -157,4 +157,4 @@ allow installd preloads_media_file:dir { r_dir_perms write remove_name rmdir };
 # only system_server, installd and dumpstate may interact with installd over binder
 neverallow { domain -system_server -dumpstate -installd } installd_service:service_manager find;
 neverallow { domain -system_server -dumpstate } installd:binder call;
-neverallow installd { domain -system_server -servicemanager userdebug_or_eng(`-su') }:binder call;
+neverallow installd { domain -system_server -servicemanager -su }:binder call;
diff --git a/prebuilts/api/28.0/public/netd.te b/prebuilts/api/28.0/public/netd.te
index a550b258..c94e26b4 100644
--- a/prebuilts/api/28.0/public/netd.te
+++ b/prebuilts/api/28.0/public/netd.te
@@ -137,7 +137,7 @@ neverallow { domain -netd } netd:bpf { map_create };
 
 # apps may not interact with netd over binder.
 neverallow appdomain netd:binder call;
-neverallow netd { appdomain userdebug_or_eng(`-su') }:binder call;
+neverallow netd { appdomain -su }:binder call;
 
 # persist.netd.stable_secret contains RFC 7217 secret key which should never be
 # leaked to other processes. Make sure it never leaks.
diff --git a/prebuilts/api/28.0/public/su.te b/prebuilts/api/28.0/public/su.te
index 03129454..4da87619 100644
--- a/prebuilts/api/28.0/public/su.te
+++ b/prebuilts/api/28.0/public/su.te
@@ -5,7 +5,7 @@ type su, domain;
 # File types must be defined for file_contexts.
 type su_exec, exec_type, file_type;
 
-userdebug_or_eng(`
+
   # Domain used for su processes, as well as for adbd and adb shell
   # after performing an adb root command.  The domain definition is
   # wrapped to ensure that it does not exist at all on -user builds.
@@ -97,4 +97,4 @@ userdebug_or_eng(`
   typeattribute su hal_wifi_hostapd_client;
   typeattribute su hal_wifi_offload_client;
   typeattribute su hal_wifi_supplicant_client;
-')
+
diff --git a/prebuilts/api/28.0/public/te_macros b/prebuilts/api/28.0/public/te_macros
index dcebbefa..3af099c2 100644
--- a/prebuilts/api/28.0/public/te_macros
+++ b/prebuilts/api/28.0/public/te_macros
@@ -101,10 +101,10 @@ define(`pdx_service_socket_types', `
 typeattribute $2 pdx_$1_endpoint_dir_type;
 type pdx_$1_endpoint_socket, pdx_$1_endpoint_socket_type, pdx_endpoint_socket_type, file_type, coredomain_socket, mlstrustedobject, mlstrustedsubject;
 type pdx_$1_channel_socket, pdx_$1_channel_socket_type, pdx_channel_socket_type, coredomain_socket;
-userdebug_or_eng(`
+
 dontaudit su pdx_$1_endpoint_socket:unix_stream_socket *;
 dontaudit su pdx_$1_channel_socket:unix_stream_socket *;
-')
+
 ')
 
 #####################################
@@ -494,9 +494,9 @@ define(`with_asan', ifelse(target_with_asan, `true', userdebug_or_eng(`$1'), ))
 # Fallback crash handling for processes that can't exec crash_dump (e.g. because of seccomp).
 #
 define(`crash_dump_fallback', `
-userdebug_or_eng(`
+
   allow $1 su:fifo_file append;
-')
+
 allow $1 anr_data_file:file append;
 allow $1 dumpstate:fd use;
 allow $1 incidentd:fd use;
diff --git a/prebuilts/api/28.0/public/vold.te b/prebuilts/api/28.0/public/vold.te
index 852e91ea..5a663f23 100644
--- a/prebuilts/api/28.0/public/vold.te
+++ b/prebuilts/api/28.0/public/vold.te
@@ -263,7 +263,7 @@ neverallow vold {
   -hwservicemanager
   -servicemanager
   -system_server
-  userdebug_or_eng(`-su')
+  -su
 }:binder call;
 
 neverallow vold fsck_exec:file execute_no_trans;
diff --git a/private/adbd.te b/private/adbd.te
index 3ac47443..1b44403d 100644
--- a/private/adbd.te
+++ b/private/adbd.te
@@ -7,10 +7,10 @@ init_daemon_domain(adbd)
 
 domain_auto_trans(adbd, shell_exec, shell)
 
-userdebug_or_eng(`
+
   allow adbd self:process setcurrent;
   allow adbd su:process dyntransition;
-')
+
 
 # Do not sanitize the environment or open fds of the shell. Allow signaling
 # created processes.
@@ -90,13 +90,13 @@ hal_client_domain(adbd, hal_graphics_allocator)
 allow adbd adb_keys_file:dir search;
 allow adbd adb_keys_file:file r_file_perms;
 
-userdebug_or_eng(`
+
   # Write debugging information to /data/adb
   # when persist.adb.trace_mask is set
   # https://code.google.com/p/android/issues/detail?id=72895
   allow adbd adb_data_file:dir rw_dir_perms;
   allow adbd adb_data_file:file create_file_perms;
-')
+
 
 # ndk-gdb invokes adb forward to forward the gdbserver socket.
 allow adbd app_data_file:dir search;
@@ -149,4 +149,4 @@ allow adbd rootfs:dir r_dir_perms;
 # transitions to the shell domain (except when it crashes). In particular, we
 # never want to see a transition from adbd to su (aka "adb root")
 neverallow adbd { domain -crash_dump -shell }:process transition;
-neverallow adbd { domain userdebug_or_eng(`-su') }:process dyntransition;
+neverallow adbd { domain -su }:process dyntransition;
diff --git a/private/logd.te b/private/logd.te
index 4338e400..2762e923 100644
--- a/private/logd.te
+++ b/private/logd.te
@@ -34,6 +34,6 @@ neverallow {
   -priv_app
   -radio
   -shell
-  userdebug_or_eng(`-su')
+  -su
   -system_app
 } runtime_event_log_tags_file:file no_rw_file_perms;
diff --git a/private/su.te b/private/su.te
index 16e47bbb..27a97bdb 100644
--- a/private/su.te
+++ b/private/su.te
@@ -1,4 +1,4 @@
-userdebug_or_eng(`
+
   typeattribute su coredomain;
 
   domain_auto_trans(shell, su_exec, su)
@@ -20,4 +20,4 @@ userdebug_or_eng(`
   permissive su;
 
   app_domain(su)
-')
+
diff --git a/public/app.te b/public/app.te
index 239332c1..1f2c5bfa 100644
--- a/public/app.te
+++ b/public/app.te
@@ -306,7 +306,7 @@ allowxperm { appdomain -bluetooth } self:{ rawip_socket tcp_socket udp_socket }
 
 allow { appdomain -isolated_app } ion_device:chr_file rw_file_perms;
 # TODO is write really necessary ?
-auditallow { appdomain userdebug_or_eng(`-su') } ion_device:chr_file { write append };
+auditallow { appdomain -su } ion_device:chr_file { write append };
 
 # TODO(b/36375899) replace with hal_client_domain for mediacodec (hal_omx)
 get_prop({ appdomain -isolated_app }, hwservicemanager_prop);
@@ -433,9 +433,9 @@ neverallow appdomain { domain -appdomain }:process
 # Transition to a non-app domain.
 # Exception for the shell and su domains, can transition to runas, etc.
 # Exception for crash_dump.
-neverallow { appdomain -shell userdebug_or_eng(`-su') } { domain -appdomain -crash_dump }:process
+neverallow { appdomain -shell -su } { domain -appdomain -crash_dump }:process
     { transition };
-neverallow { appdomain -shell userdebug_or_eng(`-su') } { domain -appdomain }:process
+neverallow { appdomain -shell -su } { domain -appdomain }:process
     { dyntransition };
 
 # Write to rootfs.
diff --git a/public/domain.te b/public/domain.te
index 6618c4bc..4be23d42 100644
--- a/public/domain.te
+++ b/public/domain.te
@@ -32,7 +32,7 @@ allow domain self:unix_stream_socket { create_stream_socket_perms connectto };
 # Inherit or receive open files from others.
 allow domain init:fd use;
 
-userdebug_or_eng(`
+
   allow domain su:fd use;
   allow domain su:unix_stream_socket { connectto getattr getopt read write shutdown };
   allow domain su:unix_dgram_socket sendto;
@@ -46,6 +46,7 @@ userdebug_or_eng(`
   # allow "gdbserver --attach" to work for su.
   allow domain su:process sigchld;
 
+userdebug_or_eng(`
   # Allow writing coredumps to /cores/*
   allow domain coredump_file:file create_file_perms;
   allow domain coredump_file:dir ra_dir_perms;
@@ -111,7 +112,7 @@ compatible_property_only(`
     get_prop({coredomain appdomain shell}, exported3_default_prop)
     get_prop({coredomain appdomain shell}, exported3_radio_prop)
     get_prop({coredomain appdomain shell}, exported3_system_prop)
-    userdebug_or_eng(`
+
         get_prop(su, core_property_type)
         get_prop(su, exported_dalvik_prop)
         get_prop(su, exported_ffs_prop)
@@ -123,7 +124,7 @@ compatible_property_only(`
         get_prop(su, exported3_default_prop)
         get_prop(su, exported3_radio_prop)
         get_prop(su, exported3_system_prop)
-    ')
+
     get_prop({domain -coredomain -appdomain}, vendor_default_prop)
 ')
 
@@ -316,7 +317,7 @@ neverallow {
 # Limit raw I/O to these whitelisted domains. Do not apply to debug builds.
 neverallow {
   domain
-  userdebug_or_eng(`-domain')
+  -domain
   -kernel
   -init
   -recovery
@@ -433,7 +434,7 @@ neverallow {
     with_asan(`-asan_extract')
     -dumpstate
     -shell
-    userdebug_or_eng(`-su')
+    -su
     -webview_zygote
     -zygote
     userdebug_or_eng(`-mediaextractor')
@@ -495,10 +496,10 @@ neverallow { domain -kernel with_asan(`-asan_extract') } { system_file vendor_fi
 
 # Don't allow mounting on top of /system files or directories
 neverallow * exec_type:dir_file_class_set mounton;
-neverallow { domain -init userdebug_or_eng(`-recovery') } { system_file vendor_file_type }:dir_file_class_set mounton;
+neverallow { domain -init -recovery } { system_file vendor_file_type }:dir_file_class_set mounton;
 
 # Nothing should be writing to files in the rootfs.
-neverallow { domain userdebug_or_eng(`-recovery') } rootfs:file { create write setattr relabelto append unlink link rename };
+neverallow { domain -recovery } rootfs:file { create write setattr relabelto append unlink link rename };
 
 # Restrict context mounts to specific types marked with
 # the contextmount_type attribute.
@@ -604,7 +605,7 @@ neverallow { domain -install_recovery -recovery } recovery_block_device:blk_file
 # this partition for testing purposes.
 neverallow {
   domain
-  userdebug_or_eng(`-domain') # exclude debuggable builds
+  -domain # exclude debuggable builds
   -hal_bootctl_server
   -init
   -uncrypt
@@ -683,7 +684,7 @@ full_treble_only(`
   neverallow {
     coredomain
     -shell
-    userdebug_or_eng(`-su')
+    -su
     -ueventd # uevent is granted create for this device, but we still neverallow I/O below
   } vndbinder_device:chr_file rw_file_perms;
 ')
@@ -694,14 +695,14 @@ full_treble_only(`
   neverallow {
     coredomain
     -shell
-    userdebug_or_eng(`-su')
+    -su
   } vndservice_manager_type:service_manager *;
 ')
 full_treble_only(`
   neverallow {
     coredomain
     -shell
-    userdebug_or_eng(`-su')
+    -su
   } vndservicemanager:binder *;
 ')
 
@@ -737,7 +738,7 @@ full_treble_only(`
     -logd # Logging by writing to logd Unix domain socket is public API
     -netd # netdomain needs this
     -mdnsd # netdomain needs this
-    userdebug_or_eng(`-su') # communications with su are permitted only on userdebug or eng builds
+    -su # communications with su are permitted only on userdebug or eng builds
     -init
     -incidentd # TODO(b/35870313): Remove incidentd from this list once vendor domains no longer declare Binder services
     -tombstoned # TODO(b/36604251): Remove tombstoned from this list once mediacodec (OMX HAL) no longer declares Binder services
@@ -1115,7 +1116,7 @@ neverallow * { file_type fs_type dev_type }:{ lnk_file fifo_file sock_file } mou
 # Nobody should be able to execute su on user builds.
 # On userdebug/eng builds, only dumpstate, shell, and
 # su itself execute su.
-neverallow { domain userdebug_or_eng(`-dumpstate -shell -su -sudaemon -domain -init') } su_exec:file no_x_file_perms;
+neverallow { domain -shell -su -sudaemon -domain -init -dumpstate } su_exec:file no_x_file_perms;
 
 # Do not allow the introduction of new execmod rules. Text relocations
 # and modification of executable pages are unsafe.
@@ -1223,7 +1224,7 @@ neverallow {
 
 # Only domains spawned from zygote and runas may have the appdomain attribute.
 neverallow { domain -runas -webview_zygote -zygote } {
-  appdomain -shell userdebug_or_eng(`-su -sudaemon')
+  appdomain -shell -su -sudaemon
 }:process { transition dyntransition };
 
 # Minimize read access to shell- or app-writable symlinks.
diff --git a/public/hal_configstore.te b/public/hal_configstore.te
index c8051e14..b3761db6 100644
--- a/public/hal_configstore.te
+++ b/public/hal_configstore.te
@@ -36,7 +36,7 @@ neverallow hal_configstore_server {
   domain
   -hal_configstore_server
   -logd
-  userdebug_or_eng(`-su')
+  -su
   -tombstoned
 }:{ unix_dgram_socket unix_stream_socket } *;
 
diff --git a/public/installd.te b/public/installd.te
index f34ef0c5..07801629 100644
--- a/public/installd.te
+++ b/public/installd.te
@@ -157,4 +157,4 @@ allow installd preloads_media_file:dir { r_dir_perms write remove_name rmdir };
 # only system_server, installd and dumpstate may interact with installd over binder
 neverallow { domain -system_server -dumpstate -installd } installd_service:service_manager find;
 neverallow { domain -system_server -dumpstate } installd:binder call;
-neverallow installd { domain -system_server -servicemanager userdebug_or_eng(`-su') }:binder call;
+neverallow installd { domain -system_server -servicemanager -su }:binder call;
diff --git a/public/netd.te b/public/netd.te
index a550b258..c94e26b4 100644
--- a/public/netd.te
+++ b/public/netd.te
@@ -137,7 +137,7 @@ neverallow { domain -netd } netd:bpf { map_create };
 
 # apps may not interact with netd over binder.
 neverallow appdomain netd:binder call;
-neverallow netd { appdomain userdebug_or_eng(`-su') }:binder call;
+neverallow netd { appdomain -su }:binder call;
 
 # persist.netd.stable_secret contains RFC 7217 secret key which should never be
 # leaked to other processes. Make sure it never leaks.
diff --git a/public/su.te b/public/su.te
index b43c1ec2..726a4b06 100644
--- a/public/su.te
+++ b/public/su.te
@@ -6,7 +6,7 @@ type su, domain;
 type su_exec, exec_type, file_type;
 type sudaemon, domain;
 
-userdebug_or_eng(`
+
   # Domain used for su processes, as well as for adbd and adb shell
   # after performing an adb root command.  The domain definition is
   # wrapped to ensure that it does not exist at all on -user builds.
@@ -98,4 +98,4 @@ userdebug_or_eng(`
   typeattribute su hal_wifi_hostapd_client;
   typeattribute su hal_wifi_offload_client;
   typeattribute su hal_wifi_supplicant_client;
-')
+
diff --git a/public/te_macros b/public/te_macros
index dcebbefa..3af099c2 100644
--- a/public/te_macros
+++ b/public/te_macros
@@ -101,10 +101,10 @@ define(`pdx_service_socket_types', `
 typeattribute $2 pdx_$1_endpoint_dir_type;
 type pdx_$1_endpoint_socket, pdx_$1_endpoint_socket_type, pdx_endpoint_socket_type, file_type, coredomain_socket, mlstrustedobject, mlstrustedsubject;
 type pdx_$1_channel_socket, pdx_$1_channel_socket_type, pdx_channel_socket_type, coredomain_socket;
-userdebug_or_eng(`
+
 dontaudit su pdx_$1_endpoint_socket:unix_stream_socket *;
 dontaudit su pdx_$1_channel_socket:unix_stream_socket *;
-')
+
 ')
 
 #####################################
@@ -494,9 +494,9 @@ define(`with_asan', ifelse(target_with_asan, `true', userdebug_or_eng(`$1'), ))
 # Fallback crash handling for processes that can't exec crash_dump (e.g. because of seccomp).
 #
 define(`crash_dump_fallback', `
-userdebug_or_eng(`
+
   allow $1 su:fifo_file append;
-')
+
 allow $1 anr_data_file:file append;
 allow $1 dumpstate:fd use;
 allow $1 incidentd:fd use;
diff --git a/public/vold.te b/public/vold.te
index ec6ffa25..e379ebc3 100644
--- a/public/vold.te
+++ b/public/vold.te
@@ -268,7 +268,7 @@ neverallow vold {
   -hwservicemanager
   -servicemanager
   -system_server
-  userdebug_or_eng(`-su')
+  -su
 }:binder call;
 
 neverallow vold fsck_exec:file execute_no_trans;

project system/tools/hidl/
diff --git a/Android.bp b/Android.bp
index dd51705..ffe9ced 100644
--- a/Android.bp
+++ b/Android.bp
@@ -16,8 +16,8 @@ cc_defaults {
     name: "hidl-gen-defaults",
     cpp_std: "experimental",
     cflags: [
-        "-O0",
-        "-g",
+        "-O3",
+        "-g0",
         "-Wall",
         "-Werror",
     ],

project vendor/lineage/
diff --git a/bootanimation/Android.mk b/bootanimation/Android.mk
index 7eaf96c4..b041c809 100644
--- a/bootanimation/Android.mk
+++ b/bootanimation/Android.mk
@@ -15,49 +15,3 @@
 # limitations under the License.
 #
 
-ifeq ($(TARGET_SCREEN_WIDTH),)
-    $(warning TARGET_SCREEN_WIDTH is not set, using default value: 1080)
-    TARGET_SCREEN_WIDTH := 1080
-endif
-ifeq ($(TARGET_SCREEN_HEIGHT),)
-    $(warning TARGET_SCREEN_HEIGHT is not set, using default value: 1920)
-    TARGET_SCREEN_HEIGHT := 1920
-endif
-
-define build-bootanimation
-    $(shell) vendor/lineage/bootanimation/generate-bootanimation.sh \
-    $(PRODUCT_OUT) \
-    $(TARGET_SCREEN_WIDTH) \
-    $(TARGET_SCREEN_HEIGHT) \
-    $(TARGET_BOOTANIMATION_HALF_RES)
-endef
-
-TARGET_GENERATED_BOOTANIMATION := $(TARGET_OUT_INTERMEDIATES)/BOOTANIMATION/bootanimation.zip
-$(TARGET_GENERATED_BOOTANIMATION):
-	@echo "Building bootanimation"
-	$(build-bootanimation)
-
-ifeq ($(TARGET_BOOTANIMATION),)
-    TARGET_BOOTANIMATION := $(TARGET_GENERATED_BOOTANIMATION)
-    ifeq ($(shell command -v mogrify),)
-        $(info **********************************************)
-        $(info The boot animation could not be generated as)
-        $(info ImageMagick is not installed in your system.)
-        $(info $(space))
-        $(info Please install ImageMagick from this website:)
-        $(info https://imagemagick.org/script/binary-releases.php)
-        $(info **********************************************)
-        $(error stop)
-    endif
-endif
-
-include $(CLEAR_VARS)
-LOCAL_MODULE := bootanimation.zip
-LOCAL_MODULE_CLASS := ETC
-LOCAL_MODULE_PATH := $(TARGET_OUT)/media
-
-include $(BUILD_SYSTEM)/base_rules.mk
-
-$(LOCAL_BUILT_MODULE): $(TARGET_BOOTANIMATION)
-	@mkdir -p $(dir $@)
-	@cp $(TARGET_BOOTANIMATION) $@
diff --git a/config/common.mk b/config/common.mk
index 837e11ef..8b343b45 100644
--- a/config/common.mk
+++ b/config/common.mk
@@ -59,6 +59,7 @@ PRODUCT_COPY_FILES += \
 # init.d support
 PRODUCT_COPY_FILES += \
     vendor/lineage/prebuilt/common/etc/init.d/00banner:system/etc/init.d/00banner \
+    vendor/lineage/prebuilt/common/etc/init.d/01boot:system/etc/init.d/01boot \
     vendor/lineage/prebuilt/common/bin/sysinit:system/bin/sysinit
 
 ifneq ($(TARGET_BUILD_VARIANT),user)
diff --git a/overlay/common/frameworks/base/packages/SystemUI/res/values/config.xml b/overlay/common/frameworks/base/packages/SystemUI/res/values/config.xml
index 363e254b..8571df19 100644
--- a/overlay/common/frameworks/base/packages/SystemUI/res/values/config.xml
+++ b/overlay/common/frameworks/base/packages/SystemUI/res/values/config.xml
@@ -30,5 +30,5 @@
     <!-- If true, enable the advance anti-falsing classifier on the lockscreen. On some devices it
          does not work well, particularly with noisy touchscreens. Note that disabling it may
          increase the rate of unintentional unlocks. -->
-    <bool name="config_lockscreenAntiFalsingClassifierEnabled">false</bool>
+    <bool name="config_lockscreenAntiFalsingClassifierEnabled">true</bool>
 </resources>
diff --git a/overlay/common/packages/apps/Settings/res/values/bools.xml b/overlay/common/packages/apps/Settings/res/values/bools.xml
index 2060de12..823e89b9 100644
--- a/overlay/common/packages/apps/Settings/res/values/bools.xml
+++ b/overlay/common/packages/apps/Settings/res/values/bools.xml
@@ -16,8 +16,8 @@
 
 <resources>
     <!-- Whether to show a preference item for mobile plan -->
-    <bool name="config_show_mobile_plan">false</bool>
+    <bool name="config_show_mobile_plan">true</bool>
 
     <!-- Whether wallpaper attribution should be shown or not. -->
-    <bool name="config_show_wallpaper_attribution">false</bool>
+    <bool name="config_show_wallpaper_attribution">true</bool>
 </resources>
